// TODOS:
// * add rule tabs (is this possible in .json?)
// * check how "Back To Back", "Single", and "Paningit" yaku work, then implement
  // * implement headbump based on Paningit headbumping Single, and seat order otherwise
// * check who pays for the Thirteen Flowers instant payout, and implement it
// * check and implement other instant payouts
// * implement mods

{
  "default_mods": ["show_waits"],
  "available_mods": [
    "Rules",
    // {"id": "filipino_doubles", "name": "Doubles", "desc": "If the initial roll is doubles, all payouts are doubled."},
    // {"id": "filipino_jai_alai", "name": "Jai Alái (Pot)", "desc": "At the start of the game, players each ante $1. When someone wins, they get one marker; two if they win by búnot. First to five markers wins the ante."},
    // {"id": "filipino_jokers", "name": "Jokers", "desc": "After flower declarations, the dealer may roll dice to randomly determine a joker."},
    "Other",
    {"id": "show_waits", "name": "Show Waits", "desc": "Add some UI that shows waits."},
    {"id": "open_hands", "name": "Open Hands", "desc": "Everyone plays with tiles shown."}
  ],
  "display_name": "Filipino",
  "tutorial_link": "https://mahjongpros.com/blogs/mahjong-rules-and-scoring-tables/official-filipino-mahjong-rules",
  "wall": ["1m", "1m", "1m", "1m",
           "2m", "2m", "2m", "2m",
           "3m", "3m", "3m", "3m",
           "4m", "4m", "4m", "4m",
           "5m", "5m", "5m", "5m",
           "6m", "6m", "6m", "6m",
           "7m", "7m", "7m", "7m",
           "8m", "8m", "8m", "8m",
           "9m", "9m", "9m", "9m",
           "1p", "1p", "1p", "1p",
           "2p", "2p", "2p", "2p",
           "3p", "3p", "3p", "3p",
           "4p", "4p", "4p", "4p",
           "5p", "5p", "5p", "5p",
           "6p", "6p", "6p", "6p",
           "7p", "7p", "7p", "7p",
           "8p", "8p", "8p", "8p",
           "9p", "9p", "9p", "9p",
           "1s", "1s", "1s", "1s",
           "2s", "2s", "2s", "2s",
           "3s", "3s", "3s", "3s",
           "4s", "4s", "4s", "4s",
           "5s", "5s", "5s", "5s",
           "6s", "6s", "6s", "6s",
           "7s", "7s", "7s", "7s",
           "8s", "8s", "8s", "8s",
           "9s", "9s", "9s", "9s",
           "1z", "1z", "1z", "1z",
           "2z", "2z", "2z", "2z",
           "3z", "3z", "3z", "3z",
           "4z", "4z", "4z", "4z",
           "0z", "0z", "0z", "0z",
           "6z", "6z", "6z", "6z",
           "7z", "7z", "7z", "7z",
           "1f", "2f", "3f", "4f",
           "1g", "2g", "3g", "4g"],
  "set_definitions": {
    "pair": [[0, 0]],
    "shuntsu": [[0, 1, 2]],
    "koutsu": [[0, 0, 0]],
    "quad": [[0, 0, 0, 0]],
    "ryanmen/penchan": [[0, 1]],
    "kanchan": [[0, 2]],
    "ittsu": [[[0,1,2],[3,4,5],[6,7,8]]],
    "manzu": [["1m","2m","3m","4m","5m","6m","7m","8m","9m"]],
    "pinzu": [["1p","2p","3p","4p","5p","6p","7p","8p","9p"]],
    "souzu": [["1s","2s","3s","4s","5s","6s","7s","8s","9s"]],
    "manzu_3": [[["1m","2m","3m","4m","5m","6m","7m","8m","9m"],["1m","2m","3m","4m","5m","6m","7m","8m","9m"],["1m","2m","3m","4m","5m","6m","7m","8m","9m"]]],
    "pinzu_3": [[["1p","2p","3p","4p","5p","6p","7p","8p","9p"],["1p","2p","3p","4p","5p","6p","7p","8p","9p"],["1p","2p","3p","4p","5p","6p","7p","8p","9p"]]],
    "souzu_3": [[["1s","2s","3s","4s","5s","6s","7s","8s","9s"],["1s","2s","3s","4s","5s","6s","7s","8s","9s"],["1s","2s","3s","4s","5s","6s","7s","8s","9s"]]]
  
  },
  "tenpai_definition": [
    [ "exhaustive", [["pair"], 1], [["ryanmen/penchan", "kanchan", "pair"], 1], [["shuntsu", "koutsu"], 4] ],
    [ "exhaustive", [["shuntsu", "koutsu"], 5] ],
    [ [["pair"], 6], [["koutsu"], 1] ],
    [ [["pair"], 8] ]
  ],  
  "win_definition": [
    [ "exhaustive", [["pair"], 1], [["shuntsu", "koutsu"], 5] ],
    [ [["pair"], 7], [["koutsu"], 1] ]
  ],
  "all_flowers_definition": [[ "unique", [["1f","2f","3f","4f"], 4] ]],
  "all_seasons_definition": [[ "unique", [["1g","2g","3g","4g"], 4] ]],
  "7_flowers_definition": [[ "unique", [["1f","2f","3f","4f","1g","2g","3g","4g"], 7] ]],
  "8_flowers_definition": [[ "unique", [["1f","2f","3f","4f","1g","2g","3g","4g"], 8] ]],
  "closed_wait_definition": [
    [ "exhaustive", [["pair"], 1], [["shuntsu", "koutsu"], 4], [["kanchan"], 1] ]
  ],
  "single_wait_definition": [
    [ "exhaustive", [["shuntsu", "koutsu"], 5] ]
  ],
  "full_straight_definition": [
    [ "exhaustive", [["ittsu"], 1], [["shuntsu", "koutsu"], 2], [["pair"], 1] ]
  ],
  "yaku": [
      // Base
    { "display_name": "Win", "value": 4, "when": [] },
    { "display_name": "All Chows", "value": 1, "when": [{"name": "match", "opts": [["hand", "calls", "winning_tile"], [["exhaustive", [["shuntsu"], 5], [["pair"], 1]]]]}] },
    { "display_name": "All Pungs", "value": 1, "when": [{"name": "match", "opts": [["hand", "calls", "winning_tile"], [[[["koutsu"], 5], [["pair"], 1]]]]}] },
    { "display_name": "Concealed Hand", "value": 1, "when": [{"name": "has_no_call_named", "opts": ["chii", "pon", "daiminkan", "kakan"]}] },
    { "display_name": "All Revealed", "value": 1, "when": [{"name": "match", "opts": [["calls"], [[[["chii", "pon", "daiminkan", "ankan", "kakan"], 5]]]]}] },
      // Quick Win: Winning within five discards. TODO: calculate the correct number to put on the right here.
        // actually, because flowers and kongs exist, this doesn't work correctly anyway
    // { "display_name": "Within Seven Tiles", "value": 8, "when": [{"name": "tiles_remaining", "opts": [74]}] },
    { "display_name": "Pure Straight", "value": 2, "when": [{"name": "match", "opts": [["hand", "calls", "winning_tile"], [[ "exhaustive", [[[[0,1,2],[3,4,5],[6,7,8]]], 1], [["shuntsu", "koutsu"], 2], [["pair"], 1] ]]]}] },
      // note: half-flush is not a yaku because all honors are flowers
    {
      "display_name": "Full Flush",
      "value": 2,
      "when": [[
        {"name": "winning_hand_consists_of", "opts": ["1m","2m","3m","4m","5m","6m","7m","8m","9m"]},
        {"name": "winning_hand_consists_of", "opts": ["1p","2p","3p","4p","5p","6p","7p","8p","9p"]},
        {"name": "winning_hand_consists_of", "opts": ["1s","2s","3s","4s","5s","6s","7s","8s","9s"]}
      ]]
    },
    { "display_name": "Seven Pairs", "value": 30, "when": [{"name": "match", "opts": [["hand", "calls", "winning_tile"], [[[["pair"], 7], [["koutsu"], 1]]]]}] },
      // Back to Back
        // specifically, this is a hand whose wait is shanpon.
    // {},
      // Single
        // specifically, this is a hand whose only wait is a single tile. can be penchan/kanchan/tanki, or interpretable as multiple shapes e.g. 12234 being either 12+234 or 123+24
    // {},
      // Paningit
        // specifically, this must be a hand whose only wait is a single tile, and which can ONLY be interpreted as a middle wait on that tile. e.g. 12234 being interpreted as 123+24 does NOT count
    // {},
      // Flowers
    { "display_name": "No Flowers (Upon Win)", "value": 1, "when": [{"name": "status", "opts": ["no_flowers"]}, {"name": "not_match", "opts": [["flowers"], [[ "unique", "nojoker", [["1f","2f","3f","4f","1g","2g","3g","4g"], 1] ]]]}] },

  ],
  "yaku_precedence": {
    "Seven Pairs": ["Back to Back", "Single"],
    "All Revealed": ["Single"],
    "Paníngit": ["Single"]
  },
  "score_calculation": {
    "scoring_method": "multiplier",
    "score_multiplier": 25,
    "discarder_multiplier": 2,
    "non_discarder_multiplier": 1,
    "self_draw_multiplier": 2,
    "yaku_lists": ["yaku"],
    "agarirenchan": true,
    "point_name": "¢",
    "win_by_discard_label": "Tódas",
    "win_by_draw_label": "Búnot",
    "win_by_discard_name": "Tódas",
    "win_by_draw_name": "Búnot",
    "exhaustive_draw_name": "Draw"
  },
  "play_restrictions": [
    [["flower"], []],
    [["jihai"], []]
  ],
  "before_turn_change": {
    "actions": [
      ["unset_status", "kan", "double_kan"],
      ["when", [{"name": "status_missing", "opts": ["match_start"]}], [["unset_status", "first_turn"]]]
    ]
  },
  "after_turn_change": {
    "actions": [
      ["when", ["no_tiles_remaining"], [["pause", 1000], ["ryuukyoku"]]],
      ["when", [{"name": "status_missing", "opts": ["match_start"]}, "not_no_tiles_remaining"], [["draw"]]],
      ["when", [{"name": "everyone_status", "opts": ["no_flowers"]}], [["unset_status_all", "no_flowers", "match_start"], ["change_turn", "east"]]]
    ]
  },
  "after_call": {
    "actions": [
      ["when", [{"name": "match", "opts": [["last_call"], [[[["haku", "hatsu", "chun"], 1]]]]}, {"name": "match", "opts": [["calls"], [[[["haku"], 1], [["hatsu"], 1], [["chun"], 1]]]]}], [["as", "callee", [["make_responsible_for", "prev_seat", "all"]]]]],
      ["when", [{"name": "match", "opts": [["last_call"], [[[["ton", "nan", "shaa", "pei"], 1]]]]}, {"name": "match", "opts": [["calls"], [[[["ton"], 1], [["nan"], 1], [["shaa"], 1], [["pei"], 1]]]]}], [["as", "callee", [["make_responsible_for", "prev_seat", "all"]]]]]
    ]
  },
  "after_start": {
    "actions": [["set_status_all", "first_turn", "match_start", "no_initial_flowers"]]
  },
  "buttons": {
    "start_flower": {
      "display_name": "Reveal flower",
      "show_when": [{"name": "status", "opts": ["match_start"]}, "our_turn", {"name": "match", "opts": [["hand", "draw"], [[ "nojoker", [["1z", "2z", "3z", "4z", "0z", "6z", "7z", "1f", "2f", "3f", "4f", "1g", "2g", "3g", "4g"], 1] ]]]}],
        // TODO: add an instant payout when a player declares a thirteenth flower
      "actions": [["big_text", "Flower"], ["flower", "1z", "2z", "3z", "4z", "0z", "6z", "7z", "1f", "2f", "3f", "4f", "1g", "2g", "3g", "4g"], ["draw", 1, "opposite_end"], ["unset_status", "no_initial_flowers"]],
      "unskippable": true
    },
    "start_no_flower": {
      "display_name": "No flowers",
      "show_when": [{"name": "status", "opts": ["match_start"]}, "our_turn", {"name": "not_match", "opts": [["hand", "draw"], [[ "nojoker", [["1z", "2z", "3z", "4z", "0z", "6z", "7z", "1f", "2f", "3f", "4f", "1g", "2g", "3g", "4g"], 1] ]]]}],
        // TODO: add an instant payout if the player has the status "no_initial_flowers"
      "actions": [["big_text", "No flowers"], ["set_status", "no_flowers"], ["advance_turn"], ["recalculate_buttons"]],
      "unskippable": true
    },
    "chii": {
      "display_name": "Chow",
      "call": [[-2, -1], [-1, 1], [1, 2]],
      "show_when": [{"name": "status_missing", "opts": ["match_start"]}, "not_our_turn", "not_no_tiles_remaining", "kamicha_discarded", "call_available"],
      "actions": [["big_text", "Chow"], ["call"], ["change_turn", "self"]]
    },
    "pon": {
      "display_name": "Pung",
      "call": [[0, 0]],
      "show_when": [{"name": "status_missing", "opts": ["match_start"]}, "not_our_turn", "not_no_tiles_remaining", "someone_else_just_discarded", "call_available"],
      "actions": [["big_text", "Pong"], ["call"], ["change_turn", "self"]],
      "precedence_over": ["chii"]
    },
    "daiminkan": {
      "display_name": "Kang",
      "call": [[0, 0, 0]],
      "show_when": [{"name": "status_missing", "opts": ["match_start"]}, "not_our_turn", "not_no_tiles_remaining", "someone_else_just_discarded", "call_available"],
      "actions": [
        ["big_text", "Kong"], ["call"], ["change_turn", "self"],
        ["when", [{"name": "status", "opts": ["kan"]}], [["set_status", "double_kan"]]],
        ["set_status", "kan"],
        ["draw", 1, "opposite_end"]
      ],
      "precedence_over": ["chii", "pon"]
    },
        // TODO: add instant payouts on kan
    "ankan": {
      "display_name": "Secret",
      "call": [[0, 0, 0]],
      "show_when": [{"name": "status_missing", "opts": ["match_start"]}, "our_turn", "not_no_tiles_remaining", "has_draw", "self_call_available", {"name": "status_missing", "opts": ["just_reached"]}],
      "actions": [
        ["big_text", "Kong"], ["self_call"],
        ["when", [{"name": "status", "opts": ["kan"]}], [["set_status", "double_kan"]]],
        ["set_status", "kan"],
        ["draw", 1, "opposite_end"]
      ]
    },
    "kakan": {
      "display_name": "Kang",
      "call": [[0, 0, 0]],
      "upgrades": "pon",
      "show_when": [{"name": "status_missing", "opts": ["match_start"]}, "our_turn", "not_no_tiles_remaining", "has_draw", "can_upgrade_call", {"name": "status_missing", "opts": ["just_reached"]}],
      "actions": [
        ["big_text", "Kong"], ["upgrade_call"],
        ["when", [{"name": "status", "opts": ["kan"]}], [["set_status", "double_kan"]]],
        ["set_status", "kan"],
        ["draw", 1, "opposite_end"]
      ]
    },
    "ron": {
      "display_name": "Tódas",
      "show_when": [
        "not_our_turn",
        {"name": "match", "opts": [["hand", "calls", "draw"], ["tenpai", "kokushi_tenpai"]]},
        "someone_else_just_discarded",
        {"name": "match", "opts": [["hand", "calls", "last_discard"], ["win"]]}
      ],
      "actions": [["big_text", "Hu"], ["pause", 1000], ["reveal_hand"], ["win_by_discard"]],
      "precedence_over": ["chii", "pon", "daiminkan"]
    },
    "chankan": {
      "display_name": "Tódas",
      "show_when": [
        "not_our_turn",
        {"name": "match", "opts": [["hand", "calls", "draw"], ["tenpai", "kokushi_tenpai"]]},
        [
          [
            {"name": "last_call_is", "opts": ["kakan"]},
            {"name": "match", "opts": [["hand", "calls", "last_called_tile"], ["win"]]}
          ],
          [
            {"name": "last_call_is", "opts": ["ankan"]},
            {"name": "match", "opts": [["hand", "calls", "draw"], ["kokushi_tenpai"]]},
            {"name": "match", "opts": [["hand", "calls", "last_called_tile"], ["win"]]}
          ]
        ]
      ],
      "actions": [["big_text", "Hu"], ["pause", 1000], ["reveal_hand"], ["win_by_call"]],
      "precedence_over": ["chii", "pon", "daiminkan"]
    },
    "tsumo": {
      "display_name": "Búnot",
      "show_when": [
        "our_turn",
        {"name": "status_missing", "opts": ["match_start"]},
        {"name": "match", "opts": [["hand", "calls", "draw"], ["tenpai", "kokushi_tenpai"]]},
        {"name": "match", "opts": [["hand", "calls", "draw"], ["win"]]}
      ],
      "actions": [["big_text", "Zimo"], ["pause", 1000], ["reveal_hand"], ["win_by_draw"]]
    },
    "flower": {
      "display_name": "Flower",
      "show_when": ["our_turn", "has_draw", {"name": "status_missing", "opts": ["match_start"]}, "not_just_discarded", {"name": "match", "opts": [["hand", "draw"], [[[["1z", "2z", "3z", "4z", "0z", "6z", "7z", "1f", "2f", "3f", "4f", "1g", "2g", "3g", "4g"], 1]]]]}],
      "actions": [
        ["big_text", "Flower"],
        ["flower", "1z", "2z", "3z", "4z", "0z", "6z", "7z", "1f", "2f", "3f", "4f", "1g", "2g", "3g", "4g"],
        ["ite", ["no_tiles_remaining"], [["advance_turn"]], [["draw", 1, "opposite_end"]]]
        ["unset_status", "no_flowers", "no_initial_flowers"]
      ],
      "unskippable": true
    }
  },
  "auto_buttons": {
    "1_auto_sort": {
      "display_name": "A",
      "desc": "Automatically sort your hand.",
      "actions": [["sort_hand"]],
      "enabled_at_start": true
    },
    "2_auto_ron": {
      "display_name": "R",
      "desc": "Automatically declare wins.",
      "actions": [
        ["when", [{"name": "buttons_include", "opts": ["ron"]}], [["press_button", "ron"]]],
        ["when", [{"name": "buttons_include", "opts": ["tsumo"]}], [["press_button", "tsumo"]]]
      ],
      "enabled_at_start": false
    },
    "3_auto_flower": {
      "display_name": "F",
      "desc": "Automatically declare all flowers.",
      "actions": [
        ["when", [{"name": "buttons_include", "opts": ["start_flower"]}], [["press_button", "start_flower"], ["press_first_call_button", "start_flower"]]],
        ["when", [{"name": "buttons_include", "opts": ["start_no_flower"]}], [["press_button", "start_no_flower"]]],
        ["when", [{"name": "buttons_include", "opts": ["flower"]}], [["press_button", "flower"], ["press_first_call_button", "flower"]]]
      ],
      "enabled_at_start": true
    },
    "4_auto_no_call": {
      "display_name": "C",
      "desc": "Skip all calls except wins.",
      "actions": [
        ["when", [
            "not_our_turn",
            {"name": "buttons_include", "opts": ["skip"]},
            {"name": "buttons_exclude", "opts": ["ron", "chankan"]}
          ], [["press_button", "skip"]]]
      ],
      "enabled_at_start": false
    },
    "5_auto_discard": {
      "display_name": "D",
      "desc": "Automatically discard your drawn tile.",
      "actions": [["when", ["our_turn", {"name": "buttons_exclude", "opts": ["tsumo", "ankan"]}, "has_draw"], [["discard_draw"]]]],
      "enabled_at_start": false
    }
  },
  "interruptible_actions": ["play_tile", "draw", "call", "self_call", "upgrade_call"],
  "initial_score": 0,
  "starting_tiles": 16,
  "max_rounds": 16
}
