{
  "default_mods": [
    "saki/aislinn_wishart",
    "saki/amae_koromo",
    "saki/anetai_toyone",
    "saki/arakawa_kei",
    "saki/atago_hiroe",
    "saki/atago_kinue",
    "saki/atarashi_ako",
    "saki/choe_myeonghwa",
    "saki/funakubo_hiroko",
    "saki/haramura_nodoka",
    "saki/hirose_sumire",
    "saki/ikeda_kana",
    "saki/inoue_jun",
    "saki/iwadate_yuan",
    "saki/iwato_kasumi",
    "saki/kajiki_yumi",
    "saki/jindai_komaki",
    "saki/kakura_kurumi",
    "saki/karijuku_tomoe",
    "saki/kataoka_yuuki",
    "saki/kosegawa_shiromi",
    "saki/mase_yuuko",
    "saki/matano_seiko",
    "saki/matsumi_kuro",
    "saki/matsumi_yuu",
    "saki/maya_yukiko",
    "saki/megan_davin",
    "saki/miyanaga_saki",
    "saki/miyanaga_teru",
    "saki/motouchi_naruka",
    "saki/nanpo_kazue",
    "saki/nelly_virsaladze",
    "saki/oohoshi_awai",
    "saki/onjouji_toki",
    "saki/ryuumonbuchi_touka",
    "saki/sagimori_arata",
    "saki/sawamura_tomoki",
    "saki/senoo_kaori",
    "saki/shibuya_takami",
    "saki/shishihara_sawaya",
    "saki/someya_mako",
    "saki/suehara_kyouko",
    "saki/takakamo_shizuno",
    "saki/takei_hisa",
    "saki/takimi_haru",
    "saki/toyouko_momoko",
    "saki/ueshige_suzu",
    "saki/usuzawa_sae",
    "saki/usuzumi_hatsumi",
    "saki/yae_kobashiri",
    "saki/yoshitome_miharu",
    "saki/yumeno_maho",
    "tobi",
    "agarirenchan", "tenpairenchan",
    "show_waits"
  ],
  "available_mods": [
    "Rules",
    {"id": "tobi", "name": "Tobi", "desc": "Enable busting. Once anyone's points is reduced below zero, the game ends."},
    {"id": "agarirenchan", "name": "Agarirenchan", "desc": "A round repeats if the dealer wins."},
    {"id": "tenpairenchan", "name": "Tenpairenchan", "desc": "A round repeats if the dealer is tenpai at draw."},
    {"id": "agariyame", "deps": ["agarirenchan"], "name": "Agariyame", "desc": "All Last doesn't repeat if the dealer is first place and wins."},
    {"id": "tenpaiyame", "deps": ["tenpairenchan"], "name": "Tenpaiyame", "desc": "All Last doesn't repeat if the dealer is in first place and is tenpai at draw."},
    {"id": "tonpuu", "name": "Tonpuu", "desc": "Limit the game to the East round only."},
    {"id": "kuitan_nashi", "name": "Kuitan Nashi", "desc": "Disallow open tanyao."},
    {"id": "kuikae_ari", "name": "Kuikae Ari", "desc": "Allow swap-calling."},
    {"id": "kiriage_mangan", "name": "Kiriage Mangan", "desc": "3 han 60 fu and 4 han 30 fu are worth mangan."},
    {"id": "head_bump", "conflicts": ["sanchahou"], "name": "Head Bump", "desc": "Enable head bump. In case of multiple ron, only the person closest in turn order gets the win."},
    {"id": "drawless_riichi", "name": "Drawless Riichi", "desc": "You may riichi even if you have no draws remaining in the wall."},
    {"id": "open_riichi", "name": "Open Riichi", "desc": "You have the option to declare open riichi, which is worth 2 han but reveals your hand to the table."},
    {"id": "mega_riichi_bet", "name": "Mega Riichi Bet", "desc": "Makes riichi bet 5000 instead of 1000."},
    {"id": "big_honba", "name": "Big Honba", "desc": "Makes each honba worth 500 instead of 100."},
    {"id": "three_dora_start", "name": "Three Dora Start", "desc": "Start with 3 dora instead of 1."},
    {"id": "pao", "name": "Sekinin Barai", "desc": "If you deal the last dragon called for a daisangen hand, or the last wind called for a daisuushii hand, you are responsible for the yakuman payment if they tsumo, or half of the payment if they ron off someone else."},
    {"id": "no_kazoe_yakuman", "name": "No Kazoe Yakuman", "desc": "Disable kazoe yakuman. 13+ han is worth sanbaiman."},
    {"id": "no_double_yakuman", "name": "No Double Yakuman", "desc": "Disable double yakuman. Yakuman still stacks, but each yaku that typically awards double yakuman only awards one stack of yakuman."},
    {"id": "yakuman_only", "order": 1, "name": "Yakuman Only", "desc": "Allow only yakuman-scoring hands."},
    {"id": "wareme", "name": "Wareme", "desc": "In each round, the player whose wall is broken is given the wareme marker. If the wareme player wins, they are paid double the amount of points. If the wareme player has to pay points, they pay double the amount of points. Riichi sticks and honba payments are not affected."},
    {"id": "aotenjou", "order": 1, "name": "Aotenjou", "desc": "Removes limit hands. Score grows exponentially with han according to the formula 4 * fu * 2^(2+han). Not recommended with tobi enabled."},
    {"id": "yakitori", "name": "Yakitori", "desc": "If you do not win any hands by the end of the game, you pay 4000 points to each player as a penalty."},
    {"id": "shuugi", "order": 1, "name": "Shuugi", "desc": "Play with shuugi (poker chips). Players start with zero shuugi, each is worth 2000 points each at the end. Win payments include shuugi along with points. On ron you get shuugi from the discarder; on tsumo you get shuugi from everyone. Each aka, ura, and ippatsu is worth one shuugi. Yakuman is worth 5 shuugi."},
    {"id": "toriuchi", "deps": ["shuugi"], "name": "Toriuchi", "desc": "On ron, each 1s (bird) tile is worth 1 shuugi, unless the discarder's hand contains 7p (pistol) which would shoot the birds dead. That is, unless your hand contains 8s (birdcage) which would protect the birds from gunfire."},
    {"id": "sanchahou", "conflicts": ["head_bump"], "name": "Sanchahou", "desc": "Enable triple ron abortive draw."},
    "Saki Cards (beginner-friendly)",
    {"id": "saki/atarashi_ako", "name": "Atarashi Ako", "desc": "", "class": "v13 atarashi-ako"},
    {"id": "saki/choe_myeonghwa", "name": "Choe Myeonghwa", "desc": "", "class": "v13 choe-myeonghwa"},
    {"id": "saki/haramura_nodoka", "name": "Haramura Nodoka", "desc": "", "class": "v13 haramura-nodoka"},
    {"id": "saki/ikeda_kana", "name": "Ikeda Kana", "desc": "", "class": "v13 ikeda-kana"},
    {"id": "saki/jindai_komaki", "name": "Jindai Komaki", "desc": "", "class": "v13 jindai-komaki"},
    {"id": "saki/kakura_kurumi", "name": "Kakura Kurumi", "desc": "", "class": "v13 kakura-kurumi"},
    {"id": "saki/kataoka_yuuki", "name": "Kataoka Yuuki", "desc": "", "class": "v13 kataoka-yuuki"},
    {"id": "saki/mase_yuuko", "name": "Mase Yuuko", "desc": "", "class": "v13 mase-yuuko"},
    {"id": "saki/matano_seiko", "name": "Matano Seiko", "desc": "", "class": "v13 matano-seiko"},
    {"id": "saki/matsumi_kuro", "name": "Matsumi Kuro", "desc": "", "class": "v13 matsumi-kuro"},
    {"id": "saki/matsumi_yuu", "name": "Matsumi Yuu", "desc": "", "class": "v13 matsumi-yuu"},
    {"id": "saki/miyanaga_saki", "name": "Miyanaga Saki", "desc": "", "class": "v13 miyanaga-saki"},
    {"id": "saki/miyanaga_teru", "name": "Miyanaga Teru", "desc": "", "class": "v13 miyanaga-teru"},
    {"id": "saki/nanpo_kazue", "name": "Nanpo Kazue", "desc": "", "class": "v13 nanpo-kazue"},
    {"id": "saki/sagimori_arata", "name": "Sagimori Arata", "desc": "", "class": "v13 sagimori-arata"},
    {"id": "saki/sawamura_tomoki", "name": "Sawamura Tomoki", "desc": "", "class": "v13 sawamura-tomoki"},
    {"id": "saki/senoo_kaori", "name": "Senoo Kaori", "desc": "", "class": "v13 senoo-kaori"},
    {"id": "saki/shibuya_takami", "name": "Shibuya Takami", "desc": "", "class": "v13 shibuya-takami"},
    {"id": "saki/someya_mako", "name": "Someya Mako", "desc": "", "class": "v13 someya-mako"},
    {"id": "saki/takakamo_shizuno", "name": "Takakamo Shizuno", "desc": "", "class": "v13 takakamo-shizuno"},
    {"id": "saki/takei_hisa", "name": "Takei Hisa", "desc": "", "class": "v13 takei-hisa"},
    {"id": "saki/takimi_haru", "name": "Takimi Haru", "desc": "", "class": "v13 takimi-haru"},
    {"id": "saki/toyouko_momoko", "name": "Toyouko Momoko", "desc": "", "class": "v13 toyouko-momoko"},
    {"id": "saki/usuzawa_sae", "name": "Usuzawa Sae", "desc": "", "class": "v13 usuzawa-sae"},
    {"id": "saki/usuzumi_hatsumi", "name": "Usuzumi Hatsumi", "desc": "", "class": "v13 usuzumi-hatsumi"},
    {"id": "saki/yumeno_maho", "order": 1, "name": "Yumeno Maho", "desc": "", "class": "v13 yumeno-maho"},
    "Saki Cards (intermediate)",
    {"id": "saki/aislinn_wishart", "name": "Aislinn Wishart", "desc": "", "class": "v13 aislinn-wishart"},
    {"id": "saki/amae_koromo", "name": "Amae Koromo", "desc": "", "class": "v13 amae-koromo"},
    {"id": "saki/anetai_toyone", "name": "Anetai Toyone", "desc": "", "class": "v13 anetai-toyone"},
    {"id": "saki/arakawa_kei", "name": "Arakawa Kei", "desc": "", "class": "v13 arakawa-kei"},
    {"id": "saki/atago_hiroe", "name": "Atago Hiroe", "desc": "", "class": "v13 atago-hiroe"},
    {"id": "saki/hirose_sumire", "name": "Hirose Sumire", "desc": "", "class": "v13 hirose-sumire"},
    {"id": "saki/inoue_jun", "name": "Inoue Jun", "desc": "", "class": "v13 inoue-jun"},
    {"id": "saki/iwato_kasumi", "name": "Iwato Kasumi", "desc": "", "class": "v13 iwato-kasumi"},
    {"id": "saki/kajiki_yumi", "name": "Kajiki Yumi", "desc": "", "class": "v13 kajiki-yumi"},
    {"id": "saki/karijuku_tomoe", "name": "Karijuku Tomoe", "desc": "", "class": "v13 karijuku-tomoe"},
    {"id": "saki/kosegawa_shiromi", "name": "Kosegawa Shiromi", "desc": "", "class": "v13 kosegawa-shiromi"},
    {"id": "saki/maya_yukiko", "name": "Maya Yukiko", "desc": "", "class": "v13 maya-yukiko"},
    {"id": "saki/megan_davin", "name": "Megan Davin", "desc": "", "class": "v13 megan-davin"},
    {"id": "saki/nelly_virsaladze", "name": "Nelly Virsaladze", "desc": "", "class": "v13 nelly-virsaladze"},
    {"id": "saki/oohoshi_awai", "name": "Oohoshi Awai", "desc": "", "class": "v13 oohoshi-awai"},
    {"id": "saki/onjouji_toki", "name": "Onjouji Toki", "desc": "", "class": "v13 onjouji-toki"},
    {"id": "saki/ryuumonbuchi_touka", "name": "Ryuumonbuchi Touka", "desc": "", "class": "v13 ryuumonbuchi-touka"},
    "Saki Cards (complex)",
    {"id": "saki/ezaki_hitomi", "name": "Ezaki Hitomi", "desc": "", "class": "v13 ezaki-hitomi"},
    {"id": "saki/fukuji_mihoko", "name": "Fukuji Mihoko", "desc": "", "class": "v13 fukuji-mihoko"},
    {"id": "saki/hanada_kirame", "name": "Hanada Kirame", "desc": "", "class": "v13 hanada-kirame"},
    {"id": "saki/hao_huiyu", "name": "Hao Huiyu", "desc": "", "class": "v13 hao-huiyu"},
    {"id": "saki/kainou_yoshiko", "name": "Kainou Yoshiko", "desc": "", "class": "v13 kainou-yoshiko"},
    {"id": "saki/kanbara_satomi", "name": "Kanbara Satomi", "desc": "", "class": "v13 kanbara-satomi"},
    {"id": "saki/kunihiro_hajime", "name": "Kunihiro Hajime", "desc": "", "class": "v13 kunihiro-hajime"},
    {"id": "saki/shimizudani_ryuuka", "name": "Shimizudani Ryuuka", "desc": "", "class": "v13 shimizudani-ryuuka"},
    {"id": "saki/shirouzu_mairu", "name": "Shirouzu Mairu", "desc": "", "class": "v13 shirouzu-mairu"},
    {"id": "saki/tsujigaito_satoha", "name": "Tsujigaito Satoha", "desc": "", "class": "v13 tsujigaito-satoha"},
    "Saki Cards (unrated)",
    {"id": "saki/atago_kinue", "name": "Atago Kinue", "desc": "", "class": "v13 atago-kinue"},
    {"id": "saki/funakubo_hiroko", "name": "Funakubo Hiroko", "desc": "", "class": "v13 funakubo-hiroko"},
    {"id": "saki/iwadate_yuan", "name": "Iwadate Yuan", "desc": "", "class": "v13 iwadate-yuan"},
    {"id": "saki/motouchi_naruka", "name": "Motouchi Naruka", "desc": "", "class": "v13 motouchi-naruka"},
    {"id": "saki/shishihara_sawaya", "name": "Shishihara Sawaya", "desc": "", "class": "v13 shishihara-sawaya"},
    {"id": "saki/suehara_kyouko", "name": "Suehara Kyouko", "desc": "", "class": "v13 suehara-kyouko"},
    {"id": "saki/ueshige_suzu", "name": "Ueshige Suzu", "desc": "", "class": "v13 ueshige-suzu"},
    {"id": "saki/yae_kobashiri", "name": "Yae Kobashiri", "desc": "", "class": "v13 yae-kobashiri"},
    {"id": "saki/yoshitome_miharu", "name": "Yoshitome Miharu", "desc": "", "class": "v13 yoshitome-miharu"},
    "Saki Mods",
    {"id": "persistent_saki_cards", "name": "Persistent Cards", "desc": "The character card you choose at the beginning is your card for the whole game."},
    {"id": "two_saki_cards", "name": "Two Saki Cards", "desc": "You draft two character cards instead of one. This mode is unsupported by the developers of Sakicards, but let's see what happens."},
    "Other",
    {"id": "show_waits", "name": "Show Waits", "desc": "Add some UI that shows waits."},
    {"id": "open_hands", "name": "Open Hands", "desc": "Everyone plays with tiles shown."},
    {"id": "ten", "name": "Ten", "desc": "Adds 10m, 10p, and 10s. Changes dora accordingly (if dora is enabled). Tanyao now allows nines, and chanta/junchan/honroutou require tens instead. 13 Orphans now requires the ten instead of the nine of each suit. Ittsu is unchanged."},
    {"id": "star_suit", "name": "Star Suit (beta)", "desc": "Adds a fourth suit (stars). This suit does not form yaku. This mod is in beta because we should probably write some yaku for it."},
    {"id": "space", "name": "Space Mahjong", "desc": "Sequences can wrap (891, 912). Winds and dragons can make sequences. You can chii from any direction. Chiitoitsu is disabled. Open kokushi is allowed and worth 3 han."},
    {"id": "galaxy", "conflicts": ["chinitsu"], "name": "Galaxy Mahjong", "desc": "Replaces one of each tile with a blue 'galaxy' tile that acts as a wildcard of its number. For example, galaxy 3s can be used as 3m, 3p, or 3s. Galaxy winds are wind wildcards, and galaxy dragons are dragon wildcards."},
    {"id": "fifth_tile", "conflicts": ["chinitsu"], "name": "Fifth Tile", "desc": "Adds a fifth copy of every standard tile."},
    {"id": "no_honors", "conflicts": ["shiro_pocchi", "golden_chun", "blue_dragon"], "name": "No Honors", "desc": "Removes the honor tiles (winds and dragons) from the game."},
    {"id": "shiro_pocchi", "conflicts": ["no_honors", "chinitsu"], "name": "Shiro Pocchi", "desc": "One of the white dragons is shiro pocchi. Shiro pocchi acts a joker tile when drawn while in riichi."},
    {"id": "golden_chun", "deps": ["shiro_pocchi"], "conflicts": ["no_honors", "chinitsu"], "name": "Golden Chun", "desc": "One of each dragon tile is a special tile. The special white dragon is shiro pocchi, which acts a joker tile when drawn while in riichi. The special green dragon is an aka dora. The special red dragon is the golden chun, which acts as a joker for any five, and grants 1 han when used as a five. Completing a hand via shiro pocchi while using the golden chun as a five and having the aka green dragon scores yakuman."},
    {"id": "blue_dragon", "conflicts": ["no_honors", "chinitsu"], "name": "Blue Dragon (beta)", "desc": "Adds the Chinese blue-framed white dragon as a fourth dragon tile (hakuban). Yaku treats it as an honor tile. Shousangen is reduced to 1 han (+2 from dragons) and Daisangen is reduced to 2 han (+3 from dragons). Adds Shousuugen (3 dragons + dragon pair) as yakuman and Daisuugen (4 dragons) as double yakuman. This mod is in beta because pao is not yet implemented for blue dragon."},
    {"id": "shouhai", "name": "Shouhai", "desc": "Reduces tiles in hand from 13 to 12. The goal is to achieve a tenpai hand rather than a winning hand. The idea is that your 13th tile is replaced with an invisible 'joker' tile that can be used to complete any hand."},
    {"id": "chinitsu", "conflicts": ["galaxy", "fifth_tile", "shiro_pocchi", "golden_chun", "blue_dragon"], "name": "Chinitsu", "desc": "Replace the wall with 16 copies of each bamboo tile. Includes 10s if Ten is enabled."},
    {"id": "calls_are_forced", "name": "Calls Are Forced", "desc": "Forces you to make all available calls, including riichi. You still get to choose if multiple calls are available."}
  ],
  "display_name": "Sakicards v1.3",
  "tutorial_link": "https://docs.google.com/document/d/1y4Os-PJJQ5vMuc9hFbck_IcXItHmCHTjMlRNbHJu0gw/edit",
  "enable_saki_cards": true,
  "saki_ver": "v13",
  "saki_deck": [],
  "wall": ["1m", "1m", "1m", "1m",
           "2m", "2m", "2m", "2m",
           "3m", "3m", "3m", "3m",
           "4m", "4m", "4m", "4m",
           "0m", "5m", "5m", "5m",
           "6m", "6m", "6m", "6m",
           "7m", "7m", "7m", "7m",
           "8m", "8m", "8m", "8m",
           "9m", "9m", "9m", "9m",
           "1p", "1p", "1p", "1p",
           "2p", "2p", "2p", "2p",
           "3p", "3p", "3p", "3p",
           "4p", "4p", "4p", "4p",
           "0p", "5p", "5p", "5p",
           "6p", "6p", "6p", "6p",
           "7p", "7p", "7p", "7p",
           "8p", "8p", "8p", "8p",
           "9p", "9p", "9p", "9p",
           "1s", "1s", "1s", "1s",
           "2s", "2s", "2s", "2s",
           "3s", "3s", "3s", "3s",
           "4s", "4s", "4s", "4s",
           "0s", "5s", "5s", "5s",
           "6s", "6s", "6s", "6s",
           "7s", "7s", "7s", "7s",
           "8s", "8s", "8s", "8s",
           "9s", "9s", "9s", "9s",
           "1z", "1z", "1z", "1z",
           "2z", "2z", "2z", "2z",
           "3z", "3z", "3z", "3z",
           "4z", "4z", "4z", "4z",
           "5z", "5z", "5z", "5z",
           "6z", "6z", "6z", "6z",
           "7z", "7z", "7z", "7z"],
  "reserved_tiles": [
    "kandraw_1", "kandraw_2",
    "kandraw_3", "kandraw_4"
  ],
  "revealed_tiles": [-6],
  "dora_indicators": {
    "1m": ["2m"],
    "2m": ["3m"],
    "3m": ["4m"],
    "4m": ["5m"],
    "5m": ["6m"],
    "6m": ["7m"],
    "7m": ["8m"],
    "8m": ["9m"],
    "9m": ["1m"],
    "0m": ["6m"],
    "1p": ["2p"],
    "2p": ["3p"],
    "3p": ["4p"],
    "4p": ["5p"],
    "5p": ["6p"],
    "6p": ["7p"],
    "7p": ["8p"],
    "8p": ["9p"],
    "9p": ["1p"],
    "0p": ["6p"],
    "1s": ["2s"],
    "2s": ["3s"],
    "3s": ["4s"],
    "4s": ["5s"],
    "5s": ["6s"],
    "6s": ["7s"],
    "7s": ["8s"],
    "8s": ["9s"],
    "9s": ["1s"],
    "0s": ["6s"],
    "1z": ["2z"],
    "2z": ["3z"],
    "3z": ["4z"],
    "4z": ["1z"],
    "5z": ["6z"],
    "6z": ["7z"],
    "7z": ["5z"]
  },
  "reverse_dora_indicators": {
    "1m": ["9m"],
    "2m": ["1m"],
    "3m": ["2m"],
    "4m": ["3m"],
    "5m": ["4m"],
    "6m": ["5m"],
    "7m": ["6m"],
    "8m": ["7m"],
    "9m": ["8m"],
    "0m": ["4m"],
    "1p": ["9p"],
    "2p": ["1p"],
    "3p": ["2p"],
    "4p": ["3p"],
    "5p": ["4p"],
    "6p": ["5p"],
    "7p": ["6p"],
    "8p": ["7p"],
    "9p": ["8p"],
    "0p": ["4p"],
    "1s": ["9s"],
    "2s": ["1s"],
    "3s": ["2s"],
    "4s": ["3s"],
    "5s": ["4s"],
    "6s": ["5s"],
    "7s": ["6s"],
    "8s": ["7s"],
    "9s": ["8s"],
    "0s": ["4s"],
    "1z": ["4z"],
    "2z": ["1z"],
    "3z": ["2z"],
    "4z": ["3z"],
    "5z": ["7z"],
    "6z": ["5z"],
    "7z": ["6z"]
  },
  "max_revealed_tiles": 5,
  "set_definitions": {
    "pair": [0, 0],
    "shuntsu": [0, 1, 2],
    "koutsu": [0, 0, 0],
    "quad": [0, 0, 0, 0],
    "ryanmen/penchan": [0, 1],
    "kanchan": [0, 2],
    "iipeikou": [0, 0, 1, 1, 2, 2],
    "ittsu": [[0,1,2],[3,4,5],[6,7,8]],
    "sanshoku_doujun": [[0,1,2],[10,11,12],[20,21,22]],
    "sanshoku_doukou": [[0,0,0],[10,10,10],[20,20,20]],
    "ton": ["1z", "1z", "1z"],
    "nan": ["2z", "2z", "2z"],
    "shaa": ["3z", "3z", "3z"],
    "pei": ["4z", "4z", "4z"],
    "haku": ["5z", "5z", "5z"],
    "hatsu": ["6z", "6z", "6z"],
    "chun": ["7z", "7z", "7z"],
    "ton_pair": ["1z", "1z"],
    "nan_pair": ["2z", "2z"],
    "shaa_pair": ["3z", "3z"],
    "pei_pair": ["4z", "4z"],
    "haku_pair": ["5z", "5z"],
    "hatsu_pair": ["6z", "6z"],
    "chun_pair": ["7z", "7z"],
    "junchan_1": ["1m","1m","1m"],
    "junchan_2": ["1p","1p","1p"],
    "junchan_3": ["1s","1s","1s"],
    "junchan_4": ["1m","2m","3m"],
    "junchan_5": ["1p","2p","3p"],
    "junchan_6": ["1s","2s","3s"],
    "junchan_7": ["7m","8m","9m"],
    "junchan_8": ["7p","8p","9p"],
    "junchan_9": ["7s","8s","9s"],
    "junchan_10": ["9m","9m","9m"],
    "junchan_11": ["9p","9p","9p"],
    "junchan_12": ["9s","9s","9s"],
    "junchan_pair_1": ["1m","1m"],
    "junchan_pair_2": ["1p","1p"],
    "junchan_pair_3": ["1s","1s"],
    "junchan_pair_4": ["9m","9m"],
    "junchan_pair_5": ["9p","9p"],
    "junchan_pair_6": ["9s","9s"],
    "orphans_all": ["1m","9m","1p","9p","1s","9s","1z","2z","3z","4z","5z","6z","7z"],
    "orphans_1": ["1m","9m","1p","9p","1s","9s","1z","2z","3z","4z","5z","6z"],
    "orphans_2": ["1m","9m","1p","9p","1s","9s","1z","2z","3z","4z","5z","7z"],
    "orphans_3": ["1m","9m","1p","9p","1s","9s","1z","2z","3z","4z","6z","7z"],
    "orphans_4": ["1m","9m","1p","9p","1s","9s","1z","2z","3z","5z","6z","7z"],
    "orphans_5": ["1m","9m","1p","9p","1s","9s","1z","2z","4z","5z","6z","7z"],
    "orphans_6": ["1m","9m","1p","9p","1s","9s","1z","3z","4z","5z","6z","7z"],
    "orphans_7": ["1m","9m","1p","9p","1s","9s","2z","3z","4z","5z","6z","7z"],
    "orphans_8": ["1m","9m","1p","9p","1s","1z","2z","3z","4z","5z","6z","7z"],
    "orphans_9": ["1m","9m","1p","9p","9s","1z","2z","3z","4z","5z","6z","7z"],
    "orphans_10": ["1m","9m","1p","1s","9s","1z","2z","3z","4z","5z","6z","7z"],
    "orphans_11": ["1m","9m","9p","1s","9s","1z","2z","3z","4z","5z","6z","7z"],
    "orphans_12": ["1m","1p","9p","1s","9s","1z","2z","3z","4z","5z","6z","7z"],
    "orphans_13": ["9m","1p","9p","1s","9s","1z","2z","3z","4z","5z","6z","7z"],
    "chuurenpoutou": [0,0,0,1,2,3,4,5,6,7,8,8,8]
  },
  "tenpai_definition": [
    [ "exhaustive", [["pair"], 1], [["ryanmen/penchan", "kanchan", "pair"], 1], [["shuntsu", "koutsu"], 3] ],
    [ "exhaustive", [["shuntsu", "koutsu"], 4] ],
    [ [["nojoker", "koutsu"], -1], [["pair"], 6] ],
    [ "unique",
      [["1m","9m","1p","9p","1s","9s","1z","2z","3z","4z","5z","6z","7z"], 12],
      [["1m","9m","1p","9p","1s","9s","1z","2z","3z","4z","5z","6z","7z"], 1]
    ]
  ],
  "iishanten_definition": [
    [ "exhaustive", [["pair"], 1], [["ryanmen/penchan", "kanchan", "pair"], 2], [["shuntsu", "koutsu"], 2] ],
    [ "exhaustive", [["ryanmen/penchan", "kanchan", "pair"], 1], [["shuntsu", "koutsu"], 3] ],
    [ [["quad"], -1], [["koutsu"], -2], [["pair"], 5] ],
    [ "unique",
      [["1m","9m","1p","9p","1s","9s","1z","2z","3z","4z","5z","6z","7z"], 11],
      [["1m","9m","1p","9p","1s","9s","1z","2z","3z","4z","5z","6z","7z"], 1]
    ]
  ],
  "ryanshanten_definition": [
    [ "exhaustive", [["pair"], 1], [["ryanmen/penchan", "kanchan", "pair"], 3], [["shuntsu", "koutsu"], 1] ],
    [ "exhaustive", [["ryanmen/penchan", "kanchan", "pair"], 3], [["shuntsu", "koutsu"], 2] ],
    [ "exhaustive", [["pair"], 1], [["ryanmen/penchan", "kanchan", "pair"], 1], [["shuntsu", "koutsu"], 2] ],
    [ "exhaustive", [["shuntsu", "koutsu"], 3] ],
    [ [["pair"], 4] ],
    [ "unique",
      [["1m","9m","1p","9p","1s","9s","1z","2z","3z","4z","5z","6z","7z"], 10],
      [["1m","9m","1p","9p","1s","9s","1z","2z","3z","4z","5z","6z","7z"], 1]
    ]
  ],
  "sanshanten_definition": [
    [ "exhaustive", [["pair"], 1], [["ryanmen/penchan", "kanchan", "pair"], 4] ],
    [ "exhaustive", [["pair"], 1], [["ryanmen/penchan", "kanchan", "pair"], 2], [["shuntsu", "koutsu"], 1] ],
    [ "exhaustive", [["ryanmen/penchan", "kanchan", "pair"], 4], [["shuntsu", "koutsu"], 1] ],
    [ "exhaustive", [["ryanmen/penchan", "kanchan", "pair"], 1], [["shuntsu", "koutsu"], 2] ],
    [ "exhaustive", [["shuntsu", "koutsu"], 3] ],
    [ [["pair"], 3] ],
    [ "unique",
      [["1m","9m","1p","9p","1s","9s","1z","2z","3z","4z","5z","6z","7z"], 9],
      [["1m","9m","1p","9p","1s","9s","1z","2z","3z","4z","5z","6z","7z"], 1]
    ]
  ],
  "tenpai_14_definition": [
    [ "exhaustive", [["pair"], 1], [["ryanmen/penchan", "kanchan", "pair"], 1], [["shuntsu", "koutsu"], 3] ],
    [ "exhaustive", [["shuntsu", "koutsu"], 4] ],
    [ [["quad"], -1], [["koutsu"], -2], [["pair"], 6] ],
    [ "unique",
      [["1m","9m","1p","9p","1s","9s","1z","2z","3z","4z","5z","6z","7z"], 12],
      [["1m","9m","1p","9p","1s","9s","1z","2z","3z","4z","5z","6z","7z"], 1]
    ]
  ],
  "pair_wait_definition": [
    [ "exhaustive", [["shuntsu", "koutsu"], 4] ],
    [ [["nojoker", "koutsu"], -1], [["pair"], 6] ]
  ],
  "kokushi_tenpai_definition": [
    [ "unique",
      [["1m","9m","1p","9p","1s","9s","1z","2z","3z","4z","5z","6z","7z"], 12],
      [["1m","9m","1p","9p","1s","9s","1z","2z","3z","4z","5z","6z","7z"], 1]
    ]
  ],
  "kyuushu_kyuuhai_definition": [
    [ "unique", [["1m","9m","1p","9p","1s","9s","1z","2z","3z","4z","5z","6z","7z"], 9] ]
  ],
  "win_definition": [
    [ "exhaustive", [["pair"], 1], [["shuntsu", "koutsu"], 4] ],
    [ [["nojoker", "quad"], -1], [["pair"], 7] ],
    [ "unique",
      [["1m","9m","1p","9p","1s","9s","1z","2z","3z","4z","5z","6z","7z"], 13],
      [["1m","9m","1p","9p","1s","9s","1z","2z","3z","4z","5z","6z","7z"], 1]
    ]
  ],
  "standard_win_definition": [
    [ "exhaustive", [["pair"], 1], [["shuntsu", "koutsu"], 4] ]
  ],
  "shousuushii_definition": [
    [[["ton"], 1], [["nan"], 1], [["shaa"], 1], [["pei_pair"], 1]],
    [[["ton"], 1], [["nan"], 1], [["shaa_pair"], 1], [["pei"], 1]],
    [[["ton"], 1], [["nan_pair"], 1], [["shaa"], 1], [["pei"], 1]],
    [[["ton_pair"], 1], [["nan"], 1], [["shaa"], 1], [["pei"], 1]]
  ],
  "daisuushii_definition": [
    [[["ton"], 1], [["nan"], 1], [["shaa"], 1], [["pei"], 1]]
  ],
  "sanankou_tsumo_definition": [
    // 0 open triplets, hand must be 3 triplets and a pair
    [ [["pon", "daiminkan", "kakan"], -1], [["koutsu"], 3], [["shuntsu", "koutsu"], 1], [["pair"], 1] ],
    // 0-1 open triplets, hand must be 4 triplets and a pair
    [ [["pon", "daiminkan", "kakan"], -2], [["koutsu"], 4], [["pair"], 1] ]
  ],
  "sanankou_ron_definition": [
    // 0 open triplets, hand must be 3 triplets and a pair
    [ "exhaustive", [["pon", "daiminkan", "kakan"], -1], [["koutsu"], 3], [[{"tile": "any", "attrs": ["winning_tile"]}], 0], [["shuntsu", "koutsu"], 1], [["pair"], 1] ],
    // 0-1 open triplets, hand must be 4 triplets and a pair
    [ "exhaustive", [["pon", "daiminkan", "kakan"], -2], [["koutsu"], 4], [[{"tile": "any", "attrs": ["winning_tile"]}], 0], [["pair"], 1] ]
  ],
  "kakura_kurumi_tenpai_definition": [
    [ [["quad"], -1], [["koutsu"], -2], [["pair"], -6], [["pair"], 5] ]
  ],
  "kakura_kurumi_win_definition": [
    [ [["nojoker", "koutsu"], -1], [["pair"], 6] ]
  ],
  "雜龍_definition": [
    [ "exhaustive", [[[[0,1,2],[13,14,15],[26,27,28]]], 1], [["shuntsu", "koutsu"], 1], [["pair"], 1] ],
    [ "exhaustive", [[[[0,1,2],[23,24,25],[16,17,18]]], 1], [["shuntsu", "koutsu"], 1], [["pair"], 1] ]
  ],
  "三色三步高_definition": [
    [ "exhaustive", [[[[0,1,2],[11,12,13],[22,23,24]]], 1], [["shuntsu", "koutsu"], 1], [["pair"], 1] ],
    [ "exhaustive", [[[[0,1,2],[21,22,23],[12,13,14]]], 1], [["shuntsu", "koutsu"], 1], [["pair"], 1] ]
  ],
  "一色三步高_definition": [
    [ "exhaustive", [[[[0,1,2],[1,2,3],[2,3,4]]], 1], [["shuntsu", "koutsu"], 1], [["pair"], 1] ]
  ],
  "golden_chun_77z_win_definition": [
    [ "exhaustive", [["chun_pair"], 1], [["shuntsu", "koutsu"], 4] ],
    [ [["chun_pair"], 1], [["pair"], 6] ]
  ],
  "golden_chun_777z_win_definition": [
    [ "exhaustive", [["chun"], 1], [["pair"], 1], [["shuntsu", "koutsu"], 3] ]
  ],
  "yaku": [
    { "display_name": "Riichi", "value": 1, "when": [{"name": "status", "opts": ["riichi"]}] },
    { "display_name": "Tsumo", "value": 1, "when": ["won_by_draw", {"name": "has_no_call_named", "opts": ["chii", "pon", "daiminkan", "kakan"]}] },
    { "display_name": "Chankan", "value": 1, "when": ["won_by_call"] },
    { "display_name": "Rinshan", "value": 1, "when": [{"name": "status", "opts": ["kan"]}] },
    { "display_name": "Haitei", "value": 1, "when": ["no_tiles_remaining", "won_by_draw"] },
    { "display_name": "Houtei", "value": 1, "when": ["no_tiles_remaining", "not_won_by_draw"] },
    {
      "display_name": "Pinfu",
      "value": 1,
      "when": [
        {"name": "has_no_call_named", "opts": ["chii", "pon", "daiminkan", "kakan"]},
        {"name": "match", "opts": [["hand", "calls", "winning_tile"], ["standard_win"]]},
        [["won_by_draw", {"name": "fu_equals", "opts": [20]}], ["not_won_by_draw", {"name": "fu_equals", "opts": [30]}]]
      ]
    },
    { "display_name": "Tanyao", "value": 1, "when": [{"name": "winning_hand_consists_of", "opts": ["2m","3m","4m","5m","6m","7m","8m","2p","3p","4p","5p","6p","7p","8p","2s","3s","4s","5s","6s","7s","8s"]}] },
    {
      "display_name": "Iipeikou",
      "value": 1,
      "when": [
        {"name": "has_no_call_named", "opts": ["chii", "pon", "daiminkan", "kakan"]},
        {"name": "match", "opts": [["hand", "calls", "winning_tile"], [[ "exhaustive", [["iipeikou"], 1], [["shuntsu", "koutsu"], 2], [["pair"], 1] ]]]}
      ]
    },
    { "display_name": "Haku", "value": 1, "when": [{"name": "match", "opts": [["hand", "calls", "winning_tile"], [[[["haku"], 1]]]]}] },
    { "display_name": "Hatsu", "value": 1, "when": [{"name": "match", "opts": [["hand", "calls", "winning_tile"], [[[["hatsu"], 1]]]]}] },
    { "display_name": "Chun", "value": 1, "when": [{"name": "match", "opts": [["hand", "calls", "winning_tile"], [[[["chun"], 1]]]]}] },
    { "display_name": "Round Wind", "value": "round_wind", "when": [{"name": "counter_at_least", "opts": ["round_wind", 1]}] },
    { "display_name": "Seat Wind", "value": "seat_wind", "when": [{"name": "counter_at_least", "opts": ["seat_wind", 1]}] },
    { "display_name": "Double Riichi", "value": 2, "when": [{"name": "status", "opts": ["double_riichi"]}] },
    { "display_name": "Chiitoitsu", "value": 2, "when": [{"name": "match", "opts": [["hand", "winning_tile"], [[[["quad"], -1], [["pair"], 7]]]]}] },
    {
      "display_name": "Chanta",
      "value": 1,
      "when": [
        {"name": "match", "opts": [["hand", "calls", "winning_tile"], [[
          [["junchan_1", "junchan_2", "junchan_3", "junchan_4", "junchan_5", "junchan_6", "junchan_7", "junchan_8", "junchan_9", "junchan_10", "junchan_11", "junchan_12", "ton", "nan", "shaa", "pei", "haku", "hatsu", "chun"], 4],
          [["junchan_pair_1", "junchan_pair_2", "junchan_pair_3", "junchan_pair_4", "junchan_pair_5", "junchan_pair_6", "ton_pair", "nan_pair", "shaa_pair", "pei_pair", "haku_pair", "hatsu_pair", "chun_pair"], 1]
        ]]]}
      ]
    },
    { "display_name": "Ittsu", "value": 1, "when": [{"name": "match", "opts": [["hand", "calls", "winning_tile"], [["exhaustive", [["ittsu"], 1], [["shuntsu", "koutsu"], 1], [["pair"], 1] ]]]}] },
    { "display_name": "Sanshoku", "value": 1, "when": [{"name": "match", "opts": [["hand", "calls", "winning_tile"], [["exhaustive", [["sanshoku_doujun"], 1], [["shuntsu", "koutsu"], 1], [["pair"], 1] ]]]}] },
    { "display_name": "Sanshoku Doukou", "value": 2, "when": [{"name": "match", "opts": [["hand", "calls", "winning_tile"], [["exhaustive", [["sanshoku_doukou"], 1], [["shuntsu", "koutsu"], 1], [["pair"], 1] ]]]}] },
    { "display_name": "Sankantsu", "value": 2, "when": [{"name": "match", "opts": [["hand", "calls", "winning_tile"], [[ [["daiminkan", "ankan", "kakan"], 3] ]]]}] },
    { "display_name": "Toitoi", "value": 2, "when": [{"name": "match", "opts": [["hand", "calls", "winning_tile"], [[ [["koutsu"], 4], [["pair"], 1] ]]]}] },
    {
      "display_name": "Sanankou",
      "value": 2,
      "when": [[
        ["won_by_draw", {"name": "match", "opts": [["hand", "calls", "winning_tile"], ["sanankou_tsumo"]]}],
        ["not_won_by_draw", {"name": "match", "opts": [["hand", "calls", "winning_tile"], ["sanankou_ron"]]}]
      ]]
    },
    { "display_name": "Shousangen", "value": 2, "when": [{"name": "match", "opts": [["hand", "calls", "winning_tile"], [[ [["haku", "hatsu", "chun"], 2], [["haku_pair", "hatsu_pair", "chun_pair"], 1] ]]]}] },
    { "display_name": "Honroutou", "value": 2, "when": [{"name": "winning_hand_consists_of", "opts": ["1m","9m","1p","9p","1s","9s","1z","2z","3z","4z","5z","6z","7z"]}] },
    { "display_name": "Ryanpeikou", "value": 3, "when": [{"name": "match", "opts": [["hand", "calls", "winning_tile"], [[ "exhaustive", [["iipeikou"], 2], [["pair"], 1] ]]]}] },
    {
      "display_name": "Junchan",
      "value": 2,
      "when": [
        {"name": "match", "opts": [["hand", "calls", "winning_tile"], [[
          [["junchan_1", "junchan_2", "junchan_3", "junchan_4", "junchan_5", "junchan_6", "junchan_7", "junchan_8", "junchan_9", "junchan_10", "junchan_11", "junchan_12"], 4],
          [["junchan_pair_1", "junchan_pair_2", "junchan_pair_3", "junchan_pair_4", "junchan_pair_5", "junchan_pair_6"], 1]
        ]]]}
      ]
    },
    {
      "display_name": "Honitsu",
      "value": 2,
      "when": [[
        {"name": "winning_hand_consists_of", "opts": ["1m","2m","3m","4m","5m","6m","7m","8m","9m","1z","2z","3z","4z","5z","6z","7z"]},
        {"name": "winning_hand_consists_of", "opts": ["1p","2p","3p","4p","5p","6p","7p","8p","9p","1z","2z","3z","4z","5z","6z","7z"]},
        {"name": "winning_hand_consists_of", "opts": ["1s","2s","3s","4s","5s","6s","7s","8s","9s","1z","2z","3z","4z","5z","6z","7z"]}
      ]]
    },
    {
      "display_name": "Chinitsu",
      "value": 5,
      "when": [[
        {"name": "winning_hand_consists_of", "opts": ["1m","2m","3m","4m","5m","6m","7m","8m","9m"]},
        {"name": "winning_hand_consists_of", "opts": ["1p","2p","3p","4p","5p","6p","7p","8p","9p"]},
        {"name": "winning_hand_consists_of", "opts": ["1s","2s","3s","4s","5s","6s","7s","8s","9s"]}
      ]]
    },
    { "display_name": "Inazuma Riichi", "value": 5, "when": [{"name": "status", "opts": ["inazuma_riichi"]}] },
    { "display_name": "Chasing Riichi", "value": 2, "when": [{"name": "status", "opts": ["anetai-toyone"]}, {"name": "status", "opts": ["chasing"]}] },
    { "display_name": "Chasing Riichi", "value": 1, "when": [{"name": "status", "opts": ["anetai-toyone"]}, {"name": "status", "opts": ["chasing"]}, {"name": "discarder_status", "opts": ["riichi"]}] },
    { "display_name": "Shiiaru Raotai", "value": 2, "when": [{"name": "status", "opts": ["anetai-toyone"]}, {"name": "match", "opts": [["calls"], [[[["chii", "pon", "daiminkan", "kakan", "ankan"], 4]]]]}] },
    { "display_name": "All Fives", "value": 1, "when": [{"name": "status", "opts": ["hao-huiyu"]}, {"name": "match", "opts": [["hand", "calls", "winning_tile"], [["exhaustive", [[["5m","5m"],["5p","5p"],["5s","5s"]], 1], [[["5m","5m","5m"],["5p","5p","5p"],["5s","5s","5s"],["3m","4m","5m"],["3p","4p","5p"],["3s","4s","5s"],["4m","5m","6m"],["4p","5p","6p"],["4s","5s","6s"],["5m","6m","7m"],["5p","6p","7p"],["5s","6s","7s"]], 4]]]]}] },
    { "display_name": "Upper Four", "value": 1, "when": [{"name": "status", "opts": ["hao-huiyu"]}, {"name": "winning_hand_consists_of", "opts": ["6m","7m","8m","9m","6p","7p","8p","9p","6s","7s","8s","9s"]}] },
    { "display_name": "Lower Four", "value": 1, "when": [{"name": "status", "opts": ["hao-huiyu"]}, {"name": "winning_hand_consists_of", "opts": ["1m","2m","3m","4m","1p","2p","3p","4p","1s","2s","3s","4s"]}] },
    { "display_name": "Mixed Straight", "value": 1, "when": [{"name": "status", "opts": ["hao-huiyu"]}, {"name": "match", "opts": [["hand", "calls", "winning_tile"], ["雜龍"]]}] },
    { "display_name": "Mixed Shifted Chows", "value": 1, "when": [{"name": "status", "opts": ["hao-huiyu"]}, {"name": "match", "opts": [["hand", "calls", "winning_tile"], ["三色三步高"]]}] },
    { "display_name": "Pure Shifted Chows", "value": 1, "when": [{"name": "status", "opts": ["hao-huiyu"]}, {"name": "match", "opts": [["hand", "calls", "winning_tile"], ["一色三步高"]]}] },
    { "display_name": "Riichi", "value": 1, "when": [{"name": "status", "opts": ["yae_kobashiri_double_riichi"]}] },
    { "display_name": "Uumensai", "value": 2, "when": [{"name": "status", "opts": ["kainou-yoshiko", "uumensai"]}] }
  ],
  "meta_yaku": [
    // closed hand or being someya mako upgrades certain yaku
    { "display_name": "Chanta", "value": 1, "when": [[{"name": "has_no_call_named", "opts": ["chii", "pon", "daiminkan", "kakan"]}, {"name": "status", "opts": ["someya-mako"]}], {"name": "has_existing_yaku", "opts": ["Chanta"]}] },
    { "display_name": "Ittsu", "value": 1, "when": [[{"name": "has_no_call_named", "opts": ["chii", "pon", "daiminkan", "kakan"]}, {"name": "status", "opts": ["someya-mako"]}], {"name": "has_existing_yaku", "opts": ["Ittsu"]}] },
    { "display_name": "Sanshoku", "value": 1, "when": [[{"name": "has_no_call_named", "opts": ["chii", "pon", "daiminkan", "kakan"]}, {"name": "status", "opts": ["someya-mako"]}], {"name": "has_existing_yaku", "opts": ["Sanshoku"]}] },
    { "display_name": "Junchan", "value": 1, "when": [[{"name": "has_no_call_named", "opts": ["chii", "pon", "daiminkan", "kakan"]}, {"name": "status", "opts": ["someya-mako"]}], {"name": "has_existing_yaku", "opts": ["Junchan"]}] },
    { "display_name": "Honitsu", "value": 1, "when": [[{"name": "has_no_call_named", "opts": ["chii", "pon", "daiminkan", "kakan"]}, {"name": "status", "opts": ["someya-mako"]}], {"name": "has_existing_yaku", "opts": ["Honitsu"]}] },
    { "display_name": "Chinitsu", "value": 1, "when": [[{"name": "has_no_call_named", "opts": ["chii", "pon", "daiminkan", "kakan"]}, {"name": "status", "opts": ["someya-mako"]}], {"name": "has_existing_yaku", "opts": ["Chinitsu"]}] },
    { "display_name": "All Fives", "value": 1, "when": [[{"name": "has_no_call_named", "opts": ["chii", "pon", "daiminkan", "kakan"]}, {"name": "status", "opts": ["someya-mako"]}], {"name": "has_existing_yaku", "opts": ["All Fives"]}] },
    { "display_name": "Upper Four", "value": 1, "when": [[{"name": "has_no_call_named", "opts": ["chii", "pon", "daiminkan", "kakan"]}, {"name": "status", "opts": ["someya-mako"]}], {"name": "has_existing_yaku", "opts": ["Upper Four"]}] },
    { "display_name": "Lower Four", "value": 1, "when": [[{"name": "has_no_call_named", "opts": ["chii", "pon", "daiminkan", "kakan"]}, {"name": "status", "opts": ["someya-mako"]}], {"name": "has_existing_yaku", "opts": ["Lower Four"]}] },
    { "display_name": "Mixed Straight", "value": 1, "when": [[{"name": "has_no_call_named", "opts": ["chii", "pon", "daiminkan", "kakan"]}, {"name": "status", "opts": ["someya-mako"]}], {"name": "has_existing_yaku", "opts": ["Mixed Straight"]}] },
    { "display_name": "Mixed Shifted Chows", "value": 1, "when": [[{"name": "has_no_call_named", "opts": ["chii", "pon", "daiminkan", "kakan"]}, {"name": "status", "opts": ["someya-mako"]}], {"name": "has_existing_yaku", "opts": ["Mixed Shifted Chows"]}] },
    { "display_name": "Pure Shifted Chows", "value": 1, "when": [[{"name": "has_no_call_named", "opts": ["chii", "pon", "daiminkan", "kakan"]}, {"name": "status", "opts": ["someya-mako"]}], {"name": "has_existing_yaku", "opts": ["Pure Shifted Chows"]}] },
    // haramura nodoka has double value for tanyao and pinfu
    { "display_name": "Tanyao", "value": 1, "when": [{"name": "status", "opts": ["haramura-nodoka"]}, {"name": "has_existing_yaku", "opts": ["Tanyao"]}, {"name": "has_no_call_named", "opts": ["chii", "pon", "daiminkan", "kakan"]}] },
    { "display_name": "Pinfu", "value": 1, "when": [{"name": "status", "opts": ["haramura-nodoka"]}, {"name": "has_existing_yaku", "opts": ["Pinfu"]}] },
    // kakura kurumi upgrades existing chiitoitsu by number of pairs in discard
    { "display_name": "Chiitoitsu", "value": "kakura_kurumi_pairs", "when": [{"name": "status", "opts": ["kakura-kurumi"]}, {"name": "has_existing_yaku", "opts": ["Chiitoitsu"]}] },
    // sawamura tomoki has better versions of tsumo/iipeikou/ryanpeikou
    { "display_name": "Tsumo", "value": 1, "when": [{"name": "status", "opts": ["sawamura-tomoki"]}, {"name": "has_existing_yaku", "opts": ["Tsumo"]}] },
    { "display_name": "Iipeikou", "value": 1, "when": [{"name": "status", "opts": ["sawamura-tomoki"]}, {"name": "has_existing_yaku", "opts": ["Iipeikou"]}] },
    { "display_name": "Ryanpeikou", "value": 2, "when": [{"name": "status", "opts": ["sawamura-tomoki"]}, {"name": "has_existing_yaku", "opts": ["Ryanpeikou"]}] },
    // jindai komaki has double value for riichi and ippatsu
    { "display_name": "Riichi", "value": 1, "when": [{"name": "status", "opts": ["jindai-komaki"]}, {"name": "has_existing_yaku", "opts": ["Riichi"]}] },
    { "display_name": "Ippatsu", "value": 1, "when": [{"name": "status", "opts": ["jindai-komaki"]}, {"name": "has_existing_yaku", "opts": ["Ippatsu"]}] },
    { "display_name": "Double Riichi", "value": 2, "when": [{"name": "status", "opts": ["jindai-komaki"]}, {"name": "has_existing_yaku", "opts": ["Double Riichi"]}] }
  ],
  "meta_yaku_2": [
    // all 1 han yaku is 2 han for last place ikeda kana
    { "display_name": "Riichi", "value": 1, "when": [{"name": "status", "opts": ["ikeda-kana"]}, {"name": "placement", "opts": [4]}, {"name": "has_existing_yaku", "opts": [["Riichi", 1]]}] },
    { "display_name": "Tsumo", "value": 1, "when": [{"name": "status", "opts": ["ikeda-kana"]}, {"name": "placement", "opts": [4]}, {"name": "has_existing_yaku", "opts": [["Tsumo", 1]]}] },
    { "display_name": "Ippatsu", "value": 1, "when": [{"name": "status", "opts": ["ikeda-kana"]}, {"name": "placement", "opts": [4]}, {"name": "has_existing_yaku", "opts": [["Ippatsu", 1]]}] },
    { "display_name": "Chankan", "value": 1, "when": [{"name": "status", "opts": ["ikeda-kana"]}, {"name": "placement", "opts": [4]}, {"name": "has_existing_yaku", "opts": [["Chankan", 1]]}] },
    { "display_name": "Rinshan", "value": 1, "when": [{"name": "status", "opts": ["ikeda-kana"]}, {"name": "placement", "opts": [4]}, {"name": "has_existing_yaku", "opts": [["Rinshan", 1]]}] },
    { "display_name": "Haitei", "value": 1, "when": [{"name": "status", "opts": ["ikeda-kana"]}, {"name": "placement", "opts": [4]}, {"name": "has_existing_yaku", "opts": [["Haitei", 1]]}] },
    { "display_name": "Houtei", "value": 1, "when": [{"name": "status", "opts": ["ikeda-kana"]}, {"name": "placement", "opts": [4]}, {"name": "has_existing_yaku", "opts": [["Houtei", 1]]}] },
    { "display_name": "Pinfu", "value": 1, "when": [{"name": "status", "opts": ["ikeda-kana"]}, {"name": "placement", "opts": [4]}, {"name": "has_existing_yaku", "opts": [["Pinfu", 1]]}] },
    { "display_name": "Tanyao", "value": 1, "when": [{"name": "status", "opts": ["ikeda-kana"]}, {"name": "placement", "opts": [4]}, {"name": "has_existing_yaku", "opts": [["Tanyao", 1]]}] },
    { "display_name": "Iipeikou", "value": 1, "when": [{"name": "status", "opts": ["ikeda-kana"]}, {"name": "placement", "opts": [4]}, {"name": "has_existing_yaku", "opts": [["Iipeikou", 1]]}] },
    { "display_name": "Seat Wind", "value": 1, "when": [{"name": "status", "opts": ["ikeda-kana"]}, {"name": "placement", "opts": [4]}, {"name": "has_existing_yaku", "opts": [["Seat Wind", 1]]}] },
    { "display_name": "Round Wind", "value": 1, "when": [{"name": "status", "opts": ["ikeda-kana"]}, {"name": "placement", "opts": [4]}, {"name": "has_existing_yaku", "opts": [["Round Wind", 1]]}] },
    { "display_name": "Haku", "value": 1, "when": [{"name": "status", "opts": ["ikeda-kana"]}, {"name": "placement", "opts": [4]}, {"name": "has_existing_yaku", "opts": [["Haku", 1]]}] },
    { "display_name": "Hatsu", "value": 1, "when": [{"name": "status", "opts": ["ikeda-kana"]}, {"name": "placement", "opts": [4]}, {"name": "has_existing_yaku", "opts": [["Hatsu", 1]]}] },
    { "display_name": "Chun", "value": 1, "when": [{"name": "status", "opts": ["ikeda-kana"]}, {"name": "placement", "opts": [4]}, {"name": "has_existing_yaku", "opts": [["Chun", 1]]}] },
    { "display_name": "Chanta", "value": 1, "when": [{"name": "status", "opts": ["ikeda-kana"]}, {"name": "placement", "opts": [4]}, {"name": "has_existing_yaku", "opts": [["Chanta", 1]]}] },
    { "display_name": "Ittsu", "value": 1, "when": [{"name": "status", "opts": ["ikeda-kana"]}, {"name": "placement", "opts": [4]}, {"name": "has_existing_yaku", "opts": [["Ittsu", 1]]}] },
    { "display_name": "Sanshoku", "value": 1, "when": [{"name": "status", "opts": ["ikeda-kana"]}, {"name": "placement", "opts": [4]}, {"name": "has_existing_yaku", "opts": [["Sanshoku", 1]]}] },
    // senoo kaori gets 1 han for not having yaku
    { "display_name": "No Yaku", "value": 1, "when": [{"name": "status", "opts": ["senoo-kaori"]}, "has_no_yaku"] }
  ],
  "yakuman": [
    { "display_name": "Tenhou", "value": 1, "when": [{"name": "status", "opts": ["discards_empty"]}, {"name": "status_missing", "opts": ["call_made"]}, "won_by_draw", {"name": "seat_is", "opts": ["east"]}] },
    { "display_name": "Chiihou", "value": 1, "when": [{"name": "status", "opts": ["discards_empty"]}, {"name": "status_missing", "opts": ["call_made"]}, "won_by_draw", {"name": "not_seat_is", "opts": ["east"]}] },
    { "display_name": "Daisangen", "value": 1, "when": [{"name": "match", "opts": [["hand", "calls", "winning_tile"], [[[["haku"], 1], [["hatsu"], 1], [["chun"], 1]]]]}] },
    {
      "display_name": "Suuankou",
      "value": 1,
      "when": [
        "won_by_draw",
        {"name": "has_no_call_named", "opts": ["pon", "daiminkan", "kakan"]},
        {"name": "match", "opts": [["hand", "calls"], [[[["koutsu"], 3], [["pair"], 2]]]]}
      ]
    },
    {
      "display_name": "Suuankou Tanki",
      "value": 2,
      "when": [
        {"name": "has_no_call_named", "opts": ["pon", "daiminkan", "kakan"]},
        {"name": "match", "opts": [["hand", "calls"], [[[["koutsu"], 4]]]]}
      ]
    },
    { "display_name": "Tsuuiisou", "value": 1, "when": [{"name": "winning_hand_consists_of", "opts": ["1z","2z","3z","4z","5z","6z","7z"]}] },
    { "display_name": "Ryuuiisou", "value": 1, "when": [{"name": "winning_hand_consists_of", "opts": ["2s","3s","4s","6s","8s","6z"]}] },
    { "display_name": "Chinroutou", "value": 1, "when": [{"name": "winning_hand_consists_of", "opts": ["1m","9m","1p","9p","1s","9s"]}] },
    { "display_name": "Chuurenpoutou", "value": 1, "when": [{"name": "match", "opts": [["hand", "winning_tile"], [[[["chuurenpoutou"], 1]]]]}] },
    { "display_name": "Junsei Chuurenpoutou", "value": 2, "when": [{"name": "match", "opts": [["hand"], [[[["chuurenpoutou"], 1]]]]}] },
    { "display_name": "Kokushi Musou", "value": 1, "when": [{"name": "match", "opts": [["hand", "winning_tile"], [[[["orphans_all"], 1]]]]}] },
    { "display_name": "Kokushi Musou Juusan Menmachi", "value": 2, "when": [{"name": "match", "opts": [["hand"], [[[["orphans_all"], 1]]]]}] },
    { "display_name": "Daisuushii", "value": 2, "when": [{"name": "match", "opts": [["hand", "calls", "winning_tile"], ["daisuushii"]]}] },
    { "display_name": "Shousuushii", "value": 1, "when": [{"name": "match", "opts": [["hand", "calls", "winning_tile"], ["shousuushii"]]}] },
    { "display_name": "Suukantsu", "value": 1, "when": [{"name": "match", "opts": [["calls"], [[[["daiminkan", "ankan", "kakan"], 4]]]]}] }
  ],
  "meta_yakuman": [
    // tenhou upgrades certain yakuman to double yakuman
    { "display_name": "Suuankou Tanki", "value": 2, "when": [{"name": "not_has_existing_yaku", "opts": ["Suuankou Tanki"]}, {"name": "has_existing_yaku", "opts": ["Tenhou", "Suuankou"]}] },
    { "display_name": "Junsei Chuurenpoutou", "value": 2, "when": [{"name": "not_has_existing_yaku", "opts": ["Junsei Chuurenpoutou"]}, {"name": "has_existing_yaku", "opts": ["Tenhou", "Chuurenpoutou"]}] },
    { "display_name": "Kokushi Musou Juusan Menmachi", "value": 2, "when": [{"name": "not_has_existing_yaku", "opts": ["Kokushi Musou Juusan Menmachi"]}, {"name": "has_existing_yaku", "opts": ["Tenhou", "Kokushi Musou"]}] }
  ],
  "extra_yaku": [
    { "display_name": "Dora", "value": "dora", "when": [{"name": "counter_at_least", "opts": ["dora", 1]}] },
    { "display_name": "Aka", "value": "aka", "when": [{"name": "counter_at_least", "opts": ["aka", 1]}] },
    { "display_name": "Ura", "value": "ura", "when": [{"name": "counter_at_least", "opts": ["ura", 1]}] },
    { "display_name": "Reverse Dora", "value": "reverse_dora", "when": [{"name": "status", "opts": ["kosegawa-shiromi"]}, {"name": "has_no_call_named", "opts": ["chii", "pon", "daiminkan", "kakan"]}, {"name": "counter_at_least", "opts": ["reverse_dora", 1]}] },
    { "display_name": "Discarded Triplets", "value": "mase_yuuko_han", "when": [{"name": "status", "opts": ["mase-yuuko"]}, {"name": "counter_at_least", "opts": ["mase_yuuko_han", 1]}] },
    { "display_name": "Triplets", "value": "matano_seiko_han", "when": [{"name": "status", "opts": ["matano-seiko"]}, {"name": "counter_at_least", "opts": ["matano_seiko_han", 1]}] },
    { "display_name": "Warm Tiles", "value": 1, "when": [{"name": "status", "opts": ["matsumi-yuu"]}, {"name": "counter_at_least", "opts": ["warm_tiles", 9]}] },
    { "display_name": "Warm Tiles", "value": 1, "when": [{"name": "status", "opts": ["matsumi-yuu"]}, {"name": "counter_at_least", "opts": ["warm_tiles", 11]}] },
    { "display_name": "Warm Tiles", "value": 1, "when": [{"name": "status", "opts": ["matsumi-yuu"]}, {"name": "counter_at_least", "opts": ["warm_tiles", 13]}] },
    { "display_name": "Warm Tiles", "value": 1, "when": [{"name": "status", "opts": ["matsumi-yuu"]}, {"name": "counter_at_least", "opts": ["warm_tiles", 14]}] },
    { "display_name": "Reversible tiles", "value": 1, "when": [{"name": "status", "opts": ["sagimori-arata"]}, {"name": "counter_at_least", "opts": ["warm_tiles", 8]}] },
    { "display_name": "Reversible tiles", "value": 1, "when": [{"name": "status", "opts": ["sagimori-arata"]}, {"name": "counter_at_least", "opts": ["warm_tiles", 10]}] },
    { "display_name": "Reversible tiles", "value": 1, "when": [{"name": "status", "opts": ["sagimori-arata"]}, {"name": "counter_at_least", "opts": ["warm_tiles", 13]}] },
    { "display_name": "Reversible tiles", "value": 1, "when": [{"name": "status", "opts": ["sagimori-arata"]}, {"name": "counter_at_least", "opts": ["warm_tiles", 14]}] },
    { "display_name": "Three-Sided Wait", "value": 1, "when": [{"name": "status", "opts": ["sagimori-arata"]}, {"name": "wait_count_at_least", "opts": [3, ["win"]]}] },
    { "display_name": "Single Wait", "value": 2, "when": [{"name": "status", "opts": ["takei-hisa"]}, {"name": "wait_count_at_most", "opts": [1, ["win"]]}] },
    { "display_name": "Takimi Haru", "value": 1, "when": [{"name": "status", "opts": ["takimi-haru"]}, {"name": "winning_hand_consists_of", "opts": ["3m","4m","5m","6m","7m","3p","4p","5p","6p","7p","3s","4s","5s","6s","7s"]}] },
    { "display_name": "Furiten Tsumo", "value": 1, "when": [{"name": "status", "opts": ["atago-hiroe", "riichi", "furiten"]}, "won_by_draw"] },
    { "display_name": "Haku Tsumo", "value": 2, "when": [{"name": "status", "opts": ["karijuku-tomoe"]}, "won_by_draw", {"name": "match", "opts": [["winning_tile"], [[[["5z"], 1]]]]}] },
    { "display_name": "Nelly Virsaladze", "value": 1, "when": [{"name": "status", "opts": ["nelly-virsaladze"]}, {"name": "not_counter_equals", "opts": ["riichi_turn", 0]}, {"name": "counter_at_most", "opts": ["riichi_turn", 6]}] },
    { "display_name": "Nelly Virsaladze", "value": 1, "when": [{"name": "status", "opts": ["nelly-virsaladze"]}, {"name": "not_counter_equals", "opts": ["riichi_turn", 0]}, {"name": "counter_at_most", "opts": ["riichi_turn", 8]}] },
    { "display_name": "Nelly Virsaladze", "value": 1, "when": [{"name": "status", "opts": ["nelly-virsaladze"]}, {"name": "not_counter_equals", "opts": ["riichi_turn", 0]}, {"name": "counter_at_most", "opts": ["riichi_turn", 10]}] },
    { "display_name": "Facedown Tiles", "value": 1, "when": [{"name": "status", "opts": ["tsuruta-himeko"]}, {"name": "counter_at_least", "opts": ["facedown_tiles", 2]}] },
    { "display_name": "Facedown Tiles", "value": 1, "when": [{"name": "status", "opts": ["tsuruta-himeko"]}, {"name": "counter_at_least", "opts": ["facedown_tiles", 4]}] },
    { "display_name": "Facedown Tiles", "value": 1, "when": [{"name": "status", "opts": ["tsuruta-himeko"]}, {"name": "counter_at_least", "opts": ["facedown_tiles", 6]}] },
    { "display_name": "Facedown Tiles", "value": 1, "when": [{"name": "status", "opts": ["tsuruta-himeko"]}, {"name": "counter_at_least", "opts": ["facedown_tiles", 7]}] },
    { "display_name": "Facedown Tiles", "value": 1, "when": [{"name": "status", "opts": ["tsuruta-himeko"]}, {"name": "counter_at_least", "opts": ["facedown_tiles", 8]}] },
    { "display_name": "Facedown Tiles", "value": "kajiki_yumi_han", "when": [{"name": "status", "opts": ["kajiki-yumi"]}, {"name": "counter_at_least", "opts": ["kajiki_yumi_han", 1]}] },
    { "display_name": "Each 2000 Bet", "value": "shishihara_sawaya_han", "when": [{"name": "status", "opts": ["shishihara-sawaya", "riichi"]}, {"name": "counter_at_least", "opts": ["shishihara_sawaya_han", 1]}] },
    { "display_name": "Aside Tiles", "value": "ueshige_suzu_han", "when": [{"name": "status", "opts": ["ueshige-suzu"]}, {"name": "counter_at_least", "opts": ["ueshige_suzu_han", 1]}] },
    { "display_name": "Ryuuka Tsumo", "value": 1, "when": [{"name": "status", "opts": ["shimizudani-ryuuka"]}, "won_by_draw"] },
    { "display_name": "Aside Tiles", "value": 1, "when": [{"name": "status", "opts": ["suehara-kyouko"]}, {"name": "counter_at_least", "opts": ["aside_tiles", 3]}] },
    { "display_name": "Aside Tiles", "value": 1, "when": [{"name": "status", "opts": ["suehara-kyouko"]}, {"name": "counter_at_least", "opts": ["aside_tiles", 6]}] },
    { "display_name": "Aside Tiles", "value": 1, "when": [{"name": "status", "opts": ["suehara-kyouko"]}, {"name": "counter_at_least", "opts": ["aside_tiles", 9]}] },
    { "display_name": "Wind Melds", "value": "usuzumi_hatsumi_han", "when": [{"name": "status", "opts": ["usuzumi-hatsumi"]}, {"name": "counter_at_least", "opts": ["usuzumi_hatsumi_han", 1]}] },
    { "display_name": "Revealed Tiles", "value": "iwato_kasumi_han", "when": [{"name": "status", "opts": ["iwato-kasumi"]}, {"name": "counter_at_least", "opts": ["iwato_kasumi_han", 1]}] },
    { "display_name": "Voided Suit", "value": 1, "when": [{"name": "status", "opts": ["yoshitome-miharu", "yoshitome_miharu_han"]}] },
    { "display_name": "Voided Suit", "value": 1, "when": [{"name": "status", "opts": ["yoshitome-miharu", "yoshitome_miharu_double", "yoshitome_miharu_han"]}] },
    { "display_name": "Hirose Sumire", "value": 1, "when": [{"name": "status", "opts": ["hirose-sumire"]}, {"name": "discarder_status", "opts": ["discard_passed"]}] },
    {
      "display_name": "Hirose Sumire",
      "value": 1,
      "when": [
        {"name": "status", "opts": ["hirose-sumire"]},
        {"name": "discarder_status", "opts": ["discard_passed"]},
        [
          [
            {"name": "status", "opts": ["2nd_place"]},
            {"name": "discarder_status", "opts": ["1st_place"]}
          ],
          [
            {"name": "status", "opts": ["3rd_place"]},
            {"name": "discarder_status", "opts": ["1st_place"]}
          ],
          [
            {"name": "status", "opts": ["4th_place"]},
            {"name": "discarder_status", "opts": ["1st_place"]}
          ],
          [
            {"name": "status", "opts": ["3rd_place"]},
            {"name": "discarder_status", "opts": ["2nd_place"]}
          ],
          [
            {"name": "status", "opts": ["4th_place"]},
            {"name": "discarder_status", "opts": ["2nd_place"]}
          ],
          [
            {"name": "status", "opts": ["4th_place"]},
            {"name": "discarder_status", "opts": ["3rd_place"]}
          ]
        ]
      ]
    },
    {
      "display_name": "Four Suits",
      "value": 1,
      "when": [
        {"name": "status", "opts": ["kainou-yoshiko"]},
        {"name": "has_no_call_named", "opts": ["chii", "pon", "daiminkan", "kakan"]},
        [
          {"name": "match", "opts": [["hand", "calls", "winning_tile"], [
            [
              [["1m","2m","3m","4m","5m","6m","7m","8m","9m"], 1],
              [["1p","2p","3p","4p","5p","6p","7p","8p","9p"], 1],
              [["1s","2s","3s","4s","5s","6s","7s","8s","9s"], 1],
              [["1z","2z","3z","4z"], 1]
            ],
            [
              [["1m","2m","3m","4m","5m","6m","7m","8m","9m"], 1],
              [["1p","2p","3p","4p","5p","6p","7p","8p","9p"], 1],
              [["1s","2s","3s","4s","5s","6s","7s","8s","9s"], 1],
              [["5z","6z","7z"], 1]
            ],
            [
              [["1m","2m","3m","4m","5m","6m","7m","8m","9m"], 1],
              [["1p","2p","3p","4p","5p","6p","7p","8p","9p"], 1],
              [["1z","2z","3z","4z"], 1],
              [["5z","6z","7z"], 1]
            ],
            [
              [["1m","2m","3m","4m","5m","6m","7m","8m","9m"], 1],
              [["1s","2s","3s","4s","5s","6s","7s","8s","9s"], 1],
              [["1z","2z","3z","4z"], 1],
              [["5z","6z","7z"], 1]
            ],
            [
              [["1p","2p","3p","4p","5p","6p","7p","8p","9p"], 1],
              [["1s","2s","3s","4s","5s","6s","7s","8s","9s"], 1],
              [["1z","2z","3z","4z"], 1],
              [["5z","6z","7z"], 1]
            ]
          ]]}
        ]
      ]
    }
  ],
  "yaku_precedence": {
    "Double Riichi": ["Riichi"],
    "Chinitsu": ["Honitsu"],
    "Chiitoitsu": ["Iipeikou"],
    "Ryanpeikou": ["Iipeikou", "Chiitoitsu"],
    "Junchan": ["Chanta"],
    "Honroutou": ["Chanta", "Junchan"],
    "Suuankou Tanki": ["Suuankou"],
    "Junsei Chuurenpoutou": ["Chuurenpoutou"],
    "Kokushi Musou Juusan Menmachi": ["Kokushi Musou"],
    "Daisuushii": ["Shousuushii"],
    "Any Wind": ["Round Wind", "Seat Wind"]
  },
  "declarable_yaku": [
    "Riichi",
    "Tsumo",
    "Ippatsu",
    "Chankan",
    "Rinshan",
    "Haitei",
    "Houtei",
    "Pinfu",
    "Tanyao",
    "Iipeikou",
    "Seat Wind",
    "Round Wind",
    "Haku",
    "Hatsu",
    "Chun",
    "Double Riichi",
    "Chiitoitsu",
    "Chanta",
    "Ittsu",
    "Sanshoku",
    "Sanshoku Doukou",
    "Sankantsu",
    "Toitoi",
    "Sanankou",
    "Shousangen",
    "Honroutou",
    "Ryanpeikou",
    "Junchan",
    "Honitsu",
    "Chinitsu",
    "Tenhou",
    "Chiihou",
    "Renhou",
    "Daisangen",
    "Suuankou",
    "Tsuuiisou",
    "Ryuuiisou",
    "Chinroutou",
    "Chuurenpoutou",
    "Kokushi Musou",
    "Daisuushii",
    "Shousuushii",
    "Suukantsu"
  ],
  "yaku_alt_names": {
    "Riichi": "立直",
    "Tsumo": "門前清自摸和",
    "Ippatsu": "一発",
    "Chankan": "槍槓",
    "Rinshan": "嶺上開花",
    "Haitei": "海底摸月",
    "Houtei": "河底撈魚",
    "Pinfu": "平和",
    "Tanyao": "断幺九",
    "Iipeikou": "一盃口",
    "Seat Wind": "自風",
    "Round Wind": "場風",
    "Haku": "役牌 白",
    "Hatsu": "役牌 發",
    "Chun": "役牌 中",
    "Double Riichi": "ダブル立直",
    "Chiitoitsu": "七対子",
    "Chanta": "混全帯幺九",
    "Ittsu": "一気通貫",
    "Sanshoku": "三色同順",
    "Sanshoku Doukou": "三色同刻",
    "Sankantsu": "三槓子",
    "Toitoi": "対々和",
    "Sanankou": "三暗刻",
    "Shousangen": "小三元",
    "Honroutou": "混老頭",
    "Ryanpeikou": "二盃口",
    "Junchan": "純全帯幺九",
    "Honitsu": "混一色",
    "Chinitsu": "清一色",
    "Renhou": "人和",
    "Tenhou": "天和",
    "Chiihou": "地和",
    "Daisangen": "大三元",
    "Suuankou": "四暗刻",
    "Suuankou Tanki": "四暗刻単騎",
    "Tsuuiisou": "字一色",
    "Ryuuiisou": "緑一色",
    "Chinroutou": "清老頭",
    "Chuurenpoutou": "九蓮宝燈",
    "Junsei Chuurenpoutou": "純正九蓮宝燈",
    "Kokushi Musou": "国士無双",
    "Kokushi Musou Juusan Menmachi": "国士無双十三面待ち",
    "Daisuushii": "大四喜",
    "Shousuushii": "小四喜",
    "Suukantsu": "四槓子",
    "Dora": "ドラ",
    "Ura": "裏ドラ",
    "Aka": "赤ドラ"
  },
  "score_calculation": {
    "scoring_method": ["han_fu_formula", "multiplier"],
    "score_multiplier": 32000, // this is for yakuman
    "dealer_multiplier": 1.5,
    "limit_thresholds": [
      [3, 70], [4, 40], [5, 0],
      [6, 0], [7, 0],
      [8, 0], [9, 0], [10, 0],
      [11, 0], [12, 0],
      [13, 0]
    ],
    "limit_scores": [
      8000, 8000, 8000,
      12000, 12000,
      16000, 16000, 16000,
      24000, 24000,
      32000
    ],
    "limit_names": [
      "Mangan", "Mangan", "Mangan",
      "Haneman", "Haneman",
      "Baiman", "Baiman", "Baiman",
      "Sanbaiman", "Sanbaiman",
      "Yakuman"
    ],
    "yaku_lists": ["yaku", "meta_yaku", "meta_yaku_2", "extra_yaku"],
    "extra_yaku_lists": ["extra_yaku"],
    "yaku2_lists": ["yakuman"],
    "pao_eligible_yaku": ["Daisangen", "Daisuushii"],
    "yaku2_overrides_yaku1": true,
    "draw_tenpai_payments": [1000, 1500, 3000],
    "draw_nagashi_payments": [2000, 4000],
    "split_oya_ko_payment": true,
    "agarirenchan": true,
    "tenpairenchan": true,
    "riichi_value": 1000,
    "honba_value": 100,
    "right_display": "minipoints",
    "point_name": "Han",
    "point2_name": "★",
    "minipoint_name": "Fu",
    "win_by_discard_label": "Ron",
    "win_by_draw_label": "Tsumo",
    "win_by_discard_name": "Ron",
    "win_by_discard_name_2": "Double Ron",
    "win_by_discard_name_3": "Triple Ron",
    "win_by_draw_name": "Tsumo",
    "win_with_pao_name": "Sekinin Barai",
    "triple_win_draw_name": "Sanchahou",
    "exhaustive_draw_name": "Ryuukyoku",
    "nagashi_name": "Nagashi Mangan"
  },
  "play_restrictions": [
    [["any"], ["not_all_saki_cards_drafted"]],
    [["any"], [{"name": "status", "opts": ["riichi"]}, {"name": "status_missing", "opts": ["just_reached"]}, "not_is_drawn_tile"]],
    [["any"], [{"name": "status", "opts": ["iishanten"]}, {"name": "status_missing", "opts": ["just_iishantened"]}, "not_is_drawn_tile"]],
    [["any"], [{"name": "status", "opts": ["atago_kinue_aside_waits"]}, {"name": "status_missing", "opts": ["just_changed_atago_kinue_aside_waits"]}, "not_is_drawn_tile"]],
    [["any"], [{"name": "status", "opts": ["atago_kinue_aside_waits", "just_changed_atago_kinue_aside_waits"]}, {"name": "needed_for_hand", "opts": ["tenpai"]}]],
    [["any"], [{"name": "status", "opts": ["riichi", "just_reached"]}, {"name": "status_missing", "opts": ["kakura-kurumi"]}, {"name": "needed_for_hand", "opts": ["tenpai"]}]],
    [["any"], [{"name": "status", "opts": ["riichi", "just_reached", "kakura-kurumi"]}, {"name": "match", "opts": [["hand"], ["kakura_kurumi_tenpai"]]}, {"name": "needed_for_hand", "opts": ["kakura_kurumi_tenpai"]}]],
    [["any"], [{"name": "status", "opts": ["iishanten", "just_iishantened"]}, {"name": "needed_for_hand", "opts": ["tenpai", "iishanten"]}]],
    [["any"], ["just_called", {"name": "status_missing", "opts": ["anetai-toyone"]}, {"name": "last_called_tile_matches", "opts": ["kuikae"]}]],
    [["any"], [{"name": "has_attr", "opts": ["tile", "no_discard"]}]],
    [["any"], [{"name": "status", "opts": ["amae-koromo"]}, "just_discarded"]],
    [["any"], [{"name": "status", "opts": ["matano-seiko", "pon"]}]],
    [["any"], [{"name": "status", "opts": ["kainou-yoshiko", "kainou_yoshiko_discard"]}, {"name": "not_match", "opts": [["last_discard", "tile"], [[[[[0, 0]], 1]]]]}]],
    [["any"], [{"name": "status", "opts": ["funakubo-hiroko", "funakubo_hiroko_swapping"]}]],
    [["any"], [{"name": "anyone_status", "opts": ["oohoshi-awai", "oohoshi_awai_scry"]}]]
  ],
  "before_turn_change": {
    "actions": [
      ["when", [{"name": "everyone_status", "opts": ["riichi"]}], [
        ["subtract_score", "riichi_value"],
        ["put_down_riichi_stick"],
        ["unset_status", "just_reached"],
        ["pause", 1000],
        ["abortive_draw", "Suucha Riichi"]
      ]],
      ["when", [{"name": "status_missing", "opts": ["just_reached", "extra_turn"]}], [["unset_status", "ippatsu"]]],
      ["when", [{"name": "status", "opts": ["just_reached"]}, {"name": "status_missing", "opts": ["inazuma_riichi"]}], [["subtract_score", "riichi_value"], ["put_down_riichi_stick"]]],
      ["when", [{"name": "status", "opts": ["just_reached", "inazuma_riichi"]}], [["subtract_score", 5000], ["put_down_riichi_stick", 5]]],
      ["when", [{"name": "status", "opts": ["kan"]}, {"name": "not_status", "opts": ["ankan"]}, {"name": "tile_revealed", "opts": [-18]}, {"name": "tile_not_revealed", "opts": [-20]}], [["ensure_dead_wall_2"], ["reveal_tile", -20]]],
      ["when", [{"name": "status", "opts": ["kan"]}, {"name": "not_status", "opts": ["ankan"]}, {"name": "tile_revealed", "opts": [-16]}, {"name": "tile_not_revealed", "opts": [-18]}], [["ensure_dead_wall_2"], ["reveal_tile", -18]]],
      ["when", [{"name": "status", "opts": ["kan"]}, {"name": "not_status", "opts": ["ankan"]}, {"name": "tile_revealed", "opts": [-14]}, {"name": "tile_not_revealed", "opts": [-16]}], [["ensure_dead_wall_2"], ["reveal_tile", -16]]],
      ["when", [{"name": "status", "opts": ["kan"]}, {"name": "not_status", "opts": ["ankan"]}, {"name": "tile_revealed", "opts": [-12]}, {"name": "tile_not_revealed", "opts": [-14]}], [["reveal_tile", -14]]],
      ["when", [{"name": "status", "opts": ["kan"]}, {"name": "not_status", "opts": ["ankan"]}, {"name": "tile_revealed", "opts": [-10]}, {"name": "tile_not_revealed", "opts": [-12]}], [["reveal_tile", -12]]],
      ["when", [{"name": "status", "opts": ["kan"]}, {"name": "not_status", "opts": ["ankan"]}, {"name": "tile_revealed", "opts": [-8]}, {"name": "tile_not_revealed", "opts": [-10]}], [["reveal_tile", -10]]],
      ["when", [{"name": "status", "opts": ["kan"]}, {"name": "not_status", "opts": ["ankan"]}, {"name": "tile_revealed", "opts": [-6]}, {"name": "tile_not_revealed", "opts": [-8]}], [["reveal_tile", -8]]],
      ["when", [[{"name": "status_missing", "opts": ["riichi"]}, {"name": "status", "opts": ["just_reached"]}]], [["unset_status", "furiten"]]],
      ["unset_status", "discard_passed", "ready", "just_reached", "just_iishantened", "just_changed_atago_kinue_aside_waits", "just_called", "call_made", "chii", "pon", "kan", "ankan", "daiminkan", "discard_facedown", "onjouji_toki_drew", "shirouzu_mairu_drew", "inoue_jun_broke_ippatsu", "just_swapped", "call_interrupted", "swap_interrupted", "motouchi_naruka_skip_interrupt", "suehara_kyouko_set_aside", "kajiki_yumi_facedown_done", "oohoshi_awai_done"],
      ["unset_status_all", "yae_kobashiri_skip", "tsujigaito_satoha_scryed", "just_scryed"],
      // check if anyone's placement is not the same as the one they are tagged with
      ["when_anyone", [[
        [{"name": "placement", "opts": [1]}, {"name": "status_missing", "opts": ["1st_place"]}],
        [{"name": "placement", "opts": [2]}, {"name": "status_missing", "opts": ["2nd_place"]}],
        [{"name": "placement", "opts": [3]}, {"name": "status_missing", "opts": ["3rd_place"]}],
        [{"name": "placement", "opts": [4]}, {"name": "status_missing", "opts": ["4th_place"]}]
      ]], [
        // tag with placement for future update checks
        ["unset_status", "1st_place", "2nd_place", "3rd_place", "4th_place"],
        ["when", [{"name": "placement", "opts": [1]}], [["set_status", "1st_place"]]],
        ["when", [{"name": "placement", "opts": [2]}], [["set_status", "2nd_place"]]],
        ["when", [{"name": "placement", "opts": [3]}], [["set_status", "3rd_place"]]],
        ["when", [{"name": "placement", "opts": [4]}], [["set_status", "4th_place"]]],
        ["set_status", "placement_updated"]
      ]],
      // for damaten atago hiroe, if placement updates they can only use wildcard ippatsu draw from new higher placements
      ["when_anyone", [{"name": "status", "opts": ["atago-hiroe", "tenpai", "placement_updated"]}, {"name": "status_missing", "opts": ["riichi"]}], [
        // reset tile aliases
        ["clear_tile_aliases"],
        ["set_tile_alias", ["0m"], ["5m"]],
        ["set_tile_alias", ["0p"], ["5p"]],
        ["set_tile_alias", ["0s"], ["5s"]],
        ["when", [{"name": "placement", "opts": [2, 3, 4]}], [["set_tile_alias", [["any", "ippatsu", "draw", "1st_place"]], [
          "1m", "2m", "3m", "4m", "5m", "6m", "7m", "8m", "9m",
          "1p", "2p", "3p", "4p", "5p", "6p", "7p", "8p", "9p",
          "1s", "2s", "3s", "4s", "5s", "6s", "7s", "8s", "9s",
          "1z", "2z", "3z", "4z", "5z", "6z", "7z"]]]],
        ["when", [{"name": "placement", "opts": [3, 4]}], [["set_tile_alias", [["any", "ippatsu", "draw", "2nd_place"]], [
          "1m", "2m", "3m", "4m", "5m", "6m", "7m", "8m", "9m",
          "1p", "2p", "3p", "4p", "5p", "6p", "7p", "8p", "9p",
          "1s", "2s", "3s", "4s", "5s", "6s", "7s", "8s", "9s",
          "1z", "2z", "3z", "4z", "5z", "6z", "7z"]]]],
        ["when", [{"name": "placement", "opts": [4]}], [["set_tile_alias", [["any", "ippatsu", "draw", "3rd_place"]], [
          "1m", "2m", "3m", "4m", "5m", "6m", "7m", "8m", "9m",
          "1p", "2p", "3p", "4p", "5p", "6p", "7p", "8p", "9p",
          "1s", "2s", "3s", "4s", "5s", "6s", "7s", "8s", "9s",
          "1z", "2z", "3z", "4z", "5z", "6z", "7z"]]]]
      ]],
      // for fukuji mihoko, if no longer fourth (and no one else is 4th place mihoko) then hide other players' hands; if fourth then open other players' hands
      ["when_anyone", [{"name": "status", "opts": ["fukuji-mihoko", "placement_updated"]}], [
        ["when", [{"name": "status", "opts": ["4th_place"]}], [
          // open other players' hands
          ["as", "others", [["set_status", "reveal_all"]]],
          ["push_message", "reveals other players' hands due to being 4th place (Fukuji Mihoko)"],
          ["when_anyone", [{"name": "status", "opts": ["reveal_all"]}], [["add_attr", ["hand", "draw"], ["revealed"]]]]
        ]],
        ["when", [{"name": "status_missing", "opts": ["4th_place"]}, {"name": "not_others_status", "opts": ["fukuji-mihoko", "4th_place"]}], [
          // hide other players' hands
          ["push_message", "is no longer 4th place, so no longer reveals other players' hands (Fukuji Mihoko)"],
          ["when_anyone", [{"name": "status", "opts": ["reveal_all"]}], [["unset_status", "reveal_all"], ["remove_attr_hand", "revealed"]]]
        ]]
      ]],
      ["unset_status", "placement_updated"],
      ["when", [{"name": "match", "opts": [["hand", "calls", "any_discard"], ["win"]]}], [["set_status", "furiten"]]],
      ["when", [{"name": "status", "opts": ["kakura-kurumi"]}, {"name": "match", "opts": [["hand"], ["kakura_kurumi_tenpai"]]}, {"name": "match", "opts": [["hand", "calls", "any_discard"], ["kakura_kurumi_win"]]}], [["set_status", "furiten"]]],
      ["when", [{"name": "tile_drawn", "opts": ["kandraw_4"]}, {"name": "not_anyone_status", "opts": ["suukantsu"]}], [["pause", 1000], ["abortive_draw", "Suukaikan"]]],
      ["remove_attr_all", "rinshan"],
      ["ite", [{"name": "status", "opts": ["extra_turn"]}, {"name": "status_missing", "opts": ["extra_turn_taken"]}],
        [["set_status", "extra_turn_prompt"]],
        [["unset_status", "extra_turn", "extra_turn_taken", "discard_facedown"]]],
      ["when", [{"name": "status", "opts": ["tsuruta-himeko", "extra_turn_skipped"]}], [
        ["big_text", "Tsuruta Himeko: switch out!"],
        ["unset_status", "tsuruta-himeko"],
        ["set_status", "shirouzu-mairu"]
      ]],
      ["unset_status", "extra_turn_skipped"],
      ["when", [{"name": "status", "opts": ["toyouko-momoko"]}, "third_row_discard"], [["set_status", "discard_facedown"]]],
      ["when", [{"name": "not_status_missing", "opts": ["shirouzu-mairu", "tsuruta-himeko"]}], [["remove_attr_all", "revealed"]]],
      ["when", [{"name": "status", "opts": ["shimizudani-ryuuka"]}], [["remove_attr_hand", "revealed"]]],
      ["when", [{"name": "status", "opts": ["reveal_manzu"]}], [["add_attr", ["hand", "draw", "aside"], ["revealed"], ["manzu"]]]],
      ["when", [{"name": "status", "opts": ["reveal_pinzu"]}], [["add_attr", ["hand", "draw", "aside"], ["revealed"], ["pinzu"]]]],
      ["when", [{"name": "status", "opts": ["reveal_souzu"]}], [["add_attr", ["hand", "draw", "aside"], ["revealed"], ["souzu"]]]],
      ["when", [{"name": "status", "opts": ["reveal_jihai"]}], [["add_attr", ["hand", "draw", "aside"], ["revealed"], ["jihai"]]]],
      ["when", [{"name": "status", "opts": ["reveal_all"]}], [["add_attr", ["hand", "draw", "aside"], ["revealed"]]]]
    ]
  },
  "after_turn_change": {
    "actions": [["ite", [{"name": "kamicha_status", "opts": ["extra_turn_prompt"]}], [
        ["change_turn", "kamicha"]
      ], [
        ["when", ["no_tiles_remaining", {"name": "not_anyone_status", "opts": ["kanbara-satomi"]}], [["pause", 1000], ["ryuukyoku"]]],
        ["when", [{"name": "tile_revealed", "opts": [0]}, {"name": "anyone_status", "opts": ["kanbara-satomi"]}], [["pause", 1000], ["ryuukyoku"]]],
        ["when_anyone",
          [[
            {"name": "match", "opts": [["hand", "calls", "last_discard"], ["win"]]},
            [
              {"name": "last_call_is", "opts": ["kakan"]},
              {"name": "match", "opts": [["hand", "calls", "last_called_tile"], ["win"]]}
            ],
            [
              {"name": "last_call_is", "opts": ["ankan"]},
              {"name": "match", "opts": [["hand", "calls", "draw"], ["kokushi_tenpai"]]},
              {"name": "match", "opts": [["hand", "calls", "last_called_tile"], ["win"]]}
            ],
            [
              {"name": "status", "opts": ["kakura-kurumi"]},
              {"name": "match", "opts": [["hand"], ["kakura_kurumi_tenpai"]]},
              {"name": "match", "opts": [["hand", "last_discard"], ["kakura_kurumi_win"]]}
            ],
            [
              {"name": "status", "opts": ["kakura-kurumi"]},
              {"name": "last_call_is", "opts": ["kakan"]},
              {"name": "match", "opts": [["hand"], ["kakura_kurumi_tenpai"]]},
              {"name": "match", "opts": [["hand", "last_called_tile"], ["kakura_kurumi_win"]]}
            ]
          ]],
          [["set_status", "furiten"]]
        ],
        // draw a tile
        // but only when you're not about to skip your turn due to a duel
        ["ite", [
          {"name": "status_missing", "opts": ["megan-davin", "duelist"]},
          {"name": "others_status", "opts": ["megan-davin", "riichi"]},
          {"name": "others_status", "opts": ["duelist", "riichi"]}
        ], [
          // skip your turn
          ["advance_turn"]
        ], [
          // draw a tile
          ["when", [
            "all_saki_cards_drafted",
            [
              "not_no_tiles_remaining",
              {"name": "anyone_status", "opts": ["kanbara-satomi"]}
            ],
            {"name": "tile_not_revealed", "opts": [0]},
            [
              {"name": "status_missing", "opts": ["shibuya-takami", "matano-seiko", "onjouji-toki"]},
              "not_has_aside"
            ]
          ], [
            ["set_status", "about_to_draw"],
            ["recalculate_buttons"], // allow interrupting draw
            ["unset_status", "about_to_draw"],
            ["draw"],
            ["when", [{"name": "status", "opts": ["ippatsu"]}], [
              // for atago hiroe
              ["when", [{"name": "placement", "opts": [1]}], [["add_attr", ["draw"], ["1st_place"]]]],
              ["when", [{"name": "placement", "opts": [2]}], [["add_attr", ["draw"], ["2nd_place"]]]],
              ["when", [{"name": "placement", "opts": [3]}], [["add_attr", ["draw"], ["3rd_place"]]]],
              ["add_attr", ["draw"], ["ippatsu"]]
            ]]
          ]]
        ]],
        ["when", ["no_tiles_remaining"], [["add_attr", ["draw"], ["haitei"]]]],
        ["when", [
          [
            {"name": "status", "opts": ["shibuya-takami"]},
            {"name": "status", "opts": ["matano-seiko"]}
          ],
          "has_aside"
        ], [
          ["set_status", "about_to_draw"],
          ["recalculate_buttons"], // allow interrupting draw
          ["unset_status", "about_to_draw"],
          ["draw_from_aside"]
        ]],
        ["unset_status", "funakubo-hiroko_exhausted"],
        ["when", [
          {"name": "status", "opts": ["iwadate-yuan"]},
          {"name": "match", "opts": [["hand", "draw", "all_discards", "all_call_tiles", "revealed_tiles"], [[[[["7z","7z","7z","7z"]], 1]]]]}
        ], [
          ["remove_attr_all", "golden"],
          ["add_attr_first_tile", "7z", ["golden"]],
          ["set_tile_alias", [["7z", "golden"]], ["5m","5p","5s","7z"]]
        ]]
      ]
    ]]
  },
  "after_discard_passed": {
    "actions": [
      ["set_status", "discard_passed"]
    ]
  },
  "before_call": {
    "actions": [
      ["as", "caller", [["set_status", "is_caller"]]],
      ["when_anyone", [{"name": "status", "opts": ["is_caller"]}, {"name": "has_no_call_named", "opts": ["chii", "pon", "daiminkan", "kakan"]}], [["set_status", "was_closed_hand"]]],
      ["as", "caller", [["unset_status", "is_caller"]]],
      ["when", [{"name": "status_missing", "opts": ["just_reached"]}], [["unset_status", "ippatsu"]]],
      ["when", [{"name": "status", "opts": ["just_reached"]}], [["subtract_score", 1000], ["put_down_riichi_stick"]]],
      ["when", [{"name": "status", "opts": ["kan"]}, {"name": "not_status", "opts": ["ankan"]}, {"name": "tile_revealed", "opts": [-18]}, {"name": "tile_not_revealed", "opts": [-20]}], [["ensure_dead_wall_2"], ["reveal_tile", -20]]],
      ["when", [{"name": "status", "opts": ["kan"]}, {"name": "not_status", "opts": ["ankan"]}, {"name": "tile_revealed", "opts": [-16]}, {"name": "tile_not_revealed", "opts": [-18]}], [["ensure_dead_wall_2"], ["reveal_tile", -18]]],
      ["when", [{"name": "status", "opts": ["kan"]}, {"name": "not_status", "opts": ["ankan"]}, {"name": "tile_revealed", "opts": [-14]}, {"name": "tile_not_revealed", "opts": [-16]}], [["ensure_dead_wall_2"], ["reveal_tile", -16]]],
      ["when", [{"name": "status", "opts": ["kan"]}, {"name": "not_status", "opts": ["ankan"]}, {"name": "tile_revealed", "opts": [-12]}, {"name": "tile_not_revealed", "opts": [-14]}], [["reveal_tile", -14]]],
      ["when", [{"name": "status", "opts": ["kan"]}, {"name": "not_status", "opts": ["ankan"]}, {"name": "tile_revealed", "opts": [-10]}, {"name": "tile_not_revealed", "opts": [-12]}], [["reveal_tile", -12]]],
      ["when", [{"name": "status", "opts": ["kan"]}, {"name": "not_status", "opts": ["ankan"]}, {"name": "tile_revealed", "opts": [-8]}, {"name": "tile_not_revealed", "opts": [-10]}], [["reveal_tile", -10]]],
      ["when", [{"name": "status", "opts": ["kan"]}, {"name": "not_status", "opts": ["ankan"]}, {"name": "tile_revealed", "opts": [-6]}, {"name": "tile_not_revealed", "opts": [-8]}], [["reveal_tile", -8]]],
      ["unset_status", "nagashi", "extra_turn", "extra_turn_taken", "extra_turn_skipped"],
      ["unset_status", "discard_passed", "ready", "just_reached", "just_iishantened", "just_changed_atago_kinue_aside_waits", "just_called", "call_made", "chii", "pon", "kan", "ankan", "daiminkan", "discard_facedown", "onjouji_toki_drew", "shirouzu_mairu_drew", "inoue_jun_broke_ippatsu", "just_swapped", "call_interrupted", "swap_interrupted", "motouchi_naruka_skip_interrupt", "suehara_kyouko_set_aside", "kajiki_yumi_facedown_done", "oohoshi_awai_done"],
      ["unset_status_all", "yae_kobashiri_skip", "tsujigaito_satoha_scryed", "just_scryed"],
      ["when", [{"name": "match", "opts": [["hand", "calls", "draw"], ["tenpai"]]}], [["set_status", "tenpai"]]],
      ["when", [{"name": "not_match", "opts": [["hand", "calls", "draw"], ["tenpai"]]}], [["unset_status", "tenpai"]]],
      ["unset_status_all", "discards_empty"]
    ]
  },
  "after_call": {
    "actions": [
      ["when_anyone",
        [[
          {"name": "match", "opts": [["hand", "calls", "last_discard"], ["win"]]},
          [
            {"name": "last_call_is", "opts": ["kakan"]},
            {"name": "match", "opts": [["hand", "calls", "last_called_tile"], ["win"]]}
          ],
          [
            {"name": "last_call_is", "opts": ["ankan"]},
            {"name": "match", "opts": [["hand", "calls", "draw"], ["kokushi_tenpai"]]},
            {"name": "match", "opts": [["hand", "calls", "last_called_tile"], ["win"]]}
          ]
        ]],
        [["set_status", "furiten"]]
      ],
      ["when", [{"name": "match", "opts": [["last_call"], [[[["haku", "hatsu", "chun"], 1]]]]}, {"name": "match", "opts": [["calls"], [[[["haku"], 1], [["hatsu"], 1], [["chun"], 1]]]]}], [["as", "callee", [["set_status", "pao"]]]]],
      ["when", [{"name": "match", "opts": [["last_call"], [[[["ton", "nan", "shaa", "pei"], 1]]]]}, {"name": "match", "opts": [["calls"], [[[["ton"], 1], [["nan"], 1], [["shaa"], 1], [["pei"], 1]]]]}], [["as", "callee", [["set_status", "pao"]]]]],
      ["when", [{"name": "anyone_status", "opts": ["miyanaga-teru"]}], [["add_honba"]]],
      ["when_anyone", [{"name": "status", "opts": ["atago-kinue"]}, "not_no_tiles_remaining"], [
        ["draw_aside"],
        ["push_message", "drew a tile aside (Atago Kinue)"]
      ]],
      ["unset_status_all", "motouchi_naruka_skip_interrupt"],
      ["when", [{"name": "status", "opts": ["anetai-toyone"]}, {"name": "match", "opts": [["calls"], [[[["chii", "pon", "daiminkan", "kakan", "ankan"], 4]]]]}], [
        ["set_tile_alias", [["1m", "draw"], ["1p", "draw"], ["1s", "draw"], ["1m", "discard"], ["1p", "discard"], ["1s", "discard"]], ["1m", "1p", "1s"]],
        ["set_tile_alias", [["2m", "draw"], ["2p", "draw"], ["2s", "draw"], ["2m", "discard"], ["2p", "discard"], ["2s", "discard"]], ["2m", "2p", "2s"]],
        ["set_tile_alias", [["3m", "draw"], ["3p", "draw"], ["3s", "draw"], ["3m", "discard"], ["3p", "discard"], ["3s", "discard"]], ["3m", "3p", "3s"]],
        ["set_tile_alias", [["4m", "draw"], ["4p", "draw"], ["4s", "draw"], ["4m", "discard"], ["4p", "discard"], ["4s", "discard"]], ["4m", "4p", "4s"]],
        ["set_tile_alias", [["5m", "draw"], ["5p", "draw"], ["5s", "draw"], ["5m", "discard"], ["5p", "discard"], ["5s", "discard"]], ["5m", "5p", "5s"]],
        ["set_tile_alias", [["6m", "draw"], ["6p", "draw"], ["6s", "draw"], ["6m", "discard"], ["6p", "discard"], ["6s", "discard"]], ["6m", "6p", "6s"]],
        ["set_tile_alias", [["7m", "draw"], ["7p", "draw"], ["7s", "draw"], ["7m", "discard"], ["7p", "discard"], ["7s", "discard"]], ["7m", "7p", "7s"]],
        ["set_tile_alias", [["8m", "draw"], ["8p", "draw"], ["8s", "draw"], ["8m", "discard"], ["8p", "discard"], ["8s", "discard"]], ["8m", "8p", "8s"]],
        ["set_tile_alias", [["9m", "draw"], ["9p", "draw"], ["9s", "draw"], ["9m", "discard"], ["9p", "discard"], ["9s", "discard"]], ["9m", "9p", "9s"]]
      ]],
      ["when_anyone", [{"name": "status", "opts": ["tsuruta-himeko"]}, {"name": "status_missing", "opts": ["riichi"]}], [
        ["big_text", "Tsuruta Himeko: switch out!"],
        ["unset_status", "tsuruta-himeko"],
        ["set_status", "shirouzu-mairu"]
      ]],
      ["when", [{"name": "status", "opts": ["someya-mako"]}, {"name": "match", "opts": [["last_called_tile"], [[[["2s","3s","4s","6s","8s","6z"], 1]]]]}], [
        ["set_status", "extra_turn"],
        ["big_text", "Someya Mako: extra turn!"],
        ["push_message", "took an extra turn by calling an all green tile (Someya Mako)"]
      ]],
      // set tenpai status
      ["when", [{"name": "status_missing", "opts": ["tenpai"]}, {"name": "match", "opts": [["hand", "calls", "draw"], ["tenpai"]]}], [
        ["set_status", "tenpai"],
        ["when", [{"name": "status", "opts": ["takei-hisa"]}], [
          ["ite", [{"name": "has_hell_wait", "opts": ["pair_wait"]}], [
            ["set_tile_alias", [["1m", "draw"], ["1p", "draw"], ["1s", "draw"], ["1m", "discard"], ["1p", "discard"], ["1s", "discard"]], ["1m", "1p", "1s"]],
            ["set_tile_alias", [["2m", "draw"], ["2p", "draw"], ["2s", "draw"], ["2m", "discard"], ["2p", "discard"], ["2s", "discard"]], ["2m", "2p", "2s"]],
            ["set_tile_alias", [["3m", "draw"], ["3p", "draw"], ["3s", "draw"], ["3m", "discard"], ["3p", "discard"], ["3s", "discard"]], ["3m", "3p", "3s"]],
            ["set_tile_alias", [["4m", "draw"], ["4p", "draw"], ["4s", "draw"], ["4m", "discard"], ["4p", "discard"], ["4s", "discard"]], ["4m", "4p", "4s"]],
            ["set_tile_alias", [["5m", "draw"], ["5p", "draw"], ["5s", "draw"], ["5m", "discard"], ["5p", "discard"], ["5s", "discard"]], ["5m", "5p", "5s"]],
            ["set_tile_alias", [["6m", "draw"], ["6p", "draw"], ["6s", "draw"], ["6m", "discard"], ["6p", "discard"], ["6s", "discard"]], ["6m", "6p", "6s"]],
            ["set_tile_alias", [["7m", "draw"], ["7p", "draw"], ["7s", "draw"], ["7m", "discard"], ["7p", "discard"], ["7s", "discard"]], ["7m", "7p", "7s"]],
            ["set_tile_alias", [["8m", "draw"], ["8p", "draw"], ["8s", "draw"], ["8m", "discard"], ["8p", "discard"], ["8s", "discard"]], ["8m", "8p", "8s"]],
            ["set_tile_alias", [["9m", "draw"], ["9p", "draw"], ["9s", "draw"], ["9m", "discard"], ["9p", "discard"], ["9s", "discard"]], ["9m", "9p", "9s"]]
          ], [
            ["clear_tile_aliases"],
            ["set_tile_alias", ["0m"], ["5m"]],
            ["set_tile_alias", ["0p"], ["5p"]],
            ["set_tile_alias", ["0s"], ["5s"]]
          ]]
        ]]
      ]],
      // unset tenpai status
      ["when", [{"name": "status", "opts": ["tenpai"]}, {"name": "not_match", "opts": [["hand", "calls", "draw"], ["tenpai"]]}], [
        ["unset_status", "tenpai"],
        ["when", [{"name": "not_status_missing", "opts": ["takei-hisa", "atago-hiroe"]}], [
          ["clear_tile_aliases"],
          ["set_tile_alias", ["0m"], ["5m"]],
          ["set_tile_alias", ["0p"], ["5p"]],
          ["set_tile_alias", ["0s"], ["5s"]]
        ]]
      ]],
      ["unless", [{"name": "status", "opts": ["kan"]}], [["set_status", "ready"]]],
      ["when", [
        {"name": "status", "opts": ["was_closed_hand"]},
        {"name": "others_status", "opts": ["aislinn-wishart"]},
        {"name": "not_has_no_call_named", "opts": ["chii", "pon", "daiminkan", "kakan"]}
      ], [
        ["bet_points", 1500],
        ["push_message", "bet 1500 points to open their hand (Aislinn Wishart)"]
      ]],
      ["unset_status", "was_closed_hand"],
      ["recalculate_buttons"] // allow kajiki yumi's ability to pop up
    ]
  },
  "after_draw": {
    "actions": [
      ["remove_attr_hand", "rinshan", "haitei"],
      ["when", [{"name": "status", "opts": ["kan"]}], [["add_attr", ["draw"], ["rinshan"]]]],
      // set tenpai status
      ["when", [{"name": "status_missing", "opts": ["tenpai"]}, {"name": "match", "opts": [["hand", "calls", "draw"], ["tenpai"]]}], [
        ["set_status", "tenpai"],
        ["when", [{"name": "status", "opts": ["takei-hisa"]}], [
          ["ite", [{"name": "has_hell_wait", "opts": ["pair_wait"]}], [
            ["set_tile_alias", [["1m", "draw"], ["1p", "draw"], ["1s", "draw"], ["1m", "discard"], ["1p", "discard"], ["1s", "discard"]], ["1m", "1p", "1s"]],
            ["set_tile_alias", [["2m", "draw"], ["2p", "draw"], ["2s", "draw"], ["2m", "discard"], ["2p", "discard"], ["2s", "discard"]], ["2m", "2p", "2s"]],
            ["set_tile_alias", [["3m", "draw"], ["3p", "draw"], ["3s", "draw"], ["3m", "discard"], ["3p", "discard"], ["3s", "discard"]], ["3m", "3p", "3s"]],
            ["set_tile_alias", [["4m", "draw"], ["4p", "draw"], ["4s", "draw"], ["4m", "discard"], ["4p", "discard"], ["4s", "discard"]], ["4m", "4p", "4s"]],
            ["set_tile_alias", [["5m", "draw"], ["5p", "draw"], ["5s", "draw"], ["5m", "discard"], ["5p", "discard"], ["5s", "discard"]], ["5m", "5p", "5s"]],
            ["set_tile_alias", [["6m", "draw"], ["6p", "draw"], ["6s", "draw"], ["6m", "discard"], ["6p", "discard"], ["6s", "discard"]], ["6m", "6p", "6s"]],
            ["set_tile_alias", [["7m", "draw"], ["7p", "draw"], ["7s", "draw"], ["7m", "discard"], ["7p", "discard"], ["7s", "discard"]], ["7m", "7p", "7s"]],
            ["set_tile_alias", [["8m", "draw"], ["8p", "draw"], ["8s", "draw"], ["8m", "discard"], ["8p", "discard"], ["8s", "discard"]], ["8m", "8p", "8s"]],
            ["set_tile_alias", [["9m", "draw"], ["9p", "draw"], ["9s", "draw"], ["9m", "discard"], ["9p", "discard"], ["9s", "discard"]], ["9m", "9p", "9s"]]
          ], [
            ["clear_tile_aliases"],
            ["set_tile_alias", ["0m"], ["5m"]],
            ["set_tile_alias", ["0p"], ["5p"]],
            ["set_tile_alias", ["0s"], ["5s"]]
          ]]
        ]]
      ]],
      // unset tenpai status
      ["when", [{"name": "status", "opts": ["tenpai"]}, {"name": "not_match", "opts": [["hand", "calls", "draw"], ["tenpai"]]}], [
        ["unset_status", "tenpai"],
        ["when", [{"name": "not_status_missing", "opts": ["takei-hisa", "atago-hiroe"]}], [
          ["clear_tile_aliases"],
          ["set_tile_alias", ["0m"], ["5m"]],
          ["set_tile_alias", ["0p"], ["5p"]],
          ["set_tile_alias", ["0s"], ["5s"]]
        ]]
      ]],
      // reveal draw if required
      ["when", [{"name": "status", "opts": ["jindai-komaki"]}], [["add_attr", ["draw"], ["revealed"]]]],
      ["when", [{"name": "status", "opts": ["reveal_manzu"]}], [["add_attr", ["draw"], ["revealed"], ["manzu"]]]],
      ["when", [{"name": "status", "opts": ["reveal_pinzu"]}], [["add_attr", ["draw"], ["revealed"], ["pinzu"]]]],
      ["when", [{"name": "status", "opts": ["reveal_souzu"]}], [["add_attr", ["draw"], ["revealed"], ["souzu"]]]],
      ["when", [{"name": "status", "opts": ["reveal_jihai"]}], [["add_attr", ["draw"], ["revealed"], ["jihai"]]]],
      ["when", [{"name": "status", "opts": ["reveal_all"]}], [["add_attr", ["draw"], ["revealed"]]]],
      ["when", ["our_turn"], [["set_status", "ready"]]]
    ]
  },
  "play_effects": [
    ["1z", [["when", [{"name": "status", "opts": ["discards_empty"]}], [
      ["set_status", "suufonrenda_1z"],
      ["when", [{"name": "everyone_status", "opts": ["suufonrenda_1z"]}], [["pause", 1000], ["abortive_draw", "Suufon Renda"]]]
    ]]]],
    ["2z", [["when", [{"name": "status", "opts": ["discards_empty"]}], [
      ["set_status", "suufonrenda_2z"],
      ["when", [{"name": "everyone_status", "opts": ["suufonrenda_2z"]}], [["pause", 1000], ["abortive_draw", "Suufon Renda"]]]
    ]]]],
    ["3z", [["when", [{"name": "status", "opts": ["discards_empty"]}], [
      ["set_status", "suufonrenda_3z"],
      ["when", [{"name": "everyone_status", "opts": ["suufonrenda_3z"]}], [["pause", 1000], ["abortive_draw", "Suufon Renda"]]]
    ]]]],
    ["4z", [["when", [{"name": "status", "opts": ["discards_empty"]}], [
      ["set_status", "suufonrenda_4z"],
      ["when", [{"name": "everyone_status", "opts": ["suufonrenda_4z"]}], [["pause", 1000], ["abortive_draw", "Suufon Renda"]]]
    ]]]],
    ["tanyaohai", [["unset_status", "nagashi"]]],
    ["any", [["unset_status", "discards_empty"]]],
    ["2", [["when", [{"name": "status", "opts": ["takimi-haru"]}, {"name": "status_missing", "opts": ["extra_turn_taken"]}], [
      ["set_status", "extra_turn"],
      ["big_text", "Takimi Haru: extra turn!"],
      ["push_message", "took an extra turn by discarding 2 (Takimi Haru)"]
    ]]]],
    ["8", [["when", [{"name": "status", "opts": ["takimi-haru"]}, {"name": "status_missing", "opts": ["extra_turn_taken"]}], [
      ["set_status", "extra_turn"],
      ["big_text", "Takimi Haru: extra turn!"],
      ["push_message", "took an extra turn by discarding 8 (Takimi Haru)"]
    ]]]],
    ["tedashi", [["when", [{"name": "status", "opts": ["aislinn-wishart"]}, {"name": "has_score_below", "opts": [30000]}, {"name": "status_missing", "opts": ["extra_turn_taken"]}], [
      ["when_others", [{"name": "has_no_call_named", "opts": ["chii", "pon", "daiminkan", "kakan"]}], [
        ["set_status", "extra_turn"],
        ["big_text", "Aislinn Wishart: extra turn!"],
        ["push_message", "took an extra turn by discarding tedashi (Aislinn Wishart)"]
      ]]
    ]]]],
    ["5z", [["when", [{"name": "status", "opts": ["karijuku-tomoe"]}, {"name": "status_missing", "opts": ["extra_turn_taken"]}], [
      ["set_status", "extra_turn"],
      ["big_text", "Karijuku Tomoe: extra turn!"],
      ["push_message", "took an extra turn by discarding haku (Karijuku Tomoe)"]
    ]]]],
    ["any", [["when", [{"name": "status", "opts": ["kosegawa-shiromi"]}, {"name": "shimocha_status", "opts": ["riichi"]}, "genbutsu_shimocha", {"name": "status_missing", "opts": ["extra_turn", "extra_turn_taken"]}], [
      ["set_status", "extra_turn", "discard_facedown"],
      ["big_text", "Kosegawa Shiromi: extra turn!"],
      ["push_message", "took an extra turn by discarding genbutsu against riichi (Kosegawa Shiromi)"]
    ]]]],
    ["any", [["when", [{"name": "status", "opts": ["kosegawa-shiromi"]}, {"name": "toimen_status", "opts": ["riichi"]}, "genbutsu_toimen", {"name": "status_missing", "opts": ["extra_turn", "extra_turn_taken"]}], [
      ["set_status", "extra_turn", "discard_facedown"],
      ["big_text", "Kosegawa Shiromi: extra turn!"],
      ["push_message", "took an extra turn by discarding genbutsu against riichi (Kosegawa Shiromi)"]
    ]]]],
    ["any", [["when", [{"name": "status", "opts": ["kosegawa-shiromi"]}, {"name": "kamicha_status", "opts": ["riichi"]}, "genbutsu_kamicha", {"name": "status_missing", "opts": ["extra_turn", "extra_turn_taken"]}], [
      ["set_status", "extra_turn", "discard_facedown"],
      ["big_text", "Kosegawa Shiromi: extra turn!"],
      ["push_message", "took an extra turn by discarding genbutsu against riichi (Kosegawa Shiromi)"]
    ]]]],
    ["manzu", [["when", [{"name": "status", "opts": ["tsuruta-himeko"]}, {"name": "not_match", "opts": [["pond"], [[[["1m","2m","3m","4m","5m","6m","7m","8m","9m"], 2]]]]}], [
      ["set_status", "extra_turn"],
      ["big_text", "Tsuruta Himeko: extra turn!"],
      ["push_message", "took an extra turn by discarding a tile of a suit not visible in discards (Tsuruta Himeko)"]
    ]]]],
    ["pinzu", [["when", [{"name": "status", "opts": ["tsuruta-himeko"]}, {"name": "not_match", "opts": [["pond"], [[[["1p","2p","3p","4p","5p","6p","7p","8p","9p"], 2]]]]}], [
      ["set_status", "extra_turn"],
      ["big_text", "Tsuruta Himeko: extra turn!"],
      ["push_message", "took an extra turn by discarding a tile of a suit not visible in discards (Tsuruta Himeko)"]
    ]]]],
    ["souzu", [["when", [{"name": "status", "opts": ["tsuruta-himeko"]}, {"name": "not_match", "opts": [["pond"], [[[["1s","2s","3s","4s","5s","6s","7s","8s","9s"], 2]]]]}], [
      ["set_status", "extra_turn"],
      ["big_text", "Tsuruta Himeko: extra turn!"],
      ["push_message", "took an extra turn by discarding a tile of a suit not visible in discards (Tsuruta Himeko)"]
    ]]]],
    ["jihai", [["when", [{"name": "status", "opts": ["tsuruta-himeko"]}, {"name": "not_match", "opts": [["pond"], [[[["1z","2z","3z","4z","5z","6z","7z"], 2]]]]}], [
      ["set_status", "extra_turn"],
      ["big_text", "Tsuruta Himeko: extra turn!"],
      ["push_message", "took an extra turn by discarding a tile of a suit not visible in discards (Tsuruta Himeko)"]
    ]]]],
    ["any", [["when", [{"name": "status", "opts": ["tsuruta-himeko", "extra_turn_taken"]}], [
      ["big_text", "Tsuruta Himeko: switch out!"],
      ["unset_status", "tsuruta-himeko"],
      ["set_status", "shirouzu-mairu"]
    ]]]],
    ["any", [["when", [{"name": "status", "opts": ["suehara-kyouko"]}], [["unset_status", "suehara_kyouko_set_aside"]]]]],
    [["2s","3s","4s","6s","8s","6z"], [["when", [{"name": "status", "opts": ["someya-mako"]}], [
      ["set_status", "extra_turn"],
      ["big_text", "Someya Mako: extra turn!"],
      ["push_message", "took an extra turn by calling an all green tile (Someya Mako)"]
    ]]]],
    ["any", [["when", [{"name": "not_status_missing", "opts": ["yoshitome-miharu", "shishihara-sawaya", "funakubo-hiroko"]}], [["add_counter", "num_discards", 1]]]]],
    ["any", [["when", [{"name": "status", "opts": ["kainou-yoshiko", "kainou_yoshiko_discard"]}], [
      ["big_text", "Kainou Yoshiko: discard!"],
      ["push_message", "discarded an identical tile and drew (Kainou Yoshiko)"],
      ["unset_status", "kainou_yoshiko_discard"],
      ["set_status", "discard_passed"], // immune to calling/ron
      ["draw"],
      ["advance_turn"]
    ]]]],
    // for sawaya, check dora first so we set the status before yaochuuhai's effect's pause action
    ["dora", [["when", [{"name": "status", "opts": ["shishihara-sawaya"]}, {"name": "counter_equals", "opts": ["num_discards", 1, 7, 13]}], [
      ["set_status", "shishihara_sawaya_swap"]
    ]]]],
    ["yaochuuhai", [["when", [{"name": "status", "opts": ["shishihara-sawaya"]}, {"name": "counter_equals", "opts": ["num_discards", 1, 7, 13]}], [
      ["push_message", "discarded an honor/terminal, revealing the next tile in the wall (Shishihara Sawaya)"],
      ["scry_all", 1],
      ["pause", 1000],
      ["when", [{"name": "match", "opts": [["scry"], [[[["2m","3m","4m","5m","6m","7m","8m","2p","3p","4p","5p","6p","7p","8p","2s","3s","4s","5s","6s","7s","8s"], 1]]]]}], [
        ["set_status", "extra_turn"],
        ["big_text", "Shishihara Sawaya: extra turn!"],
        ["push_message", "revealed a tanyao tile, and takes an extra turn (Shishihara Sawaya)"]
      ]],
      ["clear_scry"]
    ]]]],
    ["tanyaohai", [["when", [{"name": "status", "opts": ["shishihara-sawaya"]}, {"name": "counter_equals", "opts": ["num_discards", 1, 7, 13]}], [
      ["when_anyone", ["not_our_turn"], [["bet_points", "100_times_tile_number"]]],
      ["push_message", "discarded a tanyao tile, making other players bet 100 times the tile number (Shishihara Sawaya)"]
    ]]]],
    ["dora", [["when", [{"name": "status", "opts": ["matsumi-kuro"]}, {"name": "status_missing", "opts": ["riichi"]}], [
      ["set_status", "matsumi_kuro_dora_disabled"]
    ]]]],
    ["any", [["when", [{"name": "status", "opts": ["discard_facedown"]}], [["recalculate_buttons"]]]]] // allow interrupting facedown discards
  ],
  "after_start": {
    "actions": [
      ["set_status_all", "discards_empty", "nagashi"],
      ["set_tile_alias_all", ["0m"], ["5m"]],
      ["set_tile_alias_all", ["0p"], ["5p"]],
      ["set_tile_alias_all", ["0s"], ["5s"]],
      ["when", [{"name": "placement", "opts": [1]}], [["set_status", "1st_place"]]],
      ["when", [{"name": "placement", "opts": [2]}], [["set_status", "2nd_place"]]],
      ["when", [{"name": "placement", "opts": [3]}], [["set_status", "3rd_place"]]],
      ["when", [{"name": "placement", "opts": [4]}], [["set_status", "4th_place"]]],
      ["when", ["not_all_saki_cards_drafted"], [["set_status_all", "drafting", "match_start"]]],
      // first draw of the game
      ["when", [{"name": "seat_is", "opts": ["east"]}], [["uninterruptible_draw"]]]
    ]
  },
  "after_saki_start": {
    "actions": [
      ["when", [{"name": "status", "opts": ["jindai-komaki"]}], [["set_status", "double_score"]]],
      ["when", [{"name": "status", "opts": ["miyanaga-saki"]}], [["set_tile_alias", [["1z", "hand"], ["2z", "hand"], ["4z", "hand"]], ["3z"]]]],
      ["when", [{"name": "status", "opts": ["miyanaga-teru"]}], [["set_status", "multiply_honba_with_han"]]],
      ["when", [{"name": "status", "opts": ["senoo-kaori"]}], [["set_tile_ordering", ["1z", "2z", "3z", "4z"]], ["set_tile_ordering", ["5z", "6z", "7z"]]]],
      ["when", [{"name": "status", "opts": ["mase-yuuko"]}], [["set_tile_ordering", ["9m", "1m"]], ["set_tile_ordering", ["9p", "1p"]], ["set_tile_ordering", ["9s", "1s"]]]],
      ["when", [{"name": "status", "opts": ["senoo-kaori", "mase-yuuko"]}], [["set_tile_ordering", ["4z", "1z"]], ["set_tile_ordering", ["7z", "5z"]]]],
      ["when", [{"name": "status", "opts": ["arakawa-kei"]}], [["set_status_all", "use_arakawa_kei_scoring"]]],
      ["when", [{"name": "status", "opts": ["motouchi-naruka"]}], [["set_status", "motouchi_naruka_increase_tsumo_payment"], ["as", "others", [["set_status", "motouchi_naruka_decrease_tsumo_payment"]]]]],
      ["when", [{"name": "status", "opts": ["iwadate-yuan"]}], [["add_counter", "iwadate_yuan_payment", 0]]],
      ["when", [
        {"name": "status", "opts": ["iwadate-yuan"]},
        {"name": "match", "opts": [["hand", "draw", "all_discards", "all_call_tiles", "revealed_tiles"], [[[[["7z","7z","7z","7z"]], 1]]]]}
      ], [
        ["add_attr_first_tile", "7z", ["golden"]],
        ["set_tile_alias", [["7z", "golden"]], ["5m","5p","5s","7z"]]
      ]],
      ["when", [{"name": "status", "opts": ["ryuumonbuchi-touka"]}, {"name": "seat_is", "opts": ["east"]}], [["set_status", "score_limit_one_tier_higher"]]],
      ["when", [{"name": "status", "opts": ["hanada-kirame"]}, {"name": "status_missing", "opts": ["hanada-kirame_exhausted"]}], [["set_status", "hanada_kirame_score_protection"]]],
      ["when", [{"name": "status", "opts": ["ezaki-hitomi"]}], [["set_status", "ezaki_hitomi_reflect"]]],
      ["when", [{"name": "status", "opts": ["fukuji-mihoko"]}, {"name": "placement", "opts": [4]}], [
        ["as", "others", [["set_status", "reveal_all"]]],
        ["push_message", "reveals other players' hands due to being 4th place (Fukuji Mihoko)"],
        ["when_anyone", [{"name": "status", "opts": ["reveal_all"]}], [["add_attr", ["hand", "draw"], ["revealed"]]]]
      ]],
      ["unset_status_all", "match_start"]
    ]
  },
  "before_win": {
    "actions": [
      // reveal kandora
      ["when", [{"name": "status", "opts": ["kan"]}, {"name": "not_status", "opts": ["ankan"]}, {"name": "tile_revealed", "opts": [-18]}, {"name": "tile_not_revealed", "opts": [-20]}], [["ensure_dead_wall_2"], ["reveal_tile", -20]]],
      ["when", [{"name": "status", "opts": ["kan"]}, {"name": "not_status", "opts": ["ankan"]}, {"name": "tile_revealed", "opts": [-16]}, {"name": "tile_not_revealed", "opts": [-18]}], [["ensure_dead_wall_2"], ["reveal_tile", -18]]],
      ["when", [{"name": "status", "opts": ["kan"]}, {"name": "not_status", "opts": ["ankan"]}, {"name": "tile_revealed", "opts": [-14]}, {"name": "tile_not_revealed", "opts": [-16]}], [["ensure_dead_wall_2"], ["reveal_tile", -16]]],
      ["when", [{"name": "status", "opts": ["kan"]}, {"name": "not_status", "opts": ["ankan"]}, {"name": "tile_revealed", "opts": [-12]}, {"name": "tile_not_revealed", "opts": [-14]}], [["reveal_tile", -14]]],
      ["when", [{"name": "status", "opts": ["kan"]}, {"name": "not_status", "opts": ["ankan"]}, {"name": "tile_revealed", "opts": [-10]}, {"name": "tile_not_revealed", "opts": [-12]}], [["reveal_tile", -12]]],
      ["when", [{"name": "status", "opts": ["kan"]}, {"name": "not_status", "opts": ["ankan"]}, {"name": "tile_revealed", "opts": [-8]}, {"name": "tile_not_revealed", "opts": [-10]}], [["reveal_tile", -10]]],
      ["when", [{"name": "status", "opts": ["kan"]}, {"name": "not_status", "opts": ["ankan"]}, {"name": "tile_revealed", "opts": [-6]}, {"name": "tile_not_revealed", "opts": [-8]}], [["reveal_tile", -8]]],
      // check if kanbara satomi flips two dora indicators
      ["when", [
        {"name": "status", "opts": ["kanbara-satomi"]},
        [
          [{"name": "has_attr", "opts": ["winning_tile", "rinshan"]}, "dead_wall_ends_here"],
          [{"name": "not_has_attr", "opts": ["winning_tile", "rinshan"]}, "wall_is_here"]
        ]
      ], [
        // flip 2 dora
        ["when", [{"name": "tile_revealed", "opts": [-18]}, {"name": "tile_not_revealed", "opts": [-20]}], [["ensure_dead_wall_2"], ["reveal_tile", -20]]],
        ["when", [{"name": "tile_revealed", "opts": [-16]}, {"name": "tile_not_revealed", "opts": [-18]}], [["ensure_dead_wall_2"], ["reveal_tile", -18]]],
        ["when", [{"name": "tile_revealed", "opts": [-14]}, {"name": "tile_not_revealed", "opts": [-16]}], [["ensure_dead_wall_2"], ["reveal_tile", -16]]],
        ["when", [{"name": "tile_revealed", "opts": [-12]}, {"name": "tile_not_revealed", "opts": [-14]}], [["reveal_tile", -14]]],
        ["when", [{"name": "tile_revealed", "opts": [-10]}, {"name": "tile_not_revealed", "opts": [-12]}], [["reveal_tile", -12]]],
        ["when", [{"name": "tile_revealed", "opts": [-8]}, {"name": "tile_not_revealed", "opts": [-10]}], [["reveal_tile", -10]]],
        ["when", [{"name": "tile_revealed", "opts": [-6]}, {"name": "tile_not_revealed", "opts": [-8]}], [["reveal_tile", -8]]],
        ["when", [{"name": "tile_revealed", "opts": [-18]}, {"name": "tile_not_revealed", "opts": [-20]}], [["ensure_dead_wall_2"], ["reveal_tile", -20]]],
        ["when", [{"name": "tile_revealed", "opts": [-16]}, {"name": "tile_not_revealed", "opts": [-18]}], [["ensure_dead_wall_2"], ["reveal_tile", -18]]],
        ["when", [{"name": "tile_revealed", "opts": [-14]}, {"name": "tile_not_revealed", "opts": [-16]}], [["ensure_dead_wall_2"], ["reveal_tile", -16]]],
        ["when", [{"name": "tile_revealed", "opts": [-12]}, {"name": "tile_not_revealed", "opts": [-14]}], [["reveal_tile", -14]]],
        ["when", [{"name": "tile_revealed", "opts": [-10]}, {"name": "tile_not_revealed", "opts": [-12]}], [["reveal_tile", -12]]],
        ["when", [{"name": "tile_revealed", "opts": [-8]}, {"name": "tile_not_revealed", "opts": [-10]}], [["reveal_tile", -10]]],
        ["when", [{"name": "tile_revealed", "opts": [-6]}, {"name": "tile_not_revealed", "opts": [-8]}], [["reveal_tile", -8]]]
      ]],
      // toyouko momoko closed hand gets riichi and access to ura dora
      ["when", [{"name": "status", "opts": ["toyouko-momoko"]}, {"name": "has_no_call_named", "opts": ["chii", "pon", "daiminkan", "kakan"]}], [["set_status", "riichi"]]],
      // check kainou yoshiko uumensai
      ["when", [
        {"name": "status", "opts": ["kainou-yoshiko"]},
        {"name": "match", "opts": [["hand", "calls", "winning_tile"], [[
          [["1m","2m","3m","4m","5m","6m","7m","8m","9m"], 1],
          [["1p","2p","3p","4p","5p","6p","7p","8p","9p"], 1],
          [["1s","2s","3s","4s","5s","6s","7s","8s","9s"], 1],
          [["1z","2z","3z","4z"], 1],
          [["5z","6z","7z"], 1]
        ]]]}
      ], [["set_status", "uumensai"]]],
      // reveal ura if riichi or if kainou yoshiko with uumensai
      ["when", [[{"name": "status", "opts": ["riichi"]}, {"name": "status", "opts": ["kainou-yoshiko", "uumensai"]}], {"name": "status_missing", "opts": ["ura_revealed"]}], [
        ["ite", [{"name": "others_status", "opts": ["takakamo-shizuno"]}], [
          ["push_message", "is prevented from accessing ura (Takakamo Shizuno)"]
        ], [
          ["set_status_all", "ura_revealed"],
          ["when", [{"name": "tile_revealed", "opts": [-16]}], [["reveal_tile", "1x"]]], // spacer if we have >5 dora indicators
          ["when", [{"name": "tile_not_revealed", "opts": [-6]}], [["reveal_tile", "1x"]]],
          ["when", [{"name": "tile_not_revealed", "opts": [-8]}], [["reveal_tile", "1x"]]],
          ["when", [{"name": "tile_not_revealed", "opts": [-10]}], [["reveal_tile", "1x"]]],
          ["when", [{"name": "tile_not_revealed", "opts": [-12]}], [["reveal_tile", "1x"]]],
          ["when", [{"name": "tile_not_revealed", "opts": [-14]}], [["reveal_tile", "1x"]]],
          ["when", [{"name": "tile_revealed", "opts": [-6]}], [["reveal_tile", -5]]],
          ["when", [{"name": "tile_revealed", "opts": [-8]}], [["reveal_tile", -7]]],
          ["when", [{"name": "tile_revealed", "opts": [-10]}], [["reveal_tile", -9]]],
          ["when", [{"name": "tile_revealed", "opts": [-12]}], [["reveal_tile", -11]]],
          ["when", [{"name": "tile_revealed", "opts": [-14]}], [["reveal_tile", -13]]],
          ["when", [{"name": "tile_revealed", "opts": [-16]}], [["reveal_tile", -15]]],
          ["when", [{"name": "tile_revealed", "opts": [-18]}], [["reveal_tile", -17]]],
          ["when", [{"name": "tile_revealed", "opts": [-20]}], [["reveal_tile", -19]]],
          ["when", [{"name": "status", "opts": ["takakamo-shizuno"]}], [
            ["push_message", "reveals two extra ura dora tiles (Takakamo Shizuno)"],
            ["when", [{"name": "tile_revealed", "opts": [-6]}, {"name": "tile_not_revealed", "opts": [-7]}], [["reveal_tile", -7]]],
            ["when", [{"name": "tile_revealed", "opts": [-8]}, {"name": "tile_not_revealed", "opts": [-9]}], [["reveal_tile", -9]]],
            ["when", [{"name": "tile_revealed", "opts": [-10]}, {"name": "tile_not_revealed", "opts": [-11]}], [["reveal_tile", -11]]],
            ["when", [{"name": "tile_revealed", "opts": [-12]}, {"name": "tile_not_revealed", "opts": [-13]}], [["reveal_tile", -13]]],
            ["when", [{"name": "tile_revealed", "opts": [-14]}, {"name": "tile_not_revealed", "opts": [-15]}], [["reveal_tile", -15]]],
            ["when", [{"name": "tile_revealed", "opts": [-16]}, {"name": "tile_not_revealed", "opts": [-17]}], [["reveal_tile", -17]]],
            ["when", [{"name": "tile_revealed", "opts": [-18]}, {"name": "tile_not_revealed", "opts": [-20]}], [["reveal_tile", -19]]],
            ["when", [{"name": "tile_revealed", "opts": [-6]}, {"name": "tile_not_revealed", "opts": [-9]}], [["reveal_tile", -9]]],
            ["when", [{"name": "tile_revealed", "opts": [-8]}, {"name": "tile_not_revealed", "opts": [-11]}], [["reveal_tile", -11]]],
            ["when", [{"name": "tile_revealed", "opts": [-10]}, {"name": "tile_not_revealed", "opts": [-13]}], [["reveal_tile", -13]]],
            ["when", [{"name": "tile_revealed", "opts": [-12]}, {"name": "tile_not_revealed", "opts": [-15]}], [["reveal_tile", -15]]],
            ["when", [{"name": "tile_revealed", "opts": [-14]}, {"name": "tile_not_revealed", "opts": [-17]}], [["reveal_tile", -17]]],
            ["when", [{"name": "tile_revealed", "opts": [-16]}, {"name": "tile_not_revealed", "opts": [-20]}], [["reveal_tile", -19]]]
          ]],
          ["when", [{"name": "tile_not_revealed", "opts": [-5]}], [["reveal_tile", "1x"]]],
          ["when", [{"name": "tile_not_revealed", "opts": [-7]}], [["reveal_tile", "1x"]]],
          ["when", [{"name": "tile_not_revealed", "opts": [-9]}], [["reveal_tile", "1x"]]],
          ["when", [{"name": "tile_not_revealed", "opts": [-11]}], [["reveal_tile", "1x"]]],
          ["when", [{"name": "tile_not_revealed", "opts": [-13]}], [["reveal_tile", "1x"]]]
        ]]
      ]],
      // count dora, aka, ura
      ["when", [{"name": "tile_revealed", "opts": [-6]}], [["add_counter", "dora", "count_dora", -6, ["hand", "calls", "winning_tile"]]]],
      ["when", [{"name": "tile_revealed", "opts": [-8]}], [["add_counter", "dora", "count_dora", -8, ["hand", "calls", "winning_tile"]]]],
      ["when", [{"name": "tile_revealed", "opts": [-10]}], [["add_counter", "dora", "count_dora", -10, ["hand", "calls", "winning_tile"]]]],
      ["when", [{"name": "tile_revealed", "opts": [-12]}], [["add_counter", "dora", "count_dora", -12, ["hand", "calls", "winning_tile"]]]],
      ["when", [{"name": "tile_revealed", "opts": [-14]}], [["add_counter", "dora", "count_dora", -14, ["hand", "calls", "winning_tile"]]]],
      ["when", [{"name": "tile_revealed", "opts": [-16]}], [["add_counter", "dora", "count_dora", -16, ["hand", "calls", "winning_tile"]]]],
      ["when", [{"name": "tile_revealed", "opts": [-18]}], [["add_counter", "dora", "count_dora", -18, ["hand", "calls", "winning_tile"]]]],
      ["when", [{"name": "match", "opts": [["hand", "calls", "winning_tile"], [[ "nojoker", [["0m"], 1] ]]]}], [["add_counter", "aka", 1]]],
      ["when", [{"name": "match", "opts": [["hand", "calls", "winning_tile"], [[ "nojoker", [["0p"], 1] ]]]}], [["add_counter", "aka", 1]]],
      ["when", [{"name": "match", "opts": [["hand", "calls", "winning_tile"], [[ "nojoker", [["0s"], 1] ]]]}], [["add_counter", "aka", 1]]],
      ["when", [{"name": "tile_revealed", "opts": [-5]}], [["add_counter", "ura", "count_dora", -5, ["hand", "calls", "winning_tile"]]]],
      ["when", [{"name": "tile_revealed", "opts": [-7]}], [["add_counter", "ura", "count_dora", -7, ["hand", "calls", "winning_tile"]]]],
      ["when", [{"name": "tile_revealed", "opts": [-9]}], [["add_counter", "ura", "count_dora", -9, ["hand", "calls", "winning_tile"]]]],
      ["when", [{"name": "tile_revealed", "opts": [-11]}], [["add_counter", "ura", "count_dora", -11, ["hand", "calls", "winning_tile"]]]],
      ["when", [{"name": "tile_revealed", "opts": [-13]}], [["add_counter", "ura", "count_dora", -13, ["hand", "calls", "winning_tile"]]]],
      ["when", [{"name": "tile_revealed", "opts": [-15]}], [["add_counter", "ura", "count_dora", -15, ["hand", "calls", "winning_tile"]]]],
      ["when", [{"name": "tile_revealed", "opts": [-17]}], [["add_counter", "ura", "count_dora", -17, ["hand", "calls", "winning_tile"]]]],
      // matsumi kuro doubles dora (unless they've discarded dora outside of riichi)
      ["when", [{"name": "status", "opts": ["matsumi-kuro"]}], [
        ["ite", [{"name": "status", "opts": ["matsumi_kuro_dora_disabled"]}], [
          ["multiply_counter", "dora", 0],
          ["multiply_counter", "aka", 0],
          ["multiply_counter", "ura", 0]
        ], [
          ["multiply_counter", "dora", 2],
          ["multiply_counter", "aka", 2],
          ["multiply_counter", "ura", 2]
        ]]
      ]],
      // handle iwadate yuan's abilities
      ["when", [{"name": "status", "opts": ["iwadate-yuan"]}], [
        // aka
        ["when", [{"name": "match", "opts": [["hand", "calls"], [[ "nojoker", [["0m"], 1] ]]]}], [["add_counter", "iwadate_yuan_payment", 1]]],
        ["when", [{"name": "match", "opts": [["hand", "calls"], [[ "nojoker", [["0p"], 1] ]]]}], [["add_counter", "iwadate_yuan_payment", 1]]],
        ["when", [{"name": "match", "opts": [["hand", "calls"], [[ "nojoker", [["0s"], 1] ]]]}], [["add_counter", "iwadate_yuan_payment", 1]]],
        // ippatsu
        ["when", [{"name": "status", "opts": ["ippatsu"]}, {"name": "status_missing", "opts": ["call_made"]}], [["add_counter", "iwadate_yuan_payment", 1]]],
        // ura
        ["when", [{"name": "status", "opts": ["riichi"]}, {"name": "not_others_status", "opts": ["takakamo-shizuno"]}], [
          ["when", [{"name": "tile_revealed", "opts": [-6]}], [["add_counter", "iwadate_yuan_payment", "count_dora", -5, ["hand", "calls"]]]],
          ["when", [{"name": "tile_revealed", "opts": [-8]}], [["add_counter", "iwadate_yuan_payment", "count_dora", -7, ["hand", "calls"]]]],
          ["when", [{"name": "tile_revealed", "opts": [-10]}], [["add_counter", "iwadate_yuan_payment", "count_dora", -9, ["hand", "calls"]]]],
          ["when", [{"name": "tile_revealed", "opts": [-12]}], [["add_counter", "iwadate_yuan_payment", "count_dora", -11, ["hand", "calls"]]]],
          ["when", [{"name": "tile_revealed", "opts": [-14]}], [["add_counter", "iwadate_yuan_payment", "count_dora", -13, ["hand", "calls"]]]],
          ["when", [{"name": "tile_revealed", "opts": [-16]}], [["add_counter", "iwadate_yuan_payment", "count_dora", -15, ["hand", "calls"]]]],
          ["when", [{"name": "tile_revealed", "opts": [-18]}], [["add_counter", "iwadate_yuan_payment", "count_dora", -17, ["hand", "calls"]]]]
        ]],
        // chun as five
        ["when", [{"name": "match", "opts": [["hand", "calls", "winning_tile"], [[[[{"tile": "7z", "attrs": ["golden"]}], 1]]]]}], [["set_status", "golden_chun"]]],
        ["when", [{"name": "match", "opts": [["hand", "calls", "winning_tile"], [[[[{"tile": "7z", "attrs": ["golden"]}], 1], [["7z"], 1]]]]}], [["set_status", "7z"]]],
        ["when", [{"name": "match", "opts": [["hand", "calls", "winning_tile"], [[[[{"tile": "7z", "attrs": ["golden"]}], 1], [["chun_pair"], 1]]]]}], [["set_status", "77z"]]],
        ["when", [{"name": "match", "opts": [["hand", "calls", "winning_tile"], [[[[{"tile": "7z", "attrs": ["golden"]}], 1], [["chun"], 1]]]]}], [["set_status", "777z"]]],
        ["when", [
          {"name": "status", "opts": ["golden_chun"]},
          [
            {"name": "status_missing", "opts": ["7z"]},
            [
              {"name": "status", "opts": ["77z"]},
              {"name": "match", "opts": [["hand", "calls", "winning_tile"], ["golden_chun_77z_win"]]}
            ],
            [
              {"name": "status", "opts": ["777z"]},
              {"name": "match", "opts": [["hand", "calls", "winning_tile"], ["golden_chun_777z_win"]]}
            ]
          ]
        ], [["add_counter", "iwadate_yuan_payment", 1]]],
        // multiply by 1000
        ["multiply_counter", "iwadate_yuan_payment", 1000]
      ]],
      // count round winds and seat winds (only relevant for saki, who can call multiple west winds)
      ["when", [{"name": "round_wind_is", "opts": ["east"]}], [["add_counter", "round_wind", "count_matches", ["hand", "calls", "winning_tile"], [[[["ton"], 1]]]]]],
      ["when", [{"name": "round_wind_is", "opts": ["south"]}], [["add_counter", "round_wind", "count_matches", ["hand", "calls", "winning_tile"], [[[["nan"], 1]]]]]],
      ["when", [{"name": "round_wind_is", "opts": ["west"]}], [["add_counter", "round_wind", "count_matches", ["hand", "calls", "winning_tile"], [[[["shaa"], 1]]]]]],
      ["when", [{"name": "round_wind_is", "opts": ["north"]}], [["add_counter", "round_wind", "count_matches", ["hand", "calls", "winning_tile"], [[[["pei"], 1]]]]]],
      ["when", [{"name": "seat_is", "opts": ["east"]}], [["add_counter", "seat_wind", "count_matches", ["hand", "calls", "winning_tile"], [[[["ton"], 1]]]]]],
      ["when", [{"name": "seat_is", "opts": ["south"]}], [["add_counter", "seat_wind", "count_matches", ["hand", "calls", "winning_tile"], [[[["nan"], 1]]]]]],
      ["when", [{"name": "seat_is", "opts": ["west"]}], [["add_counter", "seat_wind", "count_matches", ["hand", "calls", "winning_tile"], [[[["shaa"], 1]]]]]],
      ["when", [{"name": "seat_is", "opts": ["north"]}], [["add_counter", "seat_wind", "count_matches", ["hand", "calls", "winning_tile"], [[[["pei"], 1]]]]]],
      // mase yuuko gets 1 han per 3 identical tiles in discards
      ["when", [{"name": "status", "opts": ["mase-yuuko"]}], [["add_counter", "mase_yuuko_han", "count_matches", ["pond"], [[[["koutsu"], 1]]]]]],
      // matano seiko gets 1/2/3 han for 2/3/4 triplets
      ["when", [{"name": "status", "opts": ["matano-seiko"]}], [["add_counter", "matano_seiko_han", "count_matches", ["hand", "calls", "winning_tile"], [[[["koutsu", "pon", "daiminkan", "ankan", "kakan"], 2]]]]]],
      // matsumi yuu gets 1/2/3/4 han for 9/11/13/14 warm tiles
      ["when", [{"name": "status", "opts": ["matsumi-yuu"]}], [["add_counter", "warm_tiles", "count_matches", ["hand", "calls", "winning_tile"], [[[["1m","2m","3m","4m","5m","6m","7m","8m","9m","1p","3p","5p","6p","7p","9p","1s","5s","7s","9s","7z"], 1]]]]]],
      // sagimori arata gets 1/2/3/4 han for 8/10/13/14 reversible tiles
      ["when", [{"name": "status", "opts": ["sagimori-arata"]}], [["add_counter", "warm_tiles", "count_matches", ["hand", "calls", "winning_tile"], [[[["1p","2p","3p","4p","5p","8p","9p","2s","4s","5s","6s","8s","9s","5z"], 1]]]]]],
      // tsuruta himeko gets 1/2/3/4/5 han for 2/4/6/7/8 facedown tiles in discard
      ["when", [{"name": "status", "opts": ["tsuruta-himeko"]}], [["add_counter", "facedown_tiles", "num_facedown_tiles"]]],
      // kaijiki yuki gets 1 han per 2 facedown tiles in anyone's discard
      ["when", [{"name": "status", "opts": ["kajiki-yumi"]}], [["add_counter", "kajiki_yumi_han", "num_facedown_tiles_others"], ["divide_counter", "kajiki_yumi_han", 2]]],
      // shishihara sawaya gets 1 han per 2000 bet on the table
      ["when", [{"name": "status", "opts": ["shishihara-sawaya"]}], [["set_counter", "shishihara_sawaya_han", "pot"], ["divide_counter", "shishihara_sawaya_han", 2000]]],
      // ueshige suzu gets 1 han for every tile in hand matching tiles aside
      ["when", [{"name": "status", "opts": ["ueshige-suzu"]}, "has_aside"], [
        ["add_counter", "ueshige_suzu_han", "count_matching_ways", ["hand_any", "aside_unique"], [[[[[0, 0]], 1]]]],
        ["add_counter", "ueshige_suzu_han", "count_matching_ways", ["winning_tile", "aside_unique"], [[[[[0, 0]], 1]]]]
      ]],
      // suehara kyouko gets 1/2/3 han for 3/6/9 tiles set aside
      ["when", [{"name": "status", "opts": ["suehara-kyouko"]}], [["add_counter", "aside_tiles", "num_aside"]]],
      // usuzumi hatsumi gets 1 han per wind meld on the table
      ["when", [{"name": "status", "opts": ["usuzumi-hatsumi"]}], [["add_counter", "usuzumi_hatsumi_han", "count_matches", ["all_calls"], [[[["1z","2z","3z","4z"], 1]]]]]],
      // iwato kasumi gets 1 han for every 5 tiles revealed/melded
      ["when", [{"name": "status", "opts": ["iwato-kasumi"]}], [
        ["when", [{"name": "status", "opts": ["declare_manzu"]}], [
          ["add_counter", "iwato_kasumi_han", "num_matching_revealed_tiles_all", "manzu"],
          ["add_counter", "iwato_kasumi_han", "num_matching_melded_tiles_all", "manzu"]
        ]],
        ["when", [{"name": "status", "opts": ["declare_pinzu"]}], [
          ["add_counter", "iwato_kasumi_han", "num_matching_revealed_tiles_all", "pinzu"],
          ["add_counter", "iwato_kasumi_han", "num_matching_melded_tiles_all", "pinzu"]
        ]],
        ["when", [{"name": "status", "opts": ["declare_souzu"]}], [
          ["add_counter", "iwato_kasumi_han", "num_matching_revealed_tiles_all", "souzu"],
          ["add_counter", "iwato_kasumi_han", "num_matching_melded_tiles_all", "souzu"]
        ]],
        ["when", [{"name": "status", "opts": ["declare_jihai"]}], [
          ["add_counter", "iwato_kasumi_han", "num_matching_revealed_tiles_all", "jihai"],
          ["add_counter", "iwato_kasumi_han", "num_matching_melded_tiles_all", "jihai"]
        ]],
        ["divide_counter", "iwato_kasumi_han", 5]
      ]],
      // yoshitome miharu gets 1-2 han for winning with their voided suit
      ["when", [{"name": "status", "opts": ["yoshitome-miharu"]}, [
        [
          {"name": "status", "opts": ["yoshitome_miharu_manzu"]},
          {"name": "winning_hand_consists_of", "opts": ["1p","2p","3p","4p","5p","6p","7p","8p","9p","1s","2s","3s","4s","5s","6s","7s","8s","9s","1z","2z","3z","4z","5z","6z","7z"]}
        ],
        [
          {"name": "status", "opts": ["yoshitome_miharu_pinzu"]},
          {"name": "winning_hand_consists_of", "opts": ["1m","2m","3m","4m","5m","6m","7m","8m","9m","1s","2s","3s","4s","5s","6s","7s","8s","9s","1z","2z","3z","4z","5z","6z","7z"]}
        ],
        [
          {"name": "status", "opts": ["yoshitome_miharu_souzu"]},
          {"name": "winning_hand_consists_of", "opts": ["1m","2m","3m","4m","5m","6m","7m","8m","9m","1p","2p","3p","4p","5p","6p","7p","8p","9p","1z","2z","3z","4z","5z","6z","7z"]}
        ]
      ]], [["set_status", "yoshitome_miharu_han"]]],
      // kakura kurumi upgrades their chiitoitsu by the number of pairs in their discard
      ["when", [{"name": "status", "opts": ["kakura-kurumi"]}], [["add_counter", "kakura_kurumi_pairs", "count_matches", ["pond"], [[[["pair"], 1]]]]]],
      // miyanaga saki rinshan is a wildcard
      ["when", [{"name": "status", "opts": ["miyanaga-saki"]}], [["set_tile_alias", [["any", "rinshan"]], ["any"]]]],
      // amae koromo haitei/houtei is a wildcard
      ["when", [{"name": "status", "opts": ["amae-koromo"]}], [["set_tile_alias", [["any", "haitei"]], ["any"]]]],
      // karijuku tomoe riichi winning white dragon is a wildcard
      ["when", [{"name": "status", "opts": ["karijuku-tomoe", "riichi"]}], [["set_tile_alias", [["5z", "discard"], ["5z", "draw"]], ["any"]]]],
      // atago hiroe damaten doesn't have to pay for tsumo
      ["when_anyone", [{"name": "status", "opts": ["atago-hiroe", "tenpai"]}, {"name": "status_missing", "opts": ["riichi"]}], [["set_status", "atago_hiroe_no_tsumo_payment"]]],
      // maya yukiko gets double tsumo payment from players they call chii from
      ["when", [{"name": "status", "opts": ["maya-yukiko"]}, "won_by_draw"], [["as", "chii_victims", [["set_status", "double_tsumo_payment"]]]]],
      // nelly virsaladze dealing in means they take all bets on board
      // TODO implement this without hardcoding
      ["when", ["won_by_discard", {"name": "discarder_status", "opts": ["nelly-virsaladze"]}], [["as", "last_discarder", [["set_status", "nelly_virsaladze_take_bets"]]]]],
      ["when", ["won_by_call", {"name": "caller_status", "opts": ["nelly-virsaladze"]}], [["as", "caller", [["set_status", "nelly_virsaladze_take_bets"]]]]],
      // tsujigaito satoha gets double score under threat of ippatsu
      ["when", [{"name": "status", "opts": ["tsujigaito-satoha"]}, {"name": "others_status", "opts": ["ippatsu"]}], [["set_status", "tsujigaito_satoha_double_score"]]],
      // handle ezaki hitomi's ability
      ["when", ["won_by_draw"], [
        ["when_anyone", [{"name": "status", "opts": ["ezaki-hitomi", "tenpai"]}, "not_is_winner"], [["set_status", "ezaki_hitomi_bet_instead"]]]
      ]],
      // handle kanbara satomi's ability
      ["ite", [{"name": "has_attr", "opts": ["winning_tile", "rinshan"]}], [
        ["when_anyone", [{"name": "others_status", "opts": ["kanbara-satomi"]}, "dead_wall_ends_here"], [["set_status", "kanbara_satomi_double_loss"]]]
      ], [
        ["when_anyone", [{"name": "others_status", "opts": ["kanbara-satomi"]}, "wall_is_here"], [["set_status", "kanbara_satomi_double_loss"]]]
      ]]
    ]
  },
  "before_abortive_draw": {
    "actions": [
      ["when_anyone", ["wall_is_here", {"name": "others_status", "opts": ["kanbara-satomi"]}], [["set_status", "kanbara_satomi_double_loss"]]]
    ]
  },
  "before_exhaustive_draw": {
    "actions": [
      ["when_anyone", [{"name": "status", "opts": ["nelly-virsaladze"]}], [["set_status", "nelly_virsaladze_take_bets"]]],
      ["when_anyone", ["wall_is_here", {"name": "others_status", "opts": ["kanbara-satomi"]}], [["set_status", "kanbara_satomi_double_loss"]]]
    ]
  },
  "buttons": {
    "draft": {
      "display_name": "Draft Character Card",
      "show_when": [{"name": "status", "opts": ["drafting"]}],
      "actions": [
        ["unset_status", "drafting"],
        ["draft_saki_card", 4],
        ["when", [{"name": "not_anyone_status", "opts": ["drafting"]}], [["saki_start"]]]
      ],
      "unskippable": true
    },
    "atarashi_ako": {
      "display_name": "Swap a discard with same suit in hand",
      "show_when": ["all_saki_cards_drafted", {"name": "status_missing", "opts": ["match_start", "about_to_swap", "swap_interrupted"]}, {"name": "status", "opts": ["atarashi-ako", "just_called"]}, "not_just_discarded"],
      "actions": [
        ["big_text", "Atarashi Ako: swap!"],
        ["unset_status", "just_called"],
        ["mark", [["hand", 1, ["match_suit", "not_riichi"]], ["discard", 1, ["match_suit"]]]],
        ["push_message", "swapped a discard with a same-suit tile from hand (Atarashi Ako)"],
        ["set_status", "about_to_swap"],
        ["recalculate_buttons"], // allow interrupting swap
        ["unset_status", "about_to_swap"],
        ["ite", [{"name": "status", "opts": ["swap_interrupted"]}], [["clear_marking"], ["unset_status", "about_to_swap"]], [
          ["swap_tiles", {"hand": ["marked"]}, {"discard": ["marked"]}],
          ["clear_marking"],
          ["when", [{"name": "others_status", "opts": ["miyanaga-teru"]}], [["add_honba"]]],
          ["recalculate_buttons"] // allow tsumo to pop up
        ]]
      ]
    },
    "atarashi_ako_dora": {
      "display_name": "Swap dora indicator with same suit in hand",
      "show_when": ["all_saki_cards_drafted", {"name": "status_missing", "opts": ["match_start", "about_to_swap", "swap_interrupted"]}, {"name": "status", "opts": ["atarashi-ako", "just_called"]}, "not_just_discarded"],
      "actions": [
        ["big_text", "Atarashi Ako: swap!"],
        ["unset_status", "just_called"],
        ["mark", [["hand", 1, ["match_suit", "not_riichi"]], ["revealed_tile", 1, ["match_suit"]]]],
        ["push_message", "swapped a dora indicator with a same-suit tile from hand (Atarashi Ako)"],
        ["set_status", "about_to_swap"],
        ["recalculate_buttons"], // allow interrupting swap
        ["unset_status", "about_to_swap"],
        ["ite", [{"name": "status", "opts": ["swap_interrupted"]}], [["clear_marking"], ["unset_status", "about_to_swap"]], [
          ["swap_tiles", {"hand": ["marked"]}, {"revealed_tile": ["marked"]}],
          ["clear_marking"],
          ["when", [{"name": "others_status", "opts": ["miyanaga-teru"]}], [["add_honba"]]],
          ["recalculate_buttons"] // allow tsumo to pop up
        ]]
      ]
    },
    "choe_myeonghwa": {
      "display_name": "Swap last discard with a terminal/honor",
      "show_when": [
        "all_saki_cards_drafted",
        {"name": "status_missing", "opts": ["match_start", "riichi", "about_to_call", "about_to_swap"]},
        {"name": "status", "opts": ["choe-myeonghwa"]},
        "someone_else_just_discarded",
        {"name": "not_discarder_status", "opts": ["discard_passed"]},
        [
          [
            {"name": "seat_is", "opts": ["east"]},
            {"name": "match", "opts": [["last_discard"], [[[[["1z"]], 1]]]]}
          ],
          [
            {"name": "seat_is", "opts": ["south"]},
            {"name": "match", "opts": [["last_discard"], [[[[["2z"]], 1]]]]}
          ],
          [
            {"name": "seat_is", "opts": ["west"]},
            {"name": "match", "opts": [["last_discard"], [[[[["3z"]], 1]]]]}
          ],
          [
            {"name": "seat_is", "opts": ["north"]},
            {"name": "match", "opts": [["last_discard"], [[[[["4z"]], 1]]]]}
          ],
          [
            {"name": "round_wind_is", "opts": ["east"]},
            {"name": "match", "opts": [["last_discard"], [[[[["1z"]], 1]]]]}
          ],
          [
            {"name": "round_wind_is", "opts": ["south"]},
            {"name": "match", "opts": [["last_discard"], [[[[["2z"]], 1]]]]}
          ],
          [
            {"name": "round_wind_is", "opts": ["west"]},
            {"name": "match", "opts": [["last_discard"], [[[[["3z"]], 1]]]]}
          ],
          [
            {"name": "round_wind_is", "opts": ["north"]},
            {"name": "match", "opts": [["last_discard"], [[[[["4z"]], 1]]]]}
          ]
        ],
        {"name": "match", "opts": [["hand"], [[[["1m","9m","1p","9p","1s","9s","1z","2z","3z","4z","5z","6z","7z"], 1]]]]}
      ],
      "actions": [
        ["big_text", "Choe Myeonghwa: swap!"],
        ["unset_status", "just_called"],
        ["mark", [["hand", 1, ["terminal_honor"]], ["discard", 1, ["last_discard"]]]],
        ["push_message", "swapped a tile in hand with the last discard (Choe Myeonghwa)"],
        ["set_status", "about_to_swap"],
        ["recalculate_buttons"], // allow interrupting swap
        ["unset_status", "about_to_swap"],
        ["ite", [{"name": "status", "opts": ["swap_interrupted"]}], [["clear_marking"], ["unset_status", "about_to_swap"]], [
          ["swap_tiles", {"hand": ["marked"]}, {"discard": ["marked"]}],
          ["clear_marking"],
          ["advance_turn"],
          ["when", [{"name": "others_status", "opts": ["miyanaga-teru"]}], [["add_honba"]]]
        ]]
      ]
    },
    "haramura_nodoka": {
      "display_name": "Discard facedown",
      "show_when": ["all_saki_cards_drafted", "our_turn", "not_just_discarded", {"name": "status", "opts": ["haramura-nodoka", "ready"]}, {"name": "status_missing", "opts": ["match_start", "haramura-nodoka_exhausted", "discard_facedown"]}],
      "actions": [
        ["big_text", "Haramura Nodoka: discard!"],
        ["set_status", "haramura-nodoka_exhausted", "discard_facedown"],
        ["push_message", "discarded facedown (Haramura Nodoka)"]
      ]
    },
    "ikeda_kana": {
      "display_name": "Inazuma Riichi",
      "show_when": [
        "all_saki_cards_drafted",
        "our_turn",
        {"name": "not_status", "opts": ["match_start"]},
        {"name": "not_anyone_status", "opts": ["tried_to_ron"]},
        {"name": "status", "opts": ["ikeda-kana"]},
        "has_draw",
        {"name": "status_missing", "opts": ["riichi", "inazuma_riichi"]},
        {"name": "has_score", "opts": [5000]},
        "next_draw_possible",
        {"name": "has_no_call_named", "opts": ["chii", "pon", "daiminkan", "kakan"]},
        {"name": "match", "opts": [["hand", "calls", "draw"], ["tenpai"]]}
      ],
      "actions": [
        ["big_text", "Inazuma Riichi"],
        ["set_status", "inazuma_riichi", "just_reached", "ippatsu"],
        ["push_message", "declared inazuma riichi"],
        ["when", [{"name": "others_status", "opts": ["miyanaga-teru"]}], [["add_honba"]]],
        ["when", [{"name": "everyone_status", "opts": ["riichi"]}], [
          ["subtract_score", 5000],
          ["put_down_riichi_stick"],
          ["put_down_riichi_stick"],
          ["put_down_riichi_stick"],
          ["put_down_riichi_stick"],
          ["put_down_riichi_stick"],
          ["pause", 1000],
          ["abortive_draw", "Suucha Riichi"]
        ]]
      ]
    },
    "kataoka_yuuki": {
      "display_name": "Place 4 tiles at the end of the live wall (last selection is haitei)",
      "show_when": ["all_saki_cards_drafted", "our_turn", {"name": "status_missing", "opts": ["match_start", "kataoka-yuuki_exhausted"]}, {"name": "status", "opts": ["kataoka-yuuki"]}, {"name": "round_wind_is", "opts": ["east"]}],
      "actions": [
        ["big_text", "Kataoka Yuuki: mulligan!"],
        ["set_status", "kataoka-yuuki_exhausted"],
        ["mark", [["hand", 4, ["self"]]]],
        ["push_message", "added four tiles from hand to the end of the live wall, before drawing four more tiles (Kataoka Yuuki)"],
        ["extend_live_wall_with_marked"],
        ["draw", 4]
      ],
      "unskippable": true
    },
    "matano_seiko": {
      "display_name": "Set aside 4th tile from discards",
      "show_when": ["all_saki_cards_drafted", "our_turn", {"name": "status", "opts": ["matano-seiko", "pon"]}, "called_tile_matches_any_discard"],
      "actions": [
        ["big_text", "Matano Seiko: set aside!"],
        ["unset_status", "pon"],
        ["mark", [["discard", 1, ["match_called_tile"]]]],
        ["push_message", "set aside the discarded fourth copy of the pon tile (Matano Seiko)"],
        ["move_tiles", {"discard": ["marked"]}, "aside"],
        ["clear_marking"]
      ],
      "unskippable": true
    },
    "matano_seiko_skip": {
      "display_name": "Skip",
      "show_when": ["all_saki_cards_drafted", "our_turn", {"name": "status", "opts": ["matano-seiko", "pon"]}, "called_tile_matches_any_discard"],
      "actions": [["unset_status", "pon"]],
      "unskippable": true
    },
    "nanpo_kazue_nonskippable": {
      "display_name": "Place 2 tiles at the end of the dead wall (last selection is first kan draw)",
      "show_when": [
        "all_saki_cards_drafted",
        "our_turn",
        {"name": "status_missing", "opts": ["match_start", "nanpo-kazue_exhausted"]},
        {"name": "status", "opts": ["nanpo-kazue", "ready"]},
        {"name": "round_wind_is", "opts": ["south"]}
      ],
      "actions": [
        ["big_text", "Nanpo Kazue: mulligan!"],
        ["mark", [["hand", 2, ["self", "not_riichi"]]], [["set_status", "nanpo-kazue_exhausted"], ["draw", 2]]],
        ["push_message", "drew two tiles and added two tiles from hand at the end of the dead wall (Nanpo Kazue)"],
        ["extend_dead_wall_with_marked"],
        ["recalculate_buttons"] // allow tsumo
      ],
      "unskippable": true
    },
    "nanpo_kazue_skippable": {
      "display_name": "Place 2 tiles at the end of the dead wall (last selection is first kan draw)",
      "show_when": [
        "all_saki_cards_drafted",
        "anyone_just_discarded",
        {"name": "status_missing", "opts": ["match_start", "nanpo-kazue_exhausted2"]},
        {"name": "status", "opts": ["nanpo-kazue"]},
        {"name": "round_wind_is", "opts": ["south"]},
        {"name": "anyone", "opts": [{"name": "match", "opts": [["pond"], [[[["faceup"], 12]]]]}]}
      ],
      "actions": [
        ["big_text", "Nanpo Kazue: mulligan!"],
        ["mark", [["hand", 2, ["self", "not_riichi"]]], [["set_status", "nanpo-kazue_exhausted2"], ["draw", 2]]],
        ["push_message", "drew two tiles and added two tiles from hand at the end of the dead wall (Nanpo Kazue)"],
        ["extend_dead_wall_with_marked"],
        ["recalculate_buttons"], // allow tsumo
        ["advance_turn"]
      ]
    },
    "onjouji_toki_start": {
      "display_name": "Draw an extra tile and set it aside",
      "show_when": ["all_saki_cards_drafted", "our_turn", {"name": "status_missing", "opts": ["match_start", "onjouji-toki_exhausted"]}, {"name": "status", "opts": ["onjouji-toki", "ready"]}],
      "actions": [
        ["big_text", "Onjouji Toki: set aside!"],
        ["set_status", "onjouji-toki_exhausted", "onjouji_toki_drew"],
        ["draw_aside"],
        ["push_message", "drew and set aside an extra tile (Onjouji Toki)"]
      ],
      "unskippable": true
    },
    "onjouji_toki_draw": {
      "display_name": "Draw aside tile",
      "show_when": ["all_saki_cards_drafted", "our_turn", {"name": "status_missing", "opts": ["onjouji_toki_drew"]}, "has_aside", {"name": "status", "opts": ["onjouji-toki"]}],
      "actions": [
        ["big_text", "Onjouji Toki: draw!"],
        ["set_status", "onjouji_toki_drew"],
        ["draw_from_aside"],
        ["push_message", "drew the tile they set aside (Onjouji Toki)"]
      ],
      "unskippable": true
    },
    "onjouji_toki_nodraw": {
      "display_name": "Draw from wall",
      "show_when": ["all_saki_cards_drafted", "our_turn", {"name": "status_missing", "opts": ["onjouji_toki_drew"]}, "has_aside", {"name": "status", "opts": ["onjouji-toki"]}],
      "actions": [
        ["set_status", "onjouji_toki_drew"],
        ["draw"]
      ],
      "unskippable": true
    },
    "onjouji_toki_swap": {
      "display_name": "Swap tile with aside",
      "show_when": ["all_saki_cards_drafted", "our_turn", "has_draw", "not_just_discarded", "not_just_called", {"name": "status", "opts": ["onjouji-toki", "onjouji_toki_drew"]}, {"name": "status_missing", "opts": ["just_reached"]}, "has_aside"],
      "actions": [
        ["big_text", "Onjouji Toki: swap!"],
        ["mark", [["hand", 1, ["not_riichi"]]]],
        ["swap_tiles", {"hand": ["marked"]}, "aside"],
        ["clear_marking"],
        ["push_message", "swapped a tile from hand with the tile they set aside (Onjouji Toki)"],
        ["recalculate_buttons"] // allow tsumo to pop up
      ]
    },
    "sawamura_tomoki": {
      "display_name": "Discard facedown",
      "show_when": ["all_saki_cards_drafted", "our_turn", {"name": "status_missing", "opts": ["match_start", "discard_facedown"]}, {"name": "status", "opts": ["sawamura-tomoki"]}, {"name": "others_status", "opts": ["ippatsu"]}, "has_draw", "not_just_discarded"],
      "actions": [
        ["big_text", "Sawamura Tomoki: discard!"],
        ["set_status", "discard_facedown"],
        ["push_message", "discarded facedown after being threatened by ippatsu (Sawamura Tomoki)"]
      ]
    },
    "shibuya_takami": {
      "display_name": "Draw from your discards",
      "show_when": ["all_saki_cards_drafted", "our_turn", {"name": "status_missing", "opts": ["match_start", "discards_empty"]}, {"name": "status", "opts": ["shibuya-takami", "about_to_draw"]}, "not_just_discarded"],
      "actions": [
        ["big_text", "Shibuya Takami: draw!"],
        ["unset_status", "about_to_draw"],
        ["mark", [["discard", 1, ["self"]]]],
        ["push_message", "drew one of their discards (Shibuya Takami)"], // TODO: say which one!
        ["move_tiles", {"discard": ["marked"]}, "draw"],
        ["clear_marking"],
        ["add_attr", ["draw"], ["facedown", "no_discard"]]
      ],
      "unskippable": true
    },
    "shibuya_takami_skip": {
      "display_name": "Skip",
      "show_when": ["all_saki_cards_drafted", "our_turn", {"name": "status_missing", "opts": ["match_start", "discards_empty"]}, {"name": "status", "opts": ["shibuya-takami", "about_to_draw"]}, "not_just_discarded"],
      "actions": [["unset_status", "about_to_draw"], ["draw", 1]],
      "unskippable": true
    },
    "takimi_haru": {
      "display_name": "Discard facedown",
      "show_when": ["all_saki_cards_drafted", "our_turn", {"name": "status_missing", "opts": ["match_start", "discard_facedown"]}, {"name": "status", "opts": ["takimi-haru", "chii"]}, "not_just_discarded"],
      "actions": [
        ["big_text", "Takimi Haru: discard!"],
        ["set_status", "discard_facedown"],
        ["push_message", "discarded facedown after calling chii (Takimi Haru)"]
      ]
    },
    "amae_koromo": {
      "display_name": "Move haitei tile from live wall to dead wall",
      "show_when": [
        "all_saki_cards_drafted",
        "our_turn",
        {"name": "status_missing", "opts": ["match_start"]},
        {"name": "status", "opts": ["amae-koromo"]},
        "just_discarded",
        "not_no_tiles_remaining"
      ],
      "actions": [
        ["big_text", "Amae Koromo: shift!"],
        ["shift_tile_to_dead_wall", 1],
        ["push_message", "shifted a tile from the end of the live wall to the start of the dead wall (Amae Koromo)"],
        ["advance_turn"]
      ]
    },
    "amae_koromo_2": {
      "display_name": "Move two tiles instead",
      "show_when": [
        "all_saki_cards_drafted",
        "our_turn",
        {"name": "status_missing", "opts": ["match_start"]},
        {"name": "status", "opts": ["amae-koromo"]},
        {"name": "not_status_missing", "opts": ["riichi", "just_reached"]},
        {"name": "not_others_status", "opts": ["riichi"]},
        "just_discarded",
        {"name": "tiles_remaining", "opts": [2]}
      ],
      "actions": [
        ["big_text", "Amae Koromo: shift 2!"],
        ["shift_tile_to_dead_wall", 2],
        ["push_message", "shifted two tiles from the end of the live wall to the start of the dead wall (Amae Koromo)"],
        ["advance_turn"]
      ]
    },
    "atago_kinue": {
      "display_name": "Bet 1000 to change wait to aside tiles",
      "show_when": [
        "all_saki_cards_drafted",
        "our_turn",
        {"name": "status_missing", "opts": ["match_start"]},
        {"name": "status", "opts": ["atago-kinue", "tenpai", "ready"]},
        {"name": "status_missing", "opts": ["atago_kinue_aside_waits"]},
        "not_just_discarded",
        "has_aside"
      ],
      "actions": [
        ["big_text", "Atago Kinue: change waits!"],
        ["bet_points", 1000],
        ["set_status", "atago_kinue_aside_waits", "just_changed_atago_kinue_aside_waits"],
        ["push_message", "bet 1000 to wait on aside tiles (Atago Kinue)"]
      ]
    },
    "kunihiro_hajime": {
      "display_name": "Swap a number tile with any same number discard",
      "show_when": [
        "all_saki_cards_drafted",
        {"name": "status", "opts": ["kunihiro-hajime", "ready"]},
        {"name": "status_missing", "opts": ["match_start", "discards_empty", "just_swapped", "kunihiro-hajime_exhausted", "just_reached", "about_to_swap"]},
        "our_turn",
        "not_just_discarded"
      ],
      "actions": [
        ["big_text", "Kunihiro Hajime: swap!"],
        ["set_status", "just_swapped", "kunihiro-hajime_exhausted"],
        ["mark", [["hand", 1, ["match_number", "not_riichi"]], ["discard", 1, ["match_number"]]]],
        ["push_message", "swapped a discard with a same-number tile from hand (Kunihiro Hajime)"],
        ["set_status", "about_to_swap"],
        ["recalculate_buttons"], // allow interrupting swap
        ["unset_status", "about_to_swap"],
        ["ite", [{"name": "status", "opts": ["swap_interrupted"]}], [["clear_marking"], ["unset_status", "about_to_swap"]], [
          ["swap_tiles", {"hand": ["marked"]}, {"discard": ["marked"]}],
          ["clear_marking"],
          ["when", [{"name": "others_status", "opts": ["miyanaga-teru"]}], [["add_honba"]]],
          ["recalculate_buttons"] // allow tsumo to pop up
        ]]
      ]
    },
    "kunihiro_hajime_interrupt": {
      "display_name": "Swap a number tile with any same number discard",
      "show_when": [
        "all_saki_cards_drafted",
        {"name": "status", "opts": ["kunihiro-hajime"]},
        {"name": "status_missing", "opts": ["match_start", "discards_empty", "just_swapped", "just_reached", "about_to_swap"]},
        [
          {"name": "others_status", "opts": ["just_reached"]},
          {"name": "others_status", "opts": ["kan"]}
        ]
      ],
      "actions": [
        ["big_text", "Kunihiro Hajime: swap!"],
        ["set_status", "just_swapped"],
        ["mark", [["hand", 1, ["match_number", "not_riichi"]], ["discard", 1, ["match_number"]]]],
        ["push_message", "swapped a discard with a same-number tile from hand (Kunihiro Hajime)"],
        ["set_status", "about_to_swap"],
        ["recalculate_buttons"], // allow interrupting swap
        ["unset_status", "about_to_swap"],
        ["ite", [{"name": "status", "opts": ["swap_interrupted"]}], [["clear_marking"], ["unset_status", "about_to_swap"]], [
          ["swap_tiles", {"hand": ["marked"]}, {"discard": ["marked"]}],
          ["clear_marking"],
          ["when", [{"name": "others_status", "opts": ["miyanaga-teru"]}], [["add_honba"]]],
          ["recalculate_buttons"] // allow tsumo to pop up
        ]]
      ]
    },
    "motouchi_naruka_interrupt_call": {
      "display_name": "Interrupt call",
      "show_when": [
        "all_saki_cards_drafted",
        {"name": "status", "opts": ["motouchi-naruka"]},
        "just_discarded",
        [
          {"name": "others_status", "opts": ["about_to_call", "chii"]},
          {"name": "others_status", "opts": ["about_to_call", "pon"]},
          {"name": "others_status", "opts": ["about_to_call", "daiminkan"]}
        ],
        {"name": "not_others_status", "opts": ["call_interrupted"]},
        {"name": "status_missing", "opts": ["motouchi_naruka_skip_interrupt"]},
        {"name": "has_score", "opts": [1000]}
      ],
      "actions": [
        ["big_text", "Motouchi Naruka: interrupt!"],
        ["bet_points", 1000],
        ["push_message", "bet 1000 points to prevent discard being called (Motouchi Naruka)"],
        ["when_anyone", [{"name": "status", "opts": ["about_to_call"]}], [["set_status", "call_interrupted"], ["unset_status", "about_to_call"]]],
        ["advance_turn"]
      ],
      "unskippable": true
    },
    "motouchi_naruka_interrupt_swap": {
      "display_name": "Interrupt swap",
      "show_when": [
        "all_saki_cards_drafted",
        {"name": "status", "opts": ["motouchi-naruka"]},
        {"name": "others_status", "opts": ["about_to_swap"]},
        {"name": "not_others_status", "opts": ["swap_interrupted"]},
        {"name": "status_missing", "opts": ["motouchi_naruka_skip_interrupt"]},
        {"name": "has_score", "opts": [1000]}
      ],
      "actions": [
        ["big_text", "Motouchi Naruka: interrupt!"],
        ["bet_points", 1000],
        ["push_message", "bet 1000 points to prevent a tile swap (Motouchi Naruka)"],
        ["when_anyone", [{"name": "status", "opts": ["about_to_swap"]}], [["set_status", "swap_interrupted"]]],
        ["resume_deferred_actions"]
      ],
      "unskippable": true
    },
    "motouchi_naruka_interrupt_facedown": {
      "display_name": "Interrupt facedown discard",
      "show_when": [
        "all_saki_cards_drafted",
        {"name": "status", "opts": ["motouchi-naruka"]},
        "someone_else_just_discarded",
        {"name": "not_discarder_status", "opts": ["discard_passed"]},
        {"name": "others_status", "opts": ["discard_facedown"]},
        {"name": "status_missing", "opts": ["motouchi_naruka_skip_interrupt"]},
        {"name": "has_score", "opts": [1000]}
      ],
      "actions": [
        ["big_text", "Motouchi Naruka: interrupt!"],
        ["bet_points", 1000],
        ["push_message", "bet 1000 points to prevent a facedown discard (Motouchi Naruka)"],
        ["flip_last_discard_faceup"],
        ["resume_deferred_actions"]
      ],
      "unskippable": true
    },
    "motouchi_naruka_interrupt_call_skip": {
      "display_name": "Skip",
      "show_when": [
        "all_saki_cards_drafted",
        {"name": "status", "opts": ["motouchi-naruka"]},
        "just_discarded",
        {"name": "not_discarder_status", "opts": ["discard_passed"]},
        [
          {"name": "others_status", "opts": ["about_to_call", "chii"]},
          {"name": "others_status", "opts": ["about_to_call", "pon"]},
          {"name": "others_status", "opts": ["about_to_call", "daiminkan"]}
        ],
        {"name": "not_others_status", "opts": ["call_interrupted"]},
        {"name": "status_missing", "opts": ["motouchi_naruka_skip_interrupt"]}
      ],
      "actions": [["set_status", "motouchi_naruka_skip_interrupt"], ["resume_deferred_actions"]],
      "unskippable": true
    },
    "motouchi_naruka_interrupt_swap_facedown_skip": {
      "display_name": "Skip",
      "show_when": [
        "all_saki_cards_drafted",
        {"name": "status", "opts": ["motouchi-naruka"]},
        [
          {"name": "others_status", "opts": ["about_to_swap"]},
          [
            "someone_else_just_discarded",
            {"name": "not_discarder_status", "opts": ["discard_passed"]},
            {"name": "others_status", "opts": ["discard_facedown"]}
          ]
        ],
        {"name": "not_others_status", "opts": ["swap_interrupted"]},
        {"name": "status_missing", "opts": ["motouchi_naruka_skip_interrupt"]}
      ],
      "actions": [["set_status", "motouchi_naruka_skip_interrupt"], ["resume_deferred_actions"]],
      "unskippable": true
    },
    "shirouzu_mairu_1_manzu": {
      "display_name": "Manzu",
      "show_when": ["all_saki_cards_drafted", "our_turn", {"name": "status", "opts": ["shirouzu-mairu"]}, {"name": "status_missing", "opts": ["shirouzu_mairu_drew", "just_called", "extra_turn"]}, {"name": "not_anyone_status", "opts": ["tried_to_ron"]}],
      "actions": [
        ["set_status", "shirouzu_mairu_drew"],
        ["draw"],
        ["add_attr", ["draw"], ["revealed"]],
        ["when", [{"name": "match", "opts": [["draw"], [[[["1m","2m","3m","4m","5m","6m","7m","8m","9m"], 1]]]]}], [
          ["push_message", "correctly predicted that their next draw is manzu (Shirouzu Mairu)"],
          ["big_text", "Shirouzu Mairu: switch out!"],
          ["flip_first_visible_discard_facedown"],
          ["unset_status", "shirouzu-mairu"],
          ["set_status", "tsuruta-himeko"]
        ]]
      ],
      "unskippable": true
    },
    "shirouzu_mairu_2_pinzu": {
      "display_name": "Pinzu",
      "show_when": ["all_saki_cards_drafted", "our_turn", {"name": "status", "opts": ["shirouzu-mairu"]}, {"name": "status_missing", "opts": ["shirouzu_mairu_drew", "just_called", "extra_turn"]}, {"name": "not_anyone_status", "opts": ["tried_to_ron"]}],
      "actions": [
        ["set_status", "shirouzu_mairu_drew"],
        ["draw"],
        ["add_attr", ["draw"], ["revealed"]],
        ["when", [{"name": "match", "opts": [["draw"], [[[["1p","2p","3p","4p","5p","6p","7p","8p","9p"], 1]]]]}], [
          ["push_message", "correctly predicted that their next draw is pinzu (Shirouzu Mairu)"],
          ["big_text", "Shirouzu Mairu: switch out!"],
          ["flip_first_visible_discard_facedown"],
          ["unset_status", "shirouzu-mairu"],
          ["set_status", "tsuruta-himeko"]
        ]]
      ],
      "unskippable": true
    },
    "shirouzu_mairu_3_souzu": {
      "display_name": "Souzu",
      "show_when": ["all_saki_cards_drafted", "our_turn", {"name": "status", "opts": ["shirouzu-mairu"]}, {"name": "status_missing", "opts": ["shirouzu_mairu_drew", "just_called", "extra_turn"]}, {"name": "not_anyone_status", "opts": ["tried_to_ron"]}],
      "actions": [
        ["set_status", "shirouzu_mairu_drew"],
        ["draw"],
        ["add_attr", ["draw"], ["revealed"]],
        ["when", [{"name": "match", "opts": [["draw"], [[[["1s","2s","3s","4s","5s","6s","7s","8s","9s"], 1]]]]}], [
          ["push_message", "correctly predicted that their next draw is souzu (Shirouzu Mairu)"],
          ["big_text", "Shirouzu Mairu: switch out!"],
          ["flip_first_visible_discard_facedown"],
          ["unset_status", "shirouzu-mairu"],
          ["set_status", "tsuruta-himeko"]
        ]]
      ],
      "unskippable": true
    },
    "shirouzu_mairu_4_jihai": {
      "display_name": "Jihai",
      "show_when": ["all_saki_cards_drafted", "our_turn", {"name": "status", "opts": ["shirouzu-mairu"]}, {"name": "status_missing", "opts": ["shirouzu_mairu_drew", "just_called", "extra_turn"]}, {"name": "not_anyone_status", "opts": ["tried_to_ron"]}],
      "actions": [
        ["set_status", "shirouzu_mairu_drew"],
        ["draw"],
        ["add_attr", ["draw"], ["revealed"]],
        ["when", [{"name": "match", "opts": [["draw"], [[[["1z","2z","3z","4z","5z","6z","7z"], 1]]]]}], [
          ["push_message", "correctly predicted that their next draw is jihai (Shirouzu Mairu)"],
          ["big_text", "Shirouzu Mairu: switch out!"],
          ["flip_first_visible_discard_facedown"],
          ["unset_status", "shirouzu-mairu"],
          ["set_status", "tsuruta-himeko"]
        ]]
      ],
      "unskippable": true
    },
    "suehara_kyouko": {
      "display_name": "Reveal and set aside 3 tiles",
      "show_when": [
        "all_saki_cards_drafted",
        {"name": "status", "opts": ["suehara-kyouko"]},
        ["not_our_turn", "not_just_discarded", ["just_discarded", {"name": "status", "opts": ["ippatsu"]}]],
        {"name": "not_discarder_status", "opts": ["discard_passed"]},
        {"name": "status_missing", "opts": ["suehara_kyouko_set_aside"]},
        [
          {"name": "status", "opts": ["call_made"]},
          {"name": "anyone_status", "opts": ["just_reached"]},
          {"name": "anyone_status", "opts": ["discard_facedown"]}
        ]
      ],
      "actions": [
        ["set_status", "suehara_kyouko_set_aside"],
        ["draw_aside", 3],
        ["add_attr", ["aside"], ["revealed"]],
        // if this was triggered by riichi, we interrupted the turn change after discard, so we need to resume play
        ["when", ["anyone_just_discarded"], [["resume_deferred_actions"]]]
      ]
    },
    "draw_from_suehara_kyouko_self": {
      "display_name": "Draw from aside",
      "show_when": [
        "all_saki_cards_drafted",
        "our_turn",
        "not_just_discarded",
        ["not_just_called", {"name": "status", "opts": ["kan"]}],
        {"name": "status", "opts": ["suehara-kyouko"]},
        {"name": "has_aside", "opts": ["self"]},
        "not_has_draw"
      ],
      "actions": [
        ["mark", [["aside", 1, ["self"]]]],
        ["unset_status", "kan"],
        ["push_message", "drew from their aside tiles (Suehara Kyouko)"],
        ["move_tiles", {"aside": ["marked", "self"]}, "draw"],
        ["clear_marking"],
        ["recalculate_buttons"] // riichi, tsumo, etc
      ],
      "unskippable": true
    },
    "draw_from_suehara_kyouko_shimocha": {
      "display_name": "Draw from Suehara Kyouko's aside",
      "show_when": [
        "all_saki_cards_drafted",
        "our_turn",
        "not_just_discarded",
        ["not_just_called", {"name": "status", "opts": ["kan"]}],
        {"name": "shimocha_status", "opts": ["suehara-kyouko"]},
        {"name": "has_aside", "opts": ["shimocha"]},
        "not_has_draw"
      ],
      "actions": [
        ["mark", [["aside", 1, ["shimocha"]]]],
        ["unset_status", "kan"],
        ["push_message", "drew from shimocha's aside tiles (Suehara Kyouko)"],
        ["move_tiles", {"aside": ["marked", "shimocha"]}, "draw"],
        ["clear_marking"],
        ["recalculate_buttons"] // riichi, tsumo, etc
      ],
      "unskippable": true
    },
    "draw_from_suehara_kyouko_toimen": {
      "display_name": "Draw from Suehara Kyouko's aside",
      "show_when": [
        "all_saki_cards_drafted",
        "our_turn",
        "not_just_discarded",
        ["not_just_called", {"name": "status", "opts": ["kan"]}],
        {"name": "toimen_status", "opts": ["suehara-kyouko"]},
        {"name": "has_aside", "opts": ["toimen"]},
        "not_has_draw"
      ],
      "actions": [
        ["mark", [["aside", 1, ["toimen"]]]],
        ["unset_status", "kan"],
        ["push_message", "drew from toimen's aside tiles (Suehara Kyouko)"],
        ["move_tiles", {"aside": ["marked", "toimen"]}, "draw"],
        ["clear_marking"],
        ["recalculate_buttons"] // riichi, tsumo, etc
      ],
      "unskippable": true
    },
    "draw_from_suehara_kyouko_kamicha": {
      "display_name": "Draw from Suehara Kyouko's aside",
      "show_when": [
        "all_saki_cards_drafted",
        "our_turn",
        "not_just_discarded",
        ["not_just_called", {"name": "status", "opts": ["kan"]}],
        {"name": "kamicha_status", "opts": ["suehara-kyouko"]},
        {"name": "has_aside", "opts": ["kamicha"]},
        "not_has_draw"
      ],
      "actions": [
        ["mark", [["aside", 1, ["kamicha"]]]],
        ["unset_status", "kan"],
        ["push_message", "drew from kamicha's aside tiles (Suehara Kyouko)"],
        ["move_tiles", {"aside": ["marked", "kamicha"]}, "draw"],
        ["clear_marking"],
        ["recalculate_buttons"] // riichi, tsumo, etc
      ],
      "unskippable": true
    },
    "draw_from_suehara_kyouko_skip": {
      "display_name": "Draw from wall",
      "show_when": [
        "all_saki_cards_drafted",
        "our_turn",
        "not_just_discarded",
        ["not_just_called", {"name": "status", "opts": ["kan"]}],
        [
          [
            {"name": "status", "opts": ["suehara-kyouko"]},
            {"name": "has_aside", "opts": ["self"]}
          ],
          [
            {"name": "shimocha_status", "opts": ["suehara-kyouko"]},
            {"name": "has_aside", "opts": ["shimocha"]}
          ],
          [
            {"name": "toimen_status", "opts": ["suehara-kyouko"]},
            {"name": "has_aside", "opts": ["toimen"]}
          ],
          [
            {"name": "kamicha_status", "opts": ["suehara-kyouko"]},
            {"name": "has_aside", "opts": ["kamicha"]}
          ]
        ],
        "not_has_draw"
      ],
      "actions": [["draw"]],
      "unskippable": true
    },
    "iwato_kasumi_1_manzu": {
      "display_name": "Manzu",
      "show_when": [
        "all_saki_cards_drafted",
        "our_turn",
        {"name": "status", "opts": ["iwato-kasumi", "ready"]},
        {"name": "status_missing", "opts": ["declare_manzu", "declare_pinzu", "declare_souzu", "declare_jihai"]}
      ],
      "actions": [
        ["set_status", "declare_manzu"],
        ["as", "others", [["set_status", "reveal_manzu"]]],
        ["push_message", "declared that all manzu must be revealed (Iwato Kasumi)"],
        ["when_anyone", [{"name": "status", "opts": ["reveal_manzu"]}], [["add_attr", ["hand", "draw", "aside"], ["revealed"], ["manzu"]]]]
      ],
      "unskippable": true
    },
    "iwato_kasumi_2_pinzu": {
      "display_name": "Pinzu",
      "show_when": [
        "all_saki_cards_drafted",
        "our_turn",
        {"name": "status", "opts": ["iwato-kasumi", "ready"]},
        {"name": "status_missing", "opts": ["declare_manzu", "declare_pinzu", "declare_souzu", "declare_jihai"]}
      ],
      "actions": [
        ["set_status", "declare_pinzu"],
        ["as", "others", [["set_status", "reveal_pinzu"]]],
        ["push_message", "declared that all pinzu must be revealed (Iwato Kasumi)"],
        ["when_anyone", [{"name": "status", "opts": ["reveal_pinzu"]}], [["add_attr", ["hand", "draw", "aside"], ["revealed"], ["pinzu"]]]]
      ],
      "unskippable": true
    },
    "iwato_kasumi_3_souzu": {
      "display_name": "Souzu",
      "show_when": [
        "all_saki_cards_drafted",
        "our_turn",
        {"name": "status", "opts": ["iwato-kasumi", "ready"]},
        {"name": "status_missing", "opts": ["declare_manzu", "declare_pinzu", "declare_souzu", "declare_jihai"]}
      ],
      "actions": [
        ["set_status", "declare_souzu"],
        ["as", "others", [["set_status", "reveal_souzu"]]],
        ["push_message", "declared that all souzu must be revealed (Iwato Kasumi)"],
        ["when_anyone", [{"name": "status", "opts": ["reveal_souzu"]}], [["add_attr", ["hand", "draw", "aside"], ["revealed"], ["souzu"]]]]
      ],
      "unskippable": true
    },
    "iwato_kasumi_4_jihai": {
      "display_name": "Jihai",
      "show_when": [
        "all_saki_cards_drafted",
        "our_turn",
        {"name": "status", "opts": ["iwato-kasumi", "ready"]},
        {"name": "status_missing", "opts": ["declare_manzu", "declare_pinzu", "declare_souzu", "declare_jihai"]}
      ],
      "actions": [
        ["set_status", "declare_jihai"],
        ["as", "others", [["set_status", "reveal_jihai"]]],
        ["push_message", "declared that all jihai must be revealed (Iwato Kasumi)"],
        ["when_anyone", [{"name": "status", "opts": ["reveal_jihai"]}], [["add_attr", ["hand", "draw", "aside"], ["revealed"], ["jihai"]]]]
      ],
      "unskippable": true
    },
    "hanada_kirame": {
      "display_name": "Bet half of points to flip 3 dora indicators",
      "show_when": [
        "all_saki_cards_drafted",
        "our_turn",
        {"name": "status", "opts": ["hanada-kirame", "hanada_kirame_choice"]},
        {"name": "has_score_below", "opts": [10000]},
        {"name": "tiles_remaining", "opts": [6]}
      ],
      "actions": [
        ["unset_status", "hanada_kirame_choice"],
        ["bet_points", "half_score"],
        ["when", [{"name": "tile_revealed", "opts": [-14]}, {"name": "tile_not_revealed", "opts": [-16]}], [["reveal_tile", -16], ["reveal_tile", -18], ["reveal_tile", -20]]],
        ["when", [{"name": "tile_revealed", "opts": [-12]}, {"name": "tile_not_revealed", "opts": [-14]}], [["reveal_tile", -14], ["reveal_tile", -16], ["reveal_tile", -18]]],
        ["when", [{"name": "tile_revealed", "opts": [-10]}, {"name": "tile_not_revealed", "opts": [-12]}], [["reveal_tile", -12], ["reveal_tile", -14], ["reveal_tile", -16]]],
        ["when", [{"name": "tile_revealed", "opts": [-8]}, {"name": "tile_not_revealed", "opts": [-10]}], [["reveal_tile", -10], ["reveal_tile", -12], ["reveal_tile", -14]]],
        ["when", [{"name": "tile_revealed", "opts": [-6]}, {"name": "tile_not_revealed", "opts": [-8]}], [["reveal_tile", -8], ["reveal_tile", -10], ["reveal_tile", -12]]]
      ],
      "unskippable": true
    },
    "fukuji_mihoko": {
      "display_name": "Discard facedown",
      "show_when": [
        "all_saki_cards_drafted",
        "our_turn",
        "not_just_discarded",
        {"name": "status", "opts": ["fukuji-mihoko", "ready"]},
        {"name": "status_missing", "opts": ["match_start", "discard_facedown"]},
        {"name": "match", "opts": [["self_last_discard", "kamicha_last_discard"], [[[[[0, 0]], 1]]]]}
      ],
      "actions": [
        ["big_text", "Fukuji Mihoko: extra turn!"],
        ["set_status", "discard_facedown", "extra_turn"],
        ["push_message", "discards facedown and gets an extra turn due to someone discarding the same tile (Fukuji Mihoko)"]
      ]
    },
    "usuzumi_hatsumi": {
      "display_name": "Swap a number tile with any discarded wind tile",
      "show_when": [
        "all_saki_cards_drafted",
        "our_turn",
        "not_just_discarded",
        "just_called",
        {"name": "status", "opts": ["usuzumi-hatsumi", "ready"]},
        {"name": "status_missing", "opts": ["match_start", "just_swapped", "just_reached", "about_to_swap"]},
        {"name": "match", "opts": [["all_discards"], [[[["1z","2z","3z","4z"], 1]]]]},
        {"name": "match", "opts": [["hand"], [[[["1m","2m","3m","4m","5m","6m","7m","8m","9m","1p","2p","3p","4p","5p","6p","7p","8p","9p","1s","2s","3s","4s","5s","6s","7s","8s","9s"], 1]]]]}
      ],
      "actions": [
        ["big_text", "Usuzumi Hatsumi: swap!"],
        ["set_status", "just_swapped"],
        ["mark", [["hand", 1, ["suited", "not_riichi"]], ["discard", 1, ["wind"]]]],
        ["push_message", "swapped a discarded wind tile with a number tile from hand (Usuzumi Hatsumi)"],
        ["set_status", "about_to_swap"],
        ["recalculate_buttons"], // allow interrupting swap
        ["unset_status", "about_to_swap"],
        ["ite", [{"name": "status", "opts": ["swap_interrupted"]}], [["clear_marking"], ["unset_status", "about_to_swap"]], [
          ["swap_tiles", {"hand": ["marked"]}, {"discard": ["marked"]}],
          ["clear_marking"],
          ["when", [{"name": "others_status", "opts": ["miyanaga-teru"]}], [["add_honba"]]],
          ["recalculate_buttons"] // allow tsumo to pop up
        ]]
      ]
    },
    "yae_kobashiri_iishanten": {
      "display_name": "Declare iishanten",
      "show_when": [
        "all_saki_cards_drafted",
        "our_turn",
        {"name": "status", "opts": ["yae-kobashiri", "ready"]},
        {"name": "status_missing", "opts": ["match_start", "riichi", "iishanten"]},
        {"name": "hand_tile_count", "opts": [2, 5, 8, 11, 14]},
        {"name": "has_no_call_named", "opts": ["chii", "pon", "daiminkan", "kakan"]},
        {"name": "match", "opts": [["hand", "calls", "draw"], ["iishanten"]]}
      ],
      "actions": [
        ["big_text", "Yae Kobashiri: iishanten!"],
        ["set_status", "iishanten", "just_iishantened"],
        ["push_message", "declared iishanten (Yae Kobashiri)"]
      ]
    },
    "yae_kobashiri_self_riichi": {
      "display_name": "Riichi",
      "show_when": [
        "all_saki_cards_drafted",
        "our_turn",
        {"name": "status", "opts": ["yae-kobashiri", "ready", "iishanten"]},
        {"name": "status_missing", "opts": ["match_start", "riichi"]},
        {"name": "hand_tile_count", "opts": [2, 5, 8, 11, 14]},
        {"name": "has_no_call_named", "opts": ["chii", "pon", "daiminkan", "kakan"]},
        {"name": "has_score", "opts": [1000]},
        "next_draw_possible",
        {"name": "match", "opts": [["hand", "calls", "draw"], ["tenpai_14"]]}
      ],
      "actions": [
        ["big_text", "Riichi"],
        ["when", [{"name": "others_status", "opts": ["miyanaga-teru"]}], [["add_honba"]]],
        ["unset_status", "iishanten"],
        ["set_status", "riichi", "yae_kobashiri_double_riichi", "just_reached", "ippatsu"],
        ["when", [{"name": "others_status", "opts": ["riichi"]}], [["set_status", "chasing"]]],
        ["push_message", "declared riichi"],
        ["when", [{"name": "status", "opts": ["discards_empty"]}, "no_calls_yet"], [["set_status", "double_riichi"]]],
        ["when", [{"name": "others_status", "opts": ["miyanaga-teru"]}], [["add_honba"]]],
        ["when", [{"name": "everyone_status", "opts": ["riichi"]}], [
          ["subtract_score", 1000],
          ["put_down_riichi_stick"],
          ["pause", 1000],
          ["abortive_draw", "Suucha Riichi"]
        ]]
      ]
    },
    "yae_kobashiri_call_riichi": {
      "display_name": "Steal tile and declare riichi",
      "show_when": [
        "all_saki_cards_drafted",
        "not_our_turn",
        "someone_else_just_discarded",
        {"name": "not_discarder_status", "opts": ["discard_passed"]},
        {"name": "status", "opts": ["yae-kobashiri", "iishanten"]},
        {"name": "status_missing", "opts": ["match_start", "riichi", "yae_kobashiri_skip"]},
        {"name": "has_no_call_named", "opts": ["chii", "pon", "daiminkan", "kakan"]},
        {"name": "has_score", "opts": [1000]},
        "next_draw_possible",
        {"name": "match", "opts": [["hand", "calls", "last_discard"], ["tenpai_14"]]}
      ],
      "actions": [
        ["big_text", "Riichi"],
        ["when", [{"name": "others_status", "opts": ["miyanaga-teru"]}], [["add_honba"]]],
        ["unset_status", "iishanten"],
        ["draw_last_discard"],
        ["as", "last_discarder", [["set_status", "double_payment"]]],
        ["change_turn", "self"],
        ["set_status", "ready", "riichi", "just_reached", "ippatsu"],
        ["when", [{"name": "others_status", "opts": ["riichi"]}], [["set_status", "chasing"]]],
        ["push_message", "declared riichi"],
        ["when", [{"name": "status", "opts": ["discards_empty"]}, "no_calls_yet"], [["set_status", "double_riichi"]]],
        ["when", [{"name": "others_status", "opts": ["miyanaga-teru"]}], [["add_honba"]]],
        ["when", [{"name": "everyone_status", "opts": ["riichi"]}], [
          ["subtract_score", 1000],
          ["put_down_riichi_stick"],
          ["pause", 1000],
          ["abortive_draw", "Suucha Riichi"]
        ]]
      ],
      "unskippable": true
    },
    "yae_kobashiri_call_riichi_skip": {
      "display_name": "Skip",
      "show_when": [
        "all_saki_cards_drafted",
        "not_our_turn",
        "someone_else_just_discarded",
        {"name": "not_discarder_status", "opts": ["discard_passed"]},
        {"name": "status", "opts": ["yae-kobashiri", "iishanten"]},
        {"name": "status_missing", "opts": ["match_start", "riichi", "yae_kobashiri_skip"]},
        {"name": "has_no_call_named", "opts": ["chii", "pon", "daiminkan", "kakan"]},
        {"name": "has_score", "opts": [1000]},
        "next_draw_possible",
        {"name": "match", "opts": [["hand", "calls", "last_discard"], ["tenpai_14"]]}
      ],
      "actions": [["set_status", "yae_kobashiri_skip"], ["resume_deferred_actions"]],
      "unskippable": true
    },
    "yoshitome_miharu_manzu": {
      "display_name": "Manzu",
      "show_when": [
        "all_saki_cards_drafted",
        "our_turn",
        "not_just_discarded",
        {"name": "status", "opts": ["yoshitome-miharu", "ready"]},
        {"name": "status_missing", "opts": ["match_start", "yoshitome_miharu_manzu", "yoshitome_miharu_pinzu", "yoshitome_miharu_souzu"]},
        {"name": "counter_at_most", "opts": ["num_discards", 6]}
      ],
      "actions": [
        ["big_text", "Yoshitome Miharu: manzu!"],
        ["set_status", "yoshitome_miharu_manzu"],
        ["when", [{"name": "status", "opts": ["discards_empty"]}], [["set_status", "yoshitome_miharu_double"]]],
        ["push_message", "declared manzu as their void suit (Yoshitome Miharu)"]
      ]
    },
    "yoshitome_miharu_pinzu": {
      "display_name": "Pinzu",
      "show_when": [
        "all_saki_cards_drafted",
        "our_turn",
        "not_just_discarded",
        {"name": "status", "opts": ["yoshitome-miharu", "ready"]},
        {"name": "status_missing", "opts": ["match_start", "yoshitome_miharu_manzu", "yoshitome_miharu_pinzu", "yoshitome_miharu_souzu"]},
        {"name": "counter_at_most", "opts": ["num_discards", 6]}
      ],
      "actions": [
        ["big_text", "Yoshitome Miharu: pinzu!"],
        ["set_status", "yoshitome_miharu_pinzu"],
        ["when", [{"name": "status", "opts": ["discards_empty"]}], [["set_status", "yoshitome_miharu_double"]]],
        ["push_message", "declared pinzu as their void suit (Yoshitome Miharu)"]
      ]
    },
    "yoshitome_miharu_souzu": {
      "display_name": "Souzu",
      "show_when": [
        "all_saki_cards_drafted",
        "our_turn",
        "not_just_discarded",
        {"name": "status", "opts": ["yoshitome-miharu", "ready"]},
        {"name": "status_missing", "opts": ["match_start", "yoshitome_miharu_manzu", "yoshitome_miharu_pinzu", "yoshitome_miharu_souzu"]},
        {"name": "counter_at_most", "opts": ["num_discards", 6]}
      ],
      "actions": [
        ["big_text", "Yoshitome Miharu: souzu!"],
        ["set_status", "yoshitome_miharu_souzu"],
        ["when", [{"name": "status", "opts": ["discards_empty"]}], [["set_status", "yoshitome_miharu_double"]]],
        ["push_message", "declared souzu as their void suit (Yoshitome Miharu)"]
      ]
    },
    "hirose_sumire_ron": {
      "display_name": "Ron previous discard",
      "show_when": [
        "all_saki_cards_drafted",
        {"name": "status", "opts": ["hirose-sumire"]},
        {"name": "status_missing", "opts": ["match_start", "tried_to_ron", "about_to_call", "furiten"]},
        {"name": "discarder_status", "opts": ["discard_passed"]},
        {"name": "not_anyone_status", "opts": ["tried_to_ron"]},
        "someone_else_just_discarded",
        "second_last_visible_discard_exists",
        {"name": "match", "opts": [["hand", "calls", "second_last_visible_discard"], ["win"]]},
        [
          {"name": "not_others_status", "opts": ["choe-myeonghwa"]},
          [
            {"name": "seat_is", "opts": ["east"]},
            [
              [{"name": "shimocha_status", "opts": ["choe-myeonghwa"]}, {"name": "not_match", "opts": [["hand", "calls"], [[[[["2z"]], 1]]]]}],
              [{"name": "toimen_status", "opts": ["choe-myeonghwa"]}, {"name": "not_match", "opts": [["hand", "calls"], [[[[["3z"]], 1]]]]}],
              [{"name": "kamicha_status", "opts": ["choe-myeonghwa"]}, {"name": "not_match", "opts": [["hand", "calls"], [[[[["4z"]], 1]]]]}]
             ]
          ],
          [
            {"name": "seat_is", "opts": ["south"]},
            [
              [{"name": "shimocha_status", "opts": ["choe-myeonghwa"]}, {"name": "not_match", "opts": [["hand", "calls"], [[[[["3z"]], 1]]]]}],
              [{"name": "toimen_status", "opts": ["choe-myeonghwa"]}, {"name": "not_match", "opts": [["hand", "calls"], [[[[["4z"]], 1]]]]}],
              [{"name": "kamicha_status", "opts": ["choe-myeonghwa"]}, {"name": "not_match", "opts": [["hand", "calls"], [[[[["1z"]], 1]]]]}]
            ]
          ],
          [
            {"name": "seat_is", "opts": ["west"]},
            [
              [{"name": "shimocha_status", "opts": ["choe-myeonghwa"]}, {"name": "not_match", "opts": [["hand", "calls"], [[[[["4z"]], 1]]]]}],
              [{"name": "toimen_status", "opts": ["choe-myeonghwa"]}, {"name": "not_match", "opts": [["hand", "calls"], [[[[["1z"]], 1]]]]}],
              [{"name": "kamicha_status", "opts": ["choe-myeonghwa"]}, {"name": "not_match", "opts": [["hand", "calls"], [[[[["2z"]], 1]]]]}]
            ]
          ],
          [
            {"name": "seat_is", "opts": ["north"]},
            [
              [{"name": "shimocha_status", "opts": ["choe-myeonghwa"]}, {"name": "not_match", "opts": [["hand", "calls"], [[[[["1z"]], 1]]]]}],
              [{"name": "toimen_status", "opts": ["choe-myeonghwa"]}, {"name": "not_match", "opts": [["hand", "calls"], [[[[["2z"]], 1]]]]}],
              [{"name": "kamicha_status", "opts": ["choe-myeonghwa"]}, {"name": "not_match", "opts": [["hand", "calls"], [[[[["3z"]], 1]]]]}]
            ]
          ],
          [{"name": "has_yaku_with_discard", "opts": [13]}, {"name": "has_yaku2_with_discard", "opts": [1]}]
        ]
      ],
      "actions": [
        ["big_text", "Hirose Sumire: ron!"],
        ["pause", 1000],
        ["set_status", "tried_to_ron", "hirose_sumire_ron"],
        ["recalculate_buttons"],
        ["reveal_hand"],
        ["push_message", "called ron on the discarder's previous visible discard (Hirose Sumire)"],
        ["win_by_second_visible_discard"]
      ]
    },
    "kainou_yoshiko": {
      "display_name": "Discard same tile again",
      "show_when": [
        "all_saki_cards_drafted",
        "our_turn",
        "just_discarded",
        {"name": "status", "opts": ["kainou-yoshiko", "ready", "discard_passed"]},
        {"name": "status_missing", "opts": ["match_start", "kainou_yoshiko_discard"]},
        {"name": "match", "opts": [["last_discard", "hand_any"], [[[[[0, 0]], 1]]]]}
      ],
      "actions": [["set_status", "kainou_yoshiko_discard"]]
    },
    "tsujigaito_satoha": {
      "display_name": "Look at next two tiles in the wall",
      "show_when": [
        "all_saki_cards_drafted",
        {"name": "status", "opts": ["tsujigaito-satoha"]},
        {"name": "status_missing", "opts": ["match_start", "just_scryed", "tsujigaito_satoha_scryed"]},
        {"name": "has_no_call_named", "opts": ["chii", "pon", "daiminkan", "kakan"]},
        [
          [
            "someone_else_just_discarded",
            {"name": "discarder_status", "opts": ["discard_facedown"]},
            {"name": "not_discarder_status", "opts": ["discard_passed"]}
          ],
          [
            "anyone_just_discarded",
            {"name": "discarder_status", "opts": ["just_reached"]},
            {"name": "not_discarder_status", "opts": ["discard_passed"]}
          ],
          {"name": "anyone_status", "opts": ["chii", "ready"]},
          {"name": "anyone_status", "opts": ["kajiki_yumi_facedown_done"]}
        ]
      ],
      "actions": [
        ["set_status", "just_scryed", "tsujigaito_satoha_scryed"],
        ["when", ["anyone_just_discarded"], [["set_status", "need_to_advance_turn"]]],
        ["scry", 2],
        ["push_message", "looks at the next two tiles in the wall (Tsujigaito Satoha)"],
        // allow swap to pop up, but only if we aren't in riichi
        ["when", [{"name": "status_missing", "opts": ["just_reached"]}], [["recalculate_buttons"]]]
      ]
    },
    "tsujigaito_satoha_swap_0": {
      "display_name": "No swap",
      "show_when": [
        "all_saki_cards_drafted",
        {"name": "status", "opts": ["tsujigaito-satoha", "just_scryed"]},
        {"name": "status_missing", "opts": ["match_start", "just_swapped"]}
      ],
      "actions": [
        ["unset_status", "just_scryed"],
        ["clear_scry"],
        ["push_message", "swapped no tiles with the wall (Tsujigaito Satoha)"],
        ["when", [{"name": "status", "opts": ["need_to_advance_turn"]}], [["unset_status", "need_to_advance_turn"], ["advance_turn"]]]
      ],
      "unskippable": true
    },
    "tsujigaito_satoha_swap_1": {
      "display_name": "Swap 1",
      "show_when": [
        "all_saki_cards_drafted",
        {"name": "status", "opts": ["tsujigaito-satoha", "just_scryed"]},
        {"name": "status_missing", "opts": ["match_start", "riichi", "just_swapped"]}
      ],
      "actions": [
        ["unset_status", "just_scryed"],
        ["clear_scry"],
        ["mark", [["hand", 1, ["not_riichi"]], ["scry", 1, []]]],
        ["push_message", "swapped one tile with the wall (Tsujigaito Satoha)"],
        ["set_status", "about_to_swap"],
        ["recalculate_buttons"], // allow interrupting swap
        ["unset_status", "about_to_swap"],
        ["ite", [{"name": "status", "opts": ["swap_interrupted"]}], [["clear_marking"], ["unset_status", "about_to_swap"]], [
          ["swap_tiles", {"hand": ["marked"]}, {"scry": ["marked"]}],
          ["clear_marking"],
          ["when", [{"name": "others_status", "opts": ["miyanaga-teru"]}], [["add_honba"]]],
          ["recalculate_buttons"] // allow tsumo to pop up
        ]],
        ["when", [{"name": "status", "opts": ["need_to_advance_turn"]}], [["unset_status", "need_to_advance_turn"], ["advance_turn"]]]
      ],
      "unskippable": true
    },
    "tsujigaito_satoha_swap_2": {
      "display_name": "Swap 2",
      "show_when": [
        "all_saki_cards_drafted",
        {"name": "status", "opts": ["tsujigaito-satoha", "just_scryed"]},
        {"name": "status_missing", "opts": ["match_start", "riichi", "just_swapped"]}
      ],
      "actions": [
        ["unset_status", "just_scryed"],
        ["clear_scry"],
        ["mark", [["hand", 2, ["not_riichi"]], ["scry", 2, []]]],
        ["push_message", "swapped one tile with the wall (Tsujigaito Satoha)"],
        ["set_status", "about_to_swap"],
        ["recalculate_buttons"], // allow interrupting swap
        ["unset_status", "about_to_swap"],
        ["ite", [{"name": "status", "opts": ["swap_interrupted"]}], [["clear_marking"], ["unset_status", "about_to_swap"]], [
          ["swap_tiles", {"hand": ["marked"]}, {"scry": ["marked"]}],
          ["clear_marking"],
          ["when", [{"name": "others_status", "opts": ["miyanaga-teru"]}], [["add_honba"]]],
          ["recalculate_buttons"] // allow tsumo to pop up
        ]],
        ["when", [{"name": "status", "opts": ["need_to_advance_turn"]}], [["unset_status", "need_to_advance_turn"], ["advance_turn"]]]
      ],
      "unskippable": true
    },
    "shishihara_sawaya_swap": {
      "display_name": "Swap out dora indicator",
      "show_when": [
        "all_saki_cards_drafted",
        "just_discarded",
        {"name": "status", "opts": ["shishihara-sawaya", "shishihara_sawaya_swap"]},
        {"name": "status_missing", "opts": ["match_start", "just_swapped"]}
      ],
      "actions": [
        ["big_text", "Shishihara Sawaya: swap!"],
        ["set_status", "just_swapped"],
        ["unset_status", "shishihara_sawaya_swap"],
        ["mark", [["hand", 1, ["not_riichi"]], ["revealed_tile", 1, ["visible"]]]],
        ["push_message", "discarded dora, and must swap out a dora indicator (Shishihara Sawaya)"],
        ["set_status", "about_to_swap"],
        ["recalculate_buttons"], // allow interrupting swap
        ["unset_status", "about_to_swap"],
        ["ite", [{"name": "status", "opts": ["swap_interrupted"]}], [["clear_marking"], ["unset_status", "about_to_swap"]], [
          ["swap_tiles", {"hand": ["marked"]}, {"revealed_tile": ["marked"]}],
          ["clear_marking"],
          ["when", [{"name": "others_status", "opts": ["miyanaga-teru"]}], [["add_honba"]]],
          ["recalculate_buttons"] // allow tsumo to pop up
        ]],
        ["advance_turn"]
      ],
      "unskippable": true
    },
    "ueshige_suzu": {
      "display_name": "Reveal next tile from wall",
      "show_when": [
        "all_saki_cards_drafted",
        {"name": "status", "opts": ["ueshige-suzu"]},
        {"name": "status_missing", "opts": ["match_start", "just_scryed"]},
        [
          {"name": "others_status", "opts": ["just_called", "ready"]},
          [
            "anyone_just_discarded",
            {"name": "discarder_status", "opts": ["just_reached"]},
            {"name": "not_discarder_status", "opts": ["discard_passed"]}
          ]
        ],
        // awai's ability happens at the same time, but has priority
        [
          {"name": "not_others_status", "opts": ["oohoshi-awai"]},
          {"name": "others_status", "opts": ["oohoshi-awai", "oohoshi_awai_done"]}
        ]
      ],
      "actions": [
        ["set_status", "just_scryed"],
        ["push_message", "reveals the next tile in the wall (Ueshige Suzu)"],
        ["scry_all", 1],
        ["pause", 1000],
        ["when", [{"name": "match", "opts": [["hand_any", "scry"], [[[[[0, 0]], 1]]]]}], [
          ["move_tiles", "scry", "aside"],
          ["add_attr", ["aside"], ["revealed"]],
          ["big_text", "Ueshige Suzu: set aside!"],
          ["push_message", "has a copy of the revealed tile in hand, and so sets it aside (Ueshige Suzu)"]
        ]],
        ["clear_scry"],
        ["when", ["anyone_just_discarded"], [["advance_turn"]]]
      ],
      "unskippable": true
    },
    "shimizudani_ryuuka_1": {
      "display_name": "Set 10 tiles aside faceup",
      "show_when": [
        "all_saki_cards_drafted",
        "our_turn",
        {"name": "status", "opts": ["shimizudani-ryuuka"]},
        {"name": "status_missing", "opts": ["match_start", "shimizudani-ryuuka_exhausted"]}
      ],
      "actions": [
        ["draw_aside", 10],
        ["add_attr", ["aside"], ["revealed"]],
        ["set_status", "shimizudani-ryuuka_exhausted"],
        ["push_message", "set ten tiles aside (Shimizudani Ryuuka)"],
        ["recalculate_buttons"]
      ],
      "unskippable": true,
      "cancellable": false
    },
    "shimizudani_ryuuka_2": {
      "display_name": "Declare yaku",
      "show_when": [
        "all_saki_cards_drafted",
        "our_turn",
        {"name": "status", "opts": ["shimizudani-ryuuka", "shimizudani-ryuuka_exhausted"]},
        {"name": "status_missing", "opts": ["match_start", "shimizudani-ryuuka_exhausted2"]}
      ],
      "actions": [
        ["set_status", "shimizudani-ryuuka_exhausted2"],
        ["push_message", "is choosing yaku (Shimizudani Ryuuka)"],
        ["choose_yaku"]
      ],
      "unskippable": true,
      "cancellable": false
    },
    "shimizudani_ryuuka_draw": {
      "display_name": "Draw from aside",
      "show_when": [
        "all_saki_cards_drafted",
        "our_turn",
        "not_just_discarded",
        {"name": "status", "opts": ["shimizudani-ryuuka", "shimizudani-ryuuka_exhausted2"]},
        ["not_just_called", {"name": "status", "opts": ["kan"]}],
        "has_aside",
        "not_has_draw"
      ],
      "actions": [
        ["mark", [["aside", 1, ["self"]]]],
        ["unset_status", "kan"],
        ["move_tiles", {"aside": ["marked", "self"]}, "draw"],
        ["clear_marking"],
        ["recalculate_buttons"] // riichi, tsumo, etc
      ],
      "unskippable": true,
      "cancellable": false
    },
    "kajiki_yumi_swap": {
      "display_name": "Swap open melds",
      "show_when": [
        "all_saki_cards_drafted",
        "our_turn",
        "not_just_discarded",
        {"name": "status", "opts": ["kajiki-yumi", "just_called", "ready"]},
        {"name": "status_missing", "opts": ["just_swapped"]},
        {"name": "not_has_no_call_named", "opts": ["chii", "pon", "daiminkan", "kakan"]},
        {"name": "anyone", "opts": ["not_our_turn", {"name": "not_has_no_call_named", "opts": ["chii", "pon", "daiminkan", "kakan"]}]}
      ],
      "actions": [
        ["big_text", "Kajiki Yumi: swap!"],
        ["set_status", "just_swapped"],
        ["mark", [["call", 1, ["self", "open"]], ["call", 1, ["others", "open"]]]],
        ["push_message", "swapped one of their open melds with another's (Kajiki Yumi)"],
        ["set_status", "about_to_swap"],
        ["recalculate_buttons"], // allow interrupting swap
        ["unset_status", "about_to_swap"],
        ["ite", [{"name": "status", "opts": ["swap_interrupted"]}], [["clear_marking"], ["unset_status", "about_to_swap"]], [
          ["swap_marked_calls"],
          ["when", [{"name": "others_status", "opts": ["miyanaga-teru"]}], [["add_honba"]]],
          ["recalculate_buttons"] // allow tsumo to pop up
        ]],
        ["when", [{"name": "status_missing", "opts": ["kajiki_yumi_facedown_done"]}], [["recalculate_buttons"]]] // allow facedown to pop up
      ]
    },
    "kajiki_yumi_facedown": {
      "display_name": "Flip any discard facedown",
      "show_when": [
        "all_saki_cards_drafted",
        "our_turn",
        "not_just_discarded",
        {"name": "status", "opts": ["kajiki-yumi", "just_called", "ready"]},
        {"name": "status_missing", "opts": ["kajiki_yumi_facedown_done"]},
        "visible_discard_exists"
      ],
      "actions": [
        ["big_text", "Kajiki Yumi: facedown!"],
        ["mark", [["discard", 1, ["visible"]]]],
        ["push_message", "flipped a discard facedown (Kajiki Yumi)"],
        ["flip_marked_discard_facedown"],
        ["set_status", "kajiki_yumi_facedown_done"],
        ["when", [{"name": "status_missing", "opts": ["just_swapped"]}], [["recalculate_buttons"]]] // allow swap to pop up
      ],
      "unskippable": true
    },
    "funakubo_hiroko_swap_shimocha_toimen": {
      "display_name": "Tell shimocha/toimen to swap",
      "show_when": [
        "all_saki_cards_drafted",
        "our_turn",
        "not_just_discarded",
        {"name": "status", "opts": ["funakubo-hiroko", "ready"]},
        {"name": "status_missing", "opts": ["funakubo-hiroko_exhausted", "funakubo_hiroko_swapping"]},
        {"name": "counter_equals", "opts": ["num_discards", 0, 6]},
        {"name": "not_others_status", "opts": ["swap_shimocha"]},
        {"name": "not_others_status", "opts": ["swap_toimen"]},
        {"name": "not_others_status", "opts": ["swap_kamicha"]},
        {"name": "not_shimocha_status", "opts": ["riichi"]},
        {"name": "not_toimen_status", "opts": ["riichi"]}
      ],
      "actions": [
        ["set_status", "funakubo_hiroko_swapping"],
        ["as", "shimocha", [["set_status", "swap_shimocha"]]],
        ["as", "toimen", [["set_status", "swap_kamicha"]]],
        ["when", [{"name": "seat_is", "opts": ["east"]}], [["push_message", "ordered south and west to swap three tiles with each other (Funakubo Hiroko)"]]],
        ["when", [{"name": "seat_is", "opts": ["south"]}], [["push_message", "ordered west and north to swap three tiles with each other (Funakubo Hiroko)"]]],
        ["when", [{"name": "seat_is", "opts": ["west"]}], [["push_message", "ordered north and east to swap three tiles with each other (Funakubo Hiroko)"]]],
        ["when", [{"name": "seat_is", "opts": ["north"]}], [["push_message", "ordered east and south to swap three tiles with each other (Funakubo Hiroko)"]]]
      ],
      "unskippable": true
    },
    "funakubo_hiroko_swap_shimocha_kamicha": {
      "display_name": "Tell shimocha/kamicha to swap",
      "show_when": [
        "all_saki_cards_drafted",
        "our_turn",
        "not_just_discarded",
        {"name": "status", "opts": ["funakubo-hiroko", "ready"]},
        {"name": "status_missing", "opts": ["funakubo-hiroko_exhausted", "funakubo_hiroko_swapping"]},
        {"name": "counter_equals", "opts": ["num_discards", 0, 6]},
        {"name": "not_others_status", "opts": ["swap_shimocha"]},
        {"name": "not_others_status", "opts": ["swap_toimen"]},
        {"name": "not_others_status", "opts": ["swap_kamicha"]},
        {"name": "not_shimocha_status", "opts": ["riichi"]},
        {"name": "not_kamicha_status", "opts": ["riichi"]}
      ],
      "actions": [
        ["set_status", "funakubo_hiroko_swapping"],
        ["as", "shimocha", [["set_status", "swap_toimen"]]],
        ["as", "kamicha", [["set_status", "swap_toimen"]]],
        ["when", [{"name": "seat_is", "opts": ["east"]}], [["push_message", "ordered south and north to swap three tiles with each other (Funakubo Hiroko)"]]],
        ["when", [{"name": "seat_is", "opts": ["south"]}], [["push_message", "ordered west and east to swap three tiles with each other (Funakubo Hiroko)"]]],
        ["when", [{"name": "seat_is", "opts": ["west"]}], [["push_message", "ordered north and south to swap three tiles with each other (Funakubo Hiroko)"]]],
        ["when", [{"name": "seat_is", "opts": ["north"]}], [["push_message", "ordered east and west to swap three tiles with each other (Funakubo Hiroko)"]]]
      ],
      "unskippable": true
    },
    "funakubo_hiroko_swap_toimen_kamicha": {
      "display_name": "Tell toimen/kamicha to swap",
      "show_when": [
        "all_saki_cards_drafted",
        "our_turn",
        "not_just_discarded",
        {"name": "status", "opts": ["funakubo-hiroko", "ready"]},
        {"name": "status_missing", "opts": ["funakubo-hiroko_exhausted", "funakubo_hiroko_swapping"]},
        {"name": "counter_equals", "opts": ["num_discards", 0, 6]},
        {"name": "not_others_status", "opts": ["swap_shimocha"]},
        {"name": "not_others_status", "opts": ["swap_toimen"]},
        {"name": "not_others_status", "opts": ["swap_kamicha"]},
        {"name": "not_toimen_status", "opts": ["riichi"]},
        {"name": "not_kamicha_status", "opts": ["riichi"]}
      ],
      "actions": [
        ["set_status", "funakubo_hiroko_swapping"],
        ["as", "toimen", [["set_status", "swap_shimocha"]]],
        ["as", "kamicha", [["set_status", "swap_kamicha"]]],
        ["when", [{"name": "seat_is", "opts": ["east"]}], [["push_message", "ordered west and north to swap three tiles with each other (Funakubo Hiroko)"]]],
        ["when", [{"name": "seat_is", "opts": ["south"]}], [["push_message", "ordered north and east to swap three tiles with each other (Funakubo Hiroko)"]]],
        ["when", [{"name": "seat_is", "opts": ["west"]}], [["push_message", "ordered east and south to swap three tiles with each other (Funakubo Hiroko)"]]],
        ["when", [{"name": "seat_is", "opts": ["north"]}], [["push_message", "ordered south and west to swap three tiles with each other (Funakubo Hiroko)"]]]
      ],
      "unskippable": true
    },
    "funakubo_hiroko_wait": {
      // we need hiroko to do some action while others decide if they want to swap, make it this action
      "display_name": "Perform swap",
      "show_when": [
        "all_saki_cards_drafted",
        "our_turn",
        "not_just_discarded",
        {"name": "status", "opts": ["funakubo-hiroko", "ready", "funakubo_hiroko_swapping"]},
        [
          {"name": "anyone_status", "opts": ["swap_shimocha"]},
          {"name": "anyone_status", "opts": ["swap_toimen"]},
          {"name": "anyone_status", "opts": ["swap_kamicha"]}
        ]
      ],
      "actions": [
        ["unset_status", "funakubo_hiroko_swapping"],
        ["set_status", "funakubo-hiroko_exhausted"]
      ],
      "unskippable": true
    },
    "funakubo_hiroko_refuse_swap_shimocha": {
      "display_name": "Pay 1500 to decline the swap",
      "show_when": [
        "all_saki_cards_drafted",
        "not_our_turn",
        {"name": "shimocha_status", "opts": ["funakubo-hiroko", "funakubo_hiroko_swapping"]},
        {"name": "not_status_missing", "opts": ["swap_shimocha", "swap_toimen", "swap_kamicha"]}
      ],
      "actions": [
        ["big_text", "No swap"],
        ["push_message", "paid 1500 to decline the swap"],
        ["unset_status_all", "swap_shimocha", "swap_toimen", "swap_kamicha"],
        ["subtract_score", 1500],
        ["add_score", 1500, "shimocha"]
      ],
      "precedence_over": [
        "funakubo_hiroko_do_swap_shimocha",
        "funakubo_hiroko_do_swap_toimen",
        "funakubo_hiroko_do_swap_kamicha",
        "funakubo_hiroko_refuse_swap_toimen",
        "funakubo_hiroko_refuse_swap_kamicha"
      ],
      "unskippable": true
    },
    "funakubo_hiroko_refuse_swap_toimen": {
      "display_name": "Pay 1500 to decline the swap",
      "show_when": [
        "all_saki_cards_drafted",
        "not_our_turn",
        {"name": "toimen_status", "opts": ["funakubo-hiroko", "funakubo_hiroko_swapping"]},
        {"name": "not_status_missing", "opts": ["swap_shimocha", "swap_toimen", "swap_kamicha"]}
      ],
      "actions": [
        ["big_text", "No swap"],
        ["push_message", "paid 1500 to decline the swap"],
        ["unset_status_all", "swap_shimocha", "swap_toimen", "swap_kamicha"],
        ["subtract_score", 1500],
        ["add_score", 1500, "toimen"]
      ],
      "precedence_over": [
        "funakubo_hiroko_do_swap_shimocha",
        "funakubo_hiroko_do_swap_toimen",
        "funakubo_hiroko_do_swap_kamicha",
        "funakubo_hiroko_refuse_swap_shimocha",
        "funakubo_hiroko_refuse_swap_kamicha"
      ],
      "unskippable": true
    },
    "funakubo_hiroko_refuse_swap_kamicha": {
      "display_name": "Pay 1500 to decline the swap",
      "show_when": [
        "all_saki_cards_drafted",
        "not_our_turn",
        {"name": "kamicha_status", "opts": ["funakubo-hiroko", "funakubo_hiroko_swapping"]},
        {"name": "not_status_missing", "opts": ["swap_shimocha", "swap_toimen", "swap_kamicha"]}
      ],
      "actions": [
        ["big_text", "No swap"],
        ["push_message", "paid 1500 to decline the swap"],
        ["unset_status_all", "swap_shimocha", "swap_toimen", "swap_kamicha"],
        ["subtract_score", 1500],
        ["add_score", 1500, "kamicha"]
      ],
      "precedence_over": [
        "funakubo_hiroko_do_swap_shimocha",
        "funakubo_hiroko_do_swap_toimen",
        "funakubo_hiroko_do_swap_kamicha",
        "funakubo_hiroko_refuse_swap_shimocha",
        "funakubo_hiroko_refuse_swap_toimen"
      ],
      "unskippable": true
    },
    "funakubo_hiroko_do_swap_shimocha": {
      "display_name": "Swap with shimocha",
      "show_when": [
        "all_saki_cards_drafted",
        "not_our_turn",
        {"name": "others_status", "opts": ["funakubo-hiroko", "funakubo_hiroko_swapping"]},
        {"name": "status", "opts": ["swap_shimocha"]}
      ],
      "actions": [
        ["mark", [["hand", 3, ["self"]]]],
        ["charleston_right"],
        ["unset_status", "swap_shimocha"]
      ],
      "unskippable": true
    },
    "funakubo_hiroko_do_swap_toimen": {
      "display_name": "Swap with toimen",
      "show_when": [
        "all_saki_cards_drafted",
        "not_our_turn",
        {"name": "others_status", "opts": ["funakubo-hiroko", "funakubo_hiroko_swapping"]},
        {"name": "status", "opts": ["swap_toimen"]}
      ],
      "actions": [
        ["mark", [["hand", 3, ["self"]]]],
        ["charleston_across"],
        ["unset_status", "swap_toimen"],
        ["when", [{"name": "shimocha_status", "opts": ["funakubo-hiroko"]}, {"name": "anyone_status", "opts": ["miyanaga-teru"]}], [["add_honba"]]]
      ],
      "unskippable": true
    },
    "funakubo_hiroko_do_swap_kamicha": {
      "display_name": "Swap with kamicha",
      "show_when": [
        "all_saki_cards_drafted",
        "not_our_turn",
        {"name": "others_status", "opts": ["funakubo-hiroko", "funakubo_hiroko_swapping"]},
        {"name": "status", "opts": ["swap_kamicha"]}
      ],
      "actions": [
        ["mark", [["hand", 3, ["self"]]]],
        ["charleston_left"],
        ["unset_status", "swap_kamicha"],
        ["when", [{"name": "anyone_status", "opts": ["miyanaga-teru"]}], [["add_honba"]]]
      ],
      "unskippable": true
    },
    "megan_davin_duel_shimocha": {
      "display_name": "Duel shimocha",
      "show_when": [
        "all_saki_cards_drafted",
        "our_turn",
        "not_just_discarded",
        {"name": "status", "opts": ["megan-davin", "ready"]},
        {"name": "status_missing", "opts": ["megan-davin_exhausted"]}
      ],
      "actions": [
        ["set_status", "megan-davin_exhausted", "megan_davin_double_payment"],
        ["as", "shimocha", [["set_status", "duelist", "megan_davin_double_payment"]]],
        ["disable_saki_card", "shimocha"],
        ["big_text", "Megan Davin: duel!"],
        ["big_text", "Megan Davin: duel!", "shimocha"],
        ["when", [{"name": "seat_is", "opts": ["east"]}], [["push_message", "initiated a duel with south, disabling their ability (Megan Davin)"]]],
        ["when", [{"name": "seat_is", "opts": ["south"]}], [["push_message", "initiated a duel with west, disabling their ability (Megan Davin)"]]],
        ["when", [{"name": "seat_is", "opts": ["west"]}], [["push_message", "initiated a duel with north, disabling their ability (Megan Davin)"]]],
        ["when", [{"name": "seat_is", "opts": ["north"]}], [["push_message", "initiated a duel with east, disabling their ability (Megan Davin)"]]]
      ],
      "unskippable": true
    },
    "megan_davin_duel_toimen": {
      "display_name": "Duel toimen",
      "show_when": [
        "all_saki_cards_drafted",
        "our_turn",
        "not_just_discarded",
        {"name": "status", "opts": ["megan-davin", "ready"]},
        {"name": "status_missing", "opts": ["megan-davin_exhausted"]}
      ],
      "actions": [
        ["set_status", "megan-davin_exhausted", "megan_davin_double_payment"],
        ["as", "toimen", [["set_status", "duelist", "megan_davin_double_payment"]]],
        ["disable_saki_card", "toimen"],
        ["big_text", "Megan Davin: duel!"],
        ["big_text", "Megan Davin: duel!", "toimen"],
        ["when", [{"name": "seat_is", "opts": ["east"]}], [["push_message", "initiated a duel with west, disabling their ability (Megan Davin)"]]],
        ["when", [{"name": "seat_is", "opts": ["south"]}], [["push_message", "initiated a duel with north, disabling their ability (Megan Davin)"]]],
        ["when", [{"name": "seat_is", "opts": ["west"]}], [["push_message", "initiated a duel with east, disabling their ability (Megan Davin)"]]],
        ["when", [{"name": "seat_is", "opts": ["north"]}], [["push_message", "initiated a duel with south, disabling their ability (Megan Davin)"]]]
      ],
      "unskippable": true
    },
    "megan_davin_duel_kamicha": {
      "display_name": "Duel kamicha",
      "show_when": [
        "all_saki_cards_drafted",
        "our_turn",
        "not_just_discarded",
        {"name": "status", "opts": ["megan-davin", "ready"]},
        {"name": "status_missing", "opts": ["megan-davin_exhausted"]}
      ],
      "actions": [
        ["set_status", "megan-davin_exhausted", "megan_davin_double_payment"],
        ["as", "kamicha", [["set_status", "duelist", "megan_davin_double_payment"]]],
        ["disable_saki_card", "kamicha"],
        ["big_text", "Megan Davin: duel!"],
        ["big_text", "Megan Davin: duel!", "kamicha"],
        ["when", [{"name": "seat_is", "opts": ["east"]}], [["push_message", "initiated a duel with north, disabling their ability (Megan Davin)"]]],
        ["when", [{"name": "seat_is", "opts": ["south"]}], [["push_message", "initiated a duel with east, disabling their ability (Megan Davin)"]]],
        ["when", [{"name": "seat_is", "opts": ["west"]}], [["push_message", "initiated a duel with south, disabling their ability (Megan Davin)"]]],
        ["when", [{"name": "seat_is", "opts": ["north"]}], [["push_message", "initiated a duel with west, disabling their ability (Megan Davin)"]]]
      ],
      "unskippable": true
    },
    "usuzawa_sae_shimocha": {
      "display_name": "Choose shimocha",
      "show_when": [
        "all_saki_cards_drafted",
        "our_turn",
        "not_just_discarded",
        {"name": "status", "opts": ["usuzawa-sae", "just_reached"]},
        {"name": "status_missing", "opts": ["usuzawa-sae_exhausted"]}
      ],
      "actions": [
        ["set_status", "usuzawa-sae_exhausted"],
        ["disable_saki_card", "others"],
        ["as", "shimocha", [["set_status", "usuzawa_sae_opponent"], ["big_text", "Usuzawa Sae: opponent!"]]],
        ["big_text", "Usuzawa Sae: opponent!"],
        ["when", [{"name": "seat_is", "opts": ["east"]}], [["push_message", "disabled everyone else's ability and chose south as their opponent, who cannot call or ron unless in riichi (Usuzawa Sae)"]]],
        ["when", [{"name": "seat_is", "opts": ["south"]}], [["push_message", "disabled everyone else's ability and chose west as their opponent, who cannot call or ron unless in riichi (Usuzawa Sae)"]]],
        ["when", [{"name": "seat_is", "opts": ["west"]}], [["push_message", "disabled everyone else's ability and chose north as their opponent, who cannot call or ron unless in riichi (Usuzawa Sae)"]]],
        ["when", [{"name": "seat_is", "opts": ["north"]}], [["push_message", "disabled everyone else's ability and chose east as their opponent, who cannot call or ron unless in riichi (Usuzawa Sae)"]]]
      ],
      "unskippable": true
    },
    "usuzawa_sae_toimen": {
      "display_name": "Choose toimen",
      "show_when": [
        "all_saki_cards_drafted",
        "our_turn",
        "not_just_discarded",
        {"name": "status", "opts": ["usuzawa-sae", "just_reached"]},
        {"name": "status_missing", "opts": ["usuzawa-sae_exhausted"]}
      ],
      "actions": [
        ["set_status", "usuzawa-sae_exhausted"],
        ["disable_saki_card", "others"],
        ["as", "toimen", [["set_status", "usuzawa_sae_opponent"], ["big_text", "Usuzawa Sae: opponent!"]]],
        ["big_text", "Usuzawa Sae: opponent!", "toimen"],
        ["when", [{"name": "seat_is", "opts": ["east"]}], [["push_message", "disabled everyone else's ability and chose west as their opponent, who cannot call or ron unless in riichi (Usuzawa Sae)"]]],
        ["when", [{"name": "seat_is", "opts": ["south"]}], [["push_message", "disabled everyone else's ability and chose north as their opponent, who cannot call or ron unless in riichi (Usuzawa Sae)"]]],
        ["when", [{"name": "seat_is", "opts": ["west"]}], [["push_message", "disabled everyone else's ability and chose east as their opponent, who cannot call or ron unless in riichi (Usuzawa Sae)"]]],
        ["when", [{"name": "seat_is", "opts": ["north"]}], [["push_message", "disabled everyone else's ability and chose south as their opponent, who cannot call or ron unless in riichi (Usuzawa Sae)"]]]
      ],
      "unskippable": true
    },
    "usuzawa_sae_kamicha": {
      "display_name": "Choose kamicha",
      "show_when": [
        "all_saki_cards_drafted",
        "our_turn",
        "not_just_discarded",
        {"name": "status", "opts": ["usuzawa-sae", "just_reached"]},
        {"name": "status_missing", "opts": ["usuzawa-sae_exhausted"]}
      ],
      "actions": [
        ["set_status", "usuzawa-sae_exhausted"],
        ["disable_saki_card", "others"],
        ["as", "kamicha", [["set_status", "usuzawa_sae_opponent"], ["big_text", "Usuzawa Sae: opponent!"]]],
        ["big_text", "Usuzawa Sae: opponent!"],
        ["when", [{"name": "seat_is", "opts": ["east"]}], [["push_message", "disabled everyone else's ability and chose north as their opponent, who cannot call or ron unless in riichi (Usuzawa Sae)"]]],
        ["when", [{"name": "seat_is", "opts": ["south"]}], [["push_message", "disabled everyone else's ability and chose east as their opponent, who cannot call or ron unless in riichi (Usuzawa Sae)"]]],
        ["when", [{"name": "seat_is", "opts": ["west"]}], [["push_message", "disabled everyone else's ability and chose south as their opponent, who cannot call or ron unless in riichi (Usuzawa Sae)"]]],
        ["when", [{"name": "seat_is", "opts": ["north"]}], [["push_message", "disabled everyone else's ability and chose west as their opponent, who cannot call or ron unless in riichi (Usuzawa Sae)"]]]
      ],
      "unskippable": true
    },
    "oohoshi_awai_scry": {
      "display_name": "Reveal three tiles and uradora",
      "show_when": [
        "all_saki_cards_drafted",
        "our_turn",
        "not_just_discarded",
        {"name": "status", "opts": ["oohoshi-awai"]},
        {"name": "status_missing", "opts": ["just_reached", "oohoshi_awai_scry", "oohoshi_awai_draw", "oohoshi_awai_place", "oohoshi_awai_done"]},
        [
          {"name": "status", "opts": ["ippatsu"]},
          {"name": "status", "opts": ["kan"]}
        ]
      ],
      "actions": [
        ["set_status", "oohoshi_awai_scry"],
        ["big_text", "Oohoshi Awai: reveal!"],
        ["save_revealed_tiles"],
        ["ite", [{"name": "others_status", "opts": ["takakamo-shizuno"]}], [
          ["push_message", "revealed three tiles from the wall (Oohoshi Awai)"]
        ], [
          ["push_message", "revealed three tiles from the wall and the ura indicators (Oohoshi Awai)"]
        ]],
        ["scry_all", 3],
        // reveal ura if not blocked
        ["ite", [{"name": "others_status", "opts": ["takakamo-shizuno"]}], [
          ["push_message", "may freely swap between these three tiles and the dora indicators (Oohoshi Awai)"]
        ], [
          ["push_message", "may freely swap between these three tiles, the dora indicators, and the ura indicators (Oohoshi Awai)"],
          ["when", [{"name": "tile_not_revealed", "opts": [-6]}], [["reveal_tile", "1x"]]],
          ["when", [{"name": "tile_not_revealed", "opts": [-8]}], [["reveal_tile", "1x"]]],
          ["when", [{"name": "tile_not_revealed", "opts": [-10]}], [["reveal_tile", "1x"]]],
          ["when", [{"name": "tile_not_revealed", "opts": [-12]}], [["reveal_tile", "1x"]]],
          ["when", [{"name": "tile_not_revealed", "opts": [-14]}], [["reveal_tile", "1x"]]],
          ["when", [{"name": "tile_revealed", "opts": [-16]}], [["reveal_tile", "1x"]]], // spacer if we have >5 dora indicators
          ["when", [{"name": "tile_revealed", "opts": [-6]}], [["reveal_tile", -5]]],
          ["when", [{"name": "tile_revealed", "opts": [-8]}], [["reveal_tile", -7]]],
          ["when", [{"name": "tile_revealed", "opts": [-10]}], [["reveal_tile", -9]]],
          ["when", [{"name": "tile_revealed", "opts": [-12]}], [["reveal_tile", -11]]],
          ["when", [{"name": "tile_revealed", "opts": [-14]}], [["reveal_tile", -13]]],
          ["when", [{"name": "tile_revealed", "opts": [-16]}], [["reveal_tile", -15]]],
          ["when", [{"name": "tile_revealed", "opts": [-18]}], [["reveal_tile", -17]]],
          ["when", [{"name": "tile_revealed", "opts": [-20]}], [["reveal_tile", -19]]],
          ["when", [{"name": "tile_not_revealed", "opts": [-5]}], [["reveal_tile", "1x"]]],
          ["when", [{"name": "tile_not_revealed", "opts": [-7]}], [["reveal_tile", "1x"]]],
          ["when", [{"name": "tile_not_revealed", "opts": [-9]}], [["reveal_tile", "1x"]]],
          ["when", [{"name": "tile_not_revealed", "opts": [-11]}], [["reveal_tile", "1x"]]],
          ["when", [{"name": "tile_not_revealed", "opts": [-13]}], [["reveal_tile", "1x"]]]
        ]],
        ["set_status", "about_to_swap"],
        ["recalculate_buttons"], // allow interrupting swap
        ["unset_status", "about_to_swap"],
        ["when", [{"name": "status", "opts": ["swap_interrupted"]}], [
          ["unset_status", "oohoshi_awai_scry"],
          ["set_status", "oohoshi_awai_draw"],
          ["recalculate_buttons"]
        ]]
      ],
      "unskippable": true
    },
    "oohoshi_awai_1_swap": {
      "display_name": "Swap two tiles",
      "show_when": [
        "all_saki_cards_drafted",
        "our_turn",
        "not_just_discarded",
        {"name": "status", "opts": ["oohoshi-awai", "oohoshi_awai_scry"]},
        {"name": "status_missing", "opts": ["about_to_swap"]}
      ],
      "actions": [
        ["mark", [["scry", 1, []], ["revealed_tile", 1, ["visible"]]]],
        ["swap_marked_scry_and_dora_indicator"],
        ["when", [{"name": "status_missing", "opts": ["oohoshi_awai_scry_did_swap"]}, {"name": "others_status", "opts": ["miyanaga-teru"]}], [["add_honba"]]],
        ["set_status", "oohoshi_awai_scry_did_swap"],
        ["recalculate_buttons"] // allow another swap
      ],
      "unskippable": true
    },
    "oohoshi_awai_2_done": {
      "display_name": "Done swapping",
      "show_when": [
        "all_saki_cards_drafted",
        "our_turn",
        "not_just_discarded",
        {"name": "status", "opts": ["oohoshi-awai", "oohoshi_awai_scry"]},
        {"name": "status_missing", "opts": ["about_to_swap"]}
      ],
      "actions": [
        ["unset_status", "oohoshi_awai_scry", "oohoshi_awai_scry_did_swap"],
        ["set_status", "oohoshi_awai_draw"],
        ["load_revealed_tiles"],
        ["recalculate_buttons"] // show draw button
      ],
      "unskippable": true
    },
    "oohoshi_awai_draw": {
      "display_name": "Choose a tile to draw",
      "show_when": [
        "all_saki_cards_drafted",
        "our_turn",
        "not_just_discarded",
        {"name": "status", "opts": ["oohoshi-awai", "oohoshi_awai_draw"]}
      ],
      "actions": [
        ["mark", [["scry", 1, []]]],
        ["move_tiles", {"scry": ["marked"]}, "draw"],
        ["clear_marking"],
        ["unset_status", "oohoshi_awai_draw"],
        ["set_status", "oohoshi_awai_place"],
        ["push_message", "draws one of the revealed tiles (Oohoshi Awai)"],
        ["recalculate_buttons"] // show place button
      ],
      "unskippable": true
    },
    "oohoshi_awai_place": {
      "display_name": "Select order to place remaining tiles (second selection is haitei)",
      "show_when": [
        "all_saki_cards_drafted",
        "our_turn",
        "not_just_discarded",
        {"name": "status", "opts": ["oohoshi-awai", "oohoshi_awai_place"]}
      ],
      "actions": [
        ["mark", [["scry", 2, []]]],
        ["extend_live_wall_with_marked"],
        ["push_message", "adds the remaining two tiles to the end of the live wall (Oohoshi Awai)"],
        ["unset_status", "oohoshi_awai_place"],
        ["set_status", "oohoshi_awai_done"],
        ["recalculate_buttons"] // allow for tsumo, also pass control to ueshige suzu if needed
      ],
      "unskippable": true
    },
    "oohoshi_awai_daiminkan": {
      "display_name": "Kan (closed)",
      "call": [[0, 0, 0]],
      "call_style": {"kamicha": [["1x_sideways", "call"], 0, 1, 2], "toimen": [["1x", 0], "call_sideways", 1, ["1x", 2]], "shimocha": [["1x", 0], 1, 2, ["1x_sideways", "call"]]},
      "call_conditions": [
        [
          {"name": "not_call_contains", "opts": [[["7z", "golden"]], 1]},
          {"name": "call_contains", "opts": [["7z"], 1]}
        ],
        [
          {"name": "not_status", "opts": ["riichi"]},
          {"name": "not_call_changes_waits", "opts": ["win"]}
        ]
      ],
      "show_when": [
        "all_saki_cards_drafted",
        "not_our_turn",
        {"name": "status", "opts": ["oohoshi-awai"]},
        {"name": "not_anyone_status", "opts": ["about_to_call"]},
        {"name": "not_anyone_status", "opts": ["tried_to_ron"]},
        "not_no_tiles_remaining",
        "someone_else_just_discarded",
        {"name": "not_discarder_status", "opts": ["discard_passed"]},
        {"name": "status_missing", "opts": ["about_to_call", "about_to_swap", "call_interrupted", "usuzawa_sae_opponent"]},
        "call_available",
        {"name": "status_missing", "opts": ["mase-yuuko"]},
        [
          {"name": "status", "opts": ["megan-davin", "duelist"]},
          {"name": "not_others_status", "opts": ["megan-davin", "riichi"]},
          {"name": "not_others_status", "opts": ["duelist", "riichi"]}
        ]
      ],
      "actions": [
        ["big_text", "Kan"],
        ["set_status", "about_to_call", "daiminkan"],
        ["recalculate_buttons"], // allow interrupting call
        ["unset_status", "about_to_call"],
        ["unless", [{"name": "status", "opts": ["call_interrupted"]}], [
          ["call"], ["unset_status_all", "just_reached"], ["set_status", "just_called"], ["set_status_all", "call_made"], ["change_turn", "self"],
          ["shift_tile_to_dead_wall", 1],
          ["when", [{"name": "status", "opts": ["kan"]}, {"name": "not_status", "opts": ["ankan"]}, {"name": "tile_revealed", "opts": [-18]}, {"name": "tile_not_revealed", "opts": [-20]}], [["ensure_dead_wall_2"], ["reveal_tile", -20]]],
          ["when", [{"name": "status", "opts": ["kan"]}, {"name": "not_status", "opts": ["ankan"]}, {"name": "tile_revealed", "opts": [-16]}, {"name": "tile_not_revealed", "opts": [-18]}], [["ensure_dead_wall_2"], ["reveal_tile", -18]]],
          ["when", [{"name": "status", "opts": ["kan"]}, {"name": "not_status", "opts": ["ankan"]}, {"name": "tile_revealed", "opts": [-14]}, {"name": "tile_not_revealed", "opts": [-16]}], [["ensure_dead_wall_2"], ["reveal_tile", -16]]],
          ["when", [{"name": "status", "opts": ["kan"]}, {"name": "not_status", "opts": ["ankan"]}, {"name": "tile_revealed", "opts": [-12]}, {"name": "tile_not_revealed", "opts": [-14]}], [["reveal_tile", -14]]],
          ["when", [{"name": "status", "opts": ["kan"]}, {"name": "not_status", "opts": ["ankan"]}, {"name": "tile_revealed", "opts": [-10]}, {"name": "tile_not_revealed", "opts": [-12]}], [["reveal_tile", -12]]],
          ["when", [{"name": "status", "opts": ["kan"]}, {"name": "not_status", "opts": ["ankan"]}, {"name": "tile_revealed", "opts": [-8]}, {"name": "tile_not_revealed", "opts": [-10]}], [["reveal_tile", -10]]],
          ["when", [{"name": "status", "opts": ["kan"]}, {"name": "not_status", "opts": ["ankan"]}, {"name": "tile_revealed", "opts": [-6]}, {"name": "tile_not_revealed", "opts": [-8]}], [["reveal_tile", -8]]],
          ["set_status", "kan"],
          ["when", [{"name": "tile_drawn", "opts": ["kandraw_3"]}, {"name": "tile_not_drawn", "opts": ["kandraw_4"]}], [
            ["when", [{"name": "match", "opts": [["calls"], [[[["daiminkan", "ankan", "kakan"], 4]]]]}], [["set_status", "suukantsu"]]],
            ["draw", 1, "kandraw_4"]
          ]],
          ["when", [{"name": "tile_drawn", "opts": ["kandraw_2"]}, {"name": "tile_not_drawn", "opts": ["kandraw_3"]}], [["draw", 1, "kandraw_3"]]],
          ["when", [{"name": "tile_drawn", "opts": ["kandraw_1"]}, {"name": "tile_not_drawn", "opts": ["kandraw_2"]}], [["draw", 1, "kandraw_2"]]],
          ["when", [{"name": "tile_not_drawn", "opts": ["kandraw_1"]}], [["draw", 1, "kandraw_1"]]]
        ]]
      ],
      "precedence_over": ["chii", "pon", "daiminkan"]
    },
    "oohoshi_awai_kakan": {
      "display_name": "Kan (closed)",
      "call_style": {
        "kamicha": [["1x_sideways", 0], "call_sideways", 1, ["1x", 2]],
        "toimen": [["1x", 0], ["sideways", 1], "call_sideways", ["1x", 2]],
        "shimocha": [["1x", 0], 1, ["1x_sideways", 2], "call_sideways"]
      },
      "call": [[0, 0, 0]],
      "upgrades": "pon",
      "call_conditions": [[
        {"name": "not_call_contains", "opts": [[["7z", "golden"]], 1]},
        {"name": "call_contains", "opts": [["7z"], 1]}
      ]],
      "show_when": [
        "all_saki_cards_drafted",
        "our_turn",
        {"name": "status", "opts": ["oohoshi-awai"]},
        {"name": "not_status", "opts": ["match_start"]},
        {"name": "not_anyone_status", "opts": ["tried_to_ron"]},
        "not_no_tiles_remaining",
        "has_draw",
        "can_upgrade_call",
        {"name": "status_missing", "opts": ["just_reached"]},
        [
          {"name": "status_missing", "opts": ["usuzawa_sae_opponent"]},
          {"name": "status", "opts": ["riichi"]}
        ],
        [
          {"name": "status_missing", "opts": ["kataoka-yuuki"]},
          {"name": "not_round_wind_is", "opts": ["east"]},
          {"name": "status", "opts": ["kataoka-yuuki_exhausted"]}
        ],
        [
          {"name": "status_missing", "opts": ["nanpo-kazue"]},
          {"name": "not_round_wind_is", "opts": ["south"]},
          {"name": "status", "opts": ["nanpo-kazue_exhausted"]}
        ],
        [
          {"name": "status_missing", "opts": ["onjouji-toki"]},
          {"name": "status", "opts": ["onjouji-toki_exhausted"]}
        ],
        [
          {"name": "status_missing", "opts": ["iwato-kasumi"]},
          {"name": "not_status_missing", "opts": ["declare_manzu", "declare_pinzu", "declare_souzu", "declare_jihai"]}
        ],
        [
          {"name": "status_missing", "opts": ["funakubo-hiroko"]},
          {"name": "not_counter_equals", "opts": ["num_discards", 0, 6]},
          {"name": "status", "opts": ["funakubo-hiroko_exhausted"]}
        ],
        [
          {"name": "status_missing", "opts": ["megan-davin"]},
          {"name": "status", "opts": ["megan-davin_exhausted"]}
        ],
        {"name": "status_missing", "opts": ["oohoshi_awai_scry", "oohoshi_awai_draw", "oohoshi_awai_place"]}
      ],
      "actions": [
        ["big_text", "Kan"], ["upgrade_call"], ["unset_status_all", "just_reached"], ["set_status", "just_called"], ["set_status_all", "call_made"],
        ["shift_tile_to_dead_wall", 1],
        ["when", [{"name": "status", "opts": ["kan"]}, {"name": "not_status", "opts": ["ankan"]}, {"name": "tile_revealed", "opts": [-18]}, {"name": "tile_not_revealed", "opts": [-20]}], [["ensure_dead_wall_2"], ["reveal_tile", -20]]],
        ["when", [{"name": "status", "opts": ["kan"]}, {"name": "not_status", "opts": ["ankan"]}, {"name": "tile_revealed", "opts": [-16]}, {"name": "tile_not_revealed", "opts": [-18]}], [["ensure_dead_wall_2"], ["reveal_tile", -18]]],
        ["when", [{"name": "status", "opts": ["kan"]}, {"name": "not_status", "opts": ["ankan"]}, {"name": "tile_revealed", "opts": [-14]}, {"name": "tile_not_revealed", "opts": [-16]}], [["ensure_dead_wall_2"], ["reveal_tile", -16]]],
        ["when", [{"name": "status", "opts": ["kan"]}, {"name": "not_status", "opts": ["ankan"]}, {"name": "tile_revealed", "opts": [-12]}, {"name": "tile_not_revealed", "opts": [-14]}], [["reveal_tile", -14]]],
        ["when", [{"name": "status", "opts": ["kan"]}, {"name": "not_status", "opts": ["ankan"]}, {"name": "tile_revealed", "opts": [-10]}, {"name": "tile_not_revealed", "opts": [-12]}], [["reveal_tile", -12]]],
        ["when", [{"name": "status", "opts": ["kan"]}, {"name": "not_status", "opts": ["ankan"]}, {"name": "tile_revealed", "opts": [-8]}, {"name": "tile_not_revealed", "opts": [-10]}], [["reveal_tile", -10]]],
        ["when", [{"name": "status", "opts": ["kan"]}, {"name": "not_status", "opts": ["ankan"]}, {"name": "tile_revealed", "opts": [-6]}, {"name": "tile_not_revealed", "opts": [-8]}], [["reveal_tile", -8]]],
        ["set_status", "kan"],
        ["when", [{"name": "tile_drawn", "opts": ["kandraw_3"]}, {"name": "tile_not_drawn", "opts": ["kandraw_4"]}], [
          ["when", [{"name": "match", "opts": [["calls"], [[[["daiminkan", "ankan", "kakan"], 4]]]]}], [["set_status", "suukantsu"]]],
          ["draw", 1, "kandraw_4"]
        ]],
        ["when", [{"name": "tile_drawn", "opts": ["kandraw_2"]}, {"name": "tile_not_drawn", "opts": ["kandraw_3"]}], [["draw", 1, "kandraw_3"]]],
        ["when", [{"name": "tile_drawn", "opts": ["kandraw_1"]}, {"name": "tile_not_drawn", "opts": ["kandraw_2"]}], [["draw", 1, "kandraw_2"]]],
        ["when", [{"name": "tile_not_drawn", "opts": ["kandraw_1"]}], [["draw", 1, "kandraw_1"]]]
      ]
    },
    "chii": {
      "display_name": "Chii",
      "call": [[-2, -1], [-1, 1], [1, 2]],
      "call_style": {"kamicha": ["call_sideways", 0, 1], "toimen": [0, "call_sideways", 1], "shimocha": [0, 1, "call_sideways"]},
      "call_conditions": [[
        {"name": "not_call_contains", "opts": [[["7z", "golden"]], 1]},
        {"name": "call_contains", "opts": [["7z"], 1]}
      ]],
      "show_when": [
        "all_saki_cards_drafted",
        "not_our_turn",
        {"name": "not_anyone_status", "opts": ["about_to_call"]},
        {"name": "not_anyone_status", "opts": ["tried_to_ron"]},
        "not_no_tiles_remaining",
        "kamicha_discarded",
        {"name": "not_discarder_status", "opts": ["discard_passed"]},
        {"name": "status_missing", "opts": ["riichi", "iishanten", "atago_kinue_aside_waits", "just_scryed", "about_to_call", "about_to_swap", "call_interrupted", "usuzawa_sae_opponent"]},
        "call_available",
        [
          {"name": "not_others_status", "opts": ["aislinn-wishart"]},
          {"name": "not_has_no_call_named", "opts": ["chii", "pon", "daiminkan", "kakan"]},
          {"name": "has_score", "opts": [1500]}
        ],
        [
          {"name": "status", "opts": ["megan-davin", "duelist"]},
          {"name": "not_others_status", "opts": ["megan-davin", "riichi"]},
          {"name": "not_others_status", "opts": ["duelist", "riichi"]}
        ]
      ],
      "actions": [
        ["big_text", "Chii"],
        ["set_status", "about_to_call", "chii"],
        ["recalculate_buttons"], // allow interrupting call
        ["unset_status", "about_to_call"],
        ["unless", [{"name": "status", "opts": ["call_interrupted"]}], [
          ["call"], ["unset_status_all", "just_reached"], ["set_status", "just_called"], ["set_status_all", "call_made"], ["change_turn", "self"],
          ["when", [{"name": "status", "opts": ["inoue-jun"]}, {"name": "not_status", "opts": ["extra_turn"]}], [
            ["set_status", "extra_turn"],
            ["big_text", "Inoue Jun: extra turn!"],
            ["add_score", 500],
            ["subtract_score", 500, "last_discarder"],
            ["push_message", "took 500 points and an extra turn by calling (Inoue Jun)"],
            ["when", [{"name": "others_status", "opts": ["ippatsu"]}], [["set_status", "inoue_jun_broke_ippatsu"]]]
          ]]
        ]]
      ],
      "precedence_over": ["choe_myeonghwa", "kunihiro_hajime_interrupt", "chii"]
    },
    "maya_yukiko_chii": {
      "display_name": "Chii with priority",
      "call": [[-2, -1], [-1, 1], [1, 2]],
      "call_name": "chii",
      "call_style": {"kamicha": ["call_sideways", 0, 1], "toimen": [0, "call_sideways", 1], "shimocha": [0, 1, "call_sideways"]},
      "call_conditions": [[
        {"name": "not_call_contains", "opts": [[["7z", "golden"]], 1]},
        {"name": "call_contains", "opts": [["7z"], 1]}
      ]],
      "show_when": [
        "all_saki_cards_drafted",
        "not_our_turn",
        {"name": "status", "opts": ["maya-yukiko"]},
        {"name": "not_anyone_status", "opts": ["about_to_call"]},
        {"name": "not_anyone_status", "opts": ["tried_to_ron"]},
        "not_no_tiles_remaining",
        "someone_else_just_discarded",
        {"name": "not_discarder_status", "opts": ["discard_passed"]},
        {"name": "status_missing", "opts": ["riichi", "atago_kinue_aside_waits", "about_to_call", "call_interrupted", "usuzawa_sae_opponent"]},
        "call_available",
        [
          {"name": "not_others_status", "opts": ["aislinn-wishart"]},
          {"name": "not_has_no_call_named", "opts": ["chii", "pon", "daiminkan", "kakan"]},
          {"name": "has_score", "opts": [1500]}
        ],
        [
          {"name": "status", "opts": ["megan-davin", "duelist"]},
          {"name": "not_others_status", "opts": ["megan-davin", "riichi"]},
          {"name": "not_others_status", "opts": ["duelist", "riichi"]}
        ]
      ],
      "actions": [
        ["big_text", "Maya Yukiko: chii!"],
        ["set_status", "about_to_call", "chii"],
        ["recalculate_buttons"], // allow interrupt
        ["unset_status", "about_to_call"],
        ["unless", [{"name": "status", "opts": ["call_interrupted"]}], [
          ["call"], ["unset_status_all", "just_reached"], ["set_status", "just_called"], ["set_status_all", "call_made"], ["change_turn", "self"],
          ["push_message", "called chii with priority (Maya Yukiko)"]
        ]]
      ],
      "precedence_over": ["choe_myeonghwa", "kunihiro_hajime_interrupt", "chii", "pon", "riichi", "ikeda_kana", "daiminkan", "ankan", "kakan", "ron"]
    },
    "pon": {
      "display_name": "Pon",
      "call": [[0, 0]],
      "call_style": {"kamicha": ["call_sideways", 0, 1], "toimen": [0, "call_sideways", 1], "shimocha": [0, 1, "call_sideways"]},
      "call_conditions": [[
        {"name": "not_call_contains", "opts": [[["7z", "golden"]], 1]},
        {"name": "call_contains", "opts": [["7z"], 1]}
      ]],
      "show_when": [
        "all_saki_cards_drafted",
        "not_our_turn",
        {"name": "not_anyone_status", "opts": ["about_to_call"]},
        {"name": "not_anyone_status", "opts": ["tried_to_ron"]},
        "not_no_tiles_remaining", "someone_else_just_discarded",
        {"name": "not_discarder_status", "opts": ["discard_passed"]},
        {"name": "status_missing", "opts": ["riichi", "iishanten", "atago_kinue_aside_waits", "just_scryed", "about_to_call", "about_to_swap", "call_interrupted", "usuzawa_sae_opponent"]},
        "call_available",
        {"name": "status_missing", "opts": ["mase-yuuko"]},
        [
          {"name": "not_others_status", "opts": ["aislinn-wishart"]},
          {"name": "not_has_no_call_named", "opts": ["chii", "pon", "daiminkan", "kakan"]},
          {"name": "has_score", "opts": [1500]}
        ],
        [
          {"name": "status", "opts": ["megan-davin", "duelist"]},
          {"name": "not_others_status", "opts": ["megan-davin", "riichi"]},
          {"name": "not_others_status", "opts": ["duelist", "riichi"]}
        ]
      ],
      "actions": [
        ["big_text", "Pon"],
        ["set_status", "about_to_call", "pon"],
        ["recalculate_buttons"], // allow interrupting call
        ["unset_status", "about_to_call"],
        ["unless", [{"name": "status", "opts": ["call_interrupted"]}], [
          ["call"], ["unset_status_all", "just_reached"], ["set_status", "just_called"], ["set_status_all", "call_made"], ["change_turn", "self"],
          ["when", [{"name": "status", "opts": ["inoue-jun"]}, {"name": "not_status", "opts": ["extra_turn"]}], [
            ["set_status", "extra_turn"],
            ["big_text", "Inoue Jun: extra turn!"],
            ["add_score", 500],
            ["subtract_score", 500, "last_discarder"],
            ["push_message", "took 500 points and an extra turn by calling (Inoue Jun)"],
            ["when", [{"name": "others_status", "opts": ["ippatsu"]}], [["set_status", "inoue_jun_broke_ippatsu"]]]
          ]]
        ]]
      ],
      "precedence_over": ["choe_myeonghwa", "kunihiro_hajime_interrupt", "chii", "pon"]
    },
    "matsumi_yuu_pon": {
      "display_name": "Pon red dragon with priority",
      "show_when": ["all_saki_cards_drafted", "not_our_turn", {"name": "status", "opts": ["matsumi-yuu"]}, {"name": "match", "opts": [["hand", "draw"], [[[["chun_pair"], 1]]]]}, {"name": "match", "opts": [["others_discards"], [[[[["7z"]], 1]]]]}, "someone_else_just_discarded"],
      "actions": [
        ["big_text", "Matsumi Yuu: pon!"],
        ["mark", [["discard", 1, ["current_turn", "7z"]]]],
        ["push_message", "set aside the discarded fourth copy of the pon tile (Matano Seiko)"],
        ["pon_marked_discard"],
        ["cancel_deferred_actions"],
        ["unset_status_all", "just_reached"], ["set_status", "just_called"], ["set_status_all", "call_made"], ["set_status", "pon"], ["change_turn", "self"],
        ["when", [{"name": "others_status", "opts": ["miyanaga-teru"]}], [["add_honba"]]],
        [
          {"name": "not_others_status", "opts": ["aislinn-wishart"]},
          {"name": "not_has_no_call_named", "opts": ["chii", "pon", "daiminkan", "kakan"]},
          {"name": "has_score", "opts": [1500]}
        ],
        [
          {"name": "status", "opts": ["megan-davin", "duelist"]},
          {"name": "not_others_status", "opts": ["megan-davin", "riichi"]},
          {"name": "not_others_status", "opts": ["duelist", "riichi"]}
        ]
      ],
      "precedence_over": ["choe_myeonghwa", "kunihiro_hajime_interrupt", "chii", "pon", "riichi", "ikeda_kana", "daiminkan", "ankan", "kakan", "ron"]
    },
    "daiminkan": {
      "display_name": "Kan",
      "call": [[0, 0, 0]],
      "call_style": {"kamicha": ["call_sideways", 0, 1, 2], "toimen": [0, "call_sideways", 1, 2], "shimocha": [0, 1, 2, "call_sideways"]},
      "call_conditions": [[
        {"name": "not_call_contains", "opts": [[["7z", "golden"]], 1]},
        {"name": "call_contains", "opts": [["7z"], 1]}
      ]],
      "show_when": [
        "all_saki_cards_drafted",
        "not_our_turn",
        {"name": "not_anyone_status", "opts": ["about_to_call"]},
        {"name": "not_anyone_status", "opts": ["tried_to_ron"]},
        "not_no_tiles_remaining",
        "someone_else_just_discarded",
        {"name": "not_discarder_status", "opts": ["discard_passed"]},
        {"name": "status_missing", "opts": ["riichi", "iishanten", "atago_kinue_aside_waits", "just_scryed", "about_to_call", "about_to_swap", "call_interrupted", "usuzawa_sae_opponent"]},
        "call_available",
        {"name": "status_missing", "opts": ["mase-yuuko", "oohoshi-awai"]},
        [
          {"name": "not_others_status", "opts": ["aislinn-wishart"]},
          {"name": "not_has_no_call_named", "opts": ["chii", "pon", "daiminkan", "kakan"]},
          {"name": "has_score", "opts": [1500]}
        ],
        [
          {"name": "status", "opts": ["megan-davin", "duelist"]},
          {"name": "not_others_status", "opts": ["megan-davin", "riichi"]},
          {"name": "not_others_status", "opts": ["duelist", "riichi"]}
        ]
      ],
      "actions": [
        ["big_text", "Kan"],
        ["set_status", "about_to_call", "daiminkan"],
        ["recalculate_buttons"], // allow interrupting call
        ["unset_status", "about_to_call"],
        ["unless", [{"name": "status", "opts": ["call_interrupted"]}], [
          ["call"], ["unset_status_all", "just_reached"], ["set_status", "just_called"], ["set_status_all", "call_made"], ["change_turn", "self"],
          ["shift_tile_to_dead_wall", 1],
          ["when", [{"name": "status", "opts": ["kan"]}, {"name": "not_status", "opts": ["ankan"]}, {"name": "tile_revealed", "opts": [-18]}, {"name": "tile_not_revealed", "opts": [-20]}], [["ensure_dead_wall_2"], ["reveal_tile", -20]]],
          ["when", [{"name": "status", "opts": ["kan"]}, {"name": "not_status", "opts": ["ankan"]}, {"name": "tile_revealed", "opts": [-16]}, {"name": "tile_not_revealed", "opts": [-18]}], [["ensure_dead_wall_2"], ["reveal_tile", -18]]],
          ["when", [{"name": "status", "opts": ["kan"]}, {"name": "not_status", "opts": ["ankan"]}, {"name": "tile_revealed", "opts": [-14]}, {"name": "tile_not_revealed", "opts": [-16]}], [["ensure_dead_wall_2"], ["reveal_tile", -16]]],
          ["when", [{"name": "status", "opts": ["kan"]}, {"name": "not_status", "opts": ["ankan"]}, {"name": "tile_revealed", "opts": [-12]}, {"name": "tile_not_revealed", "opts": [-14]}], [["reveal_tile", -14]]],
          ["when", [{"name": "status", "opts": ["kan"]}, {"name": "not_status", "opts": ["ankan"]}, {"name": "tile_revealed", "opts": [-10]}, {"name": "tile_not_revealed", "opts": [-12]}], [["reveal_tile", -12]]],
          ["when", [{"name": "status", "opts": ["kan"]}, {"name": "not_status", "opts": ["ankan"]}, {"name": "tile_revealed", "opts": [-8]}, {"name": "tile_not_revealed", "opts": [-10]}], [["reveal_tile", -10]]],
          ["when", [{"name": "status", "opts": ["kan"]}, {"name": "not_status", "opts": ["ankan"]}, {"name": "tile_revealed", "opts": [-6]}, {"name": "tile_not_revealed", "opts": [-8]}], [["reveal_tile", -8]]],
          ["set_status", "kan"],
          ["when", [{"name": "tile_drawn", "opts": ["kandraw_3"]}, {"name": "tile_not_drawn", "opts": ["kandraw_4"]}], [
            ["when", [{"name": "match", "opts": [["calls"], [[[["daiminkan", "ankan", "kakan"], 4]]]]}], [["set_status", "suukantsu"]]],
            ["draw", 1, "kandraw_4"]
          ]],
          ["when", [{"name": "tile_drawn", "opts": ["kandraw_2"]}, {"name": "tile_not_drawn", "opts": ["kandraw_3"]}], [["draw", 1, "kandraw_3"]]],
          ["when", [{"name": "tile_drawn", "opts": ["kandraw_1"]}, {"name": "tile_not_drawn", "opts": ["kandraw_2"]}], [["draw", 1, "kandraw_2"]]],
          ["when", [{"name": "tile_not_drawn", "opts": ["kandraw_1"]}], [["draw", 1, "kandraw_1"]]],
          ["when", [{"name": "status", "opts": ["inoue-jun"]}, {"name": "not_status", "opts": ["extra_turn"]}], [
            ["set_status", "extra_turn"],
            ["big_text", "Inoue Jun: extra turn!"],
            ["add_score", 500],
            ["subtract_score", 500, "last_discarder"],
            ["push_message", "took 500 points and an extra turn by calling (Inoue Jun)"],
            ["when", [{"name": "others_status", "opts": ["ippatsu"]}], [["set_status", "inoue_jun_broke_ippatsu"]]]
          ]]
        ]]
      ],
      "precedence_over": ["choe_myeonghwa", "kunihiro_hajime_interrupt", "chii", "pon", "daiminkan"]
    },
    "ankan": {
      "display_name": "Ankan",
      "call": [[0, 0, 0]],
      "call_style": {"self": [["1x", 2], 0, 1, ["1x", 3]]},
      "call_conditions": [
        [
          {"name": "not_call_contains", "opts": [[["7z", "golden"]], 1]},
          {"name": "call_contains", "opts": [["7z"], 1]}
        ],
        [
          {"name": "not_status", "opts": ["riichi"]},
          {"name": "not_call_changes_waits", "opts": ["win"]}
        ]
      ],
      "show_when": [
        "all_saki_cards_drafted",
        "our_turn",
        {"name": "not_status", "opts": ["match_start"]},
        {"name": "not_anyone_status", "opts": ["tried_to_ron"]},
        "not_no_tiles_remaining",
        "has_draw",
        "self_call_available",
        {"name": "status_missing", "opts": ["just_reached"]},
        [
          {"name": "status_missing", "opts": ["usuzawa_sae_opponent"]},
          {"name": "status", "opts": ["riichi"]}
        ],
        [
          {"name": "not_status", "opts": ["riichi"]},
          {"name": "not_call_would_change_waits", "opts": ["win"]}
        ],
        [
          {"name": "status_missing", "opts": ["kataoka-yuuki"]},
          {"name": "not_round_wind_is", "opts": ["east"]},
          {"name": "status", "opts": ["kataoka-yuuki_exhausted"]}
        ],
        [
          {"name": "status_missing", "opts": ["nanpo-kazue"]},
          {"name": "not_round_wind_is", "opts": ["south"]},
          {"name": "status", "opts": ["nanpo-kazue_exhausted"]}
        ],
        [
          {"name": "status_missing", "opts": ["onjouji-toki"]},
          {"name": "status", "opts": ["onjouji-toki_exhausted"]}
        ],
        [
          {"name": "status_missing", "opts": ["iwato-kasumi"]},
          {"name": "not_status_missing", "opts": ["declare_manzu", "declare_pinzu", "declare_souzu", "declare_jihai"]}
        ],
        [
          {"name": "status_missing", "opts": ["funakubo-hiroko"]},
          {"name": "not_counter_equals", "opts": ["num_discards", 0, 6]},
          {"name": "status", "opts": ["funakubo-hiroko_exhausted"]}
        ],
        [
          {"name": "status_missing", "opts": ["megan-davin"]},
          {"name": "status", "opts": ["megan-davin_exhausted"]}
        ],
        {"name": "status_missing", "opts": ["oohoshi_awai_scry", "oohoshi_awai_draw", "oohoshi_awai_place"]},
        {"name": "status_missing", "opts": ["mase-yuuko"]}
      ],
      "actions": [
        ["big_text", "Kan"], ["self_call"], ["unset_status_all", "just_reached"], ["set_status", "just_called"], ["set_status_all", "call_made"],
        ["shift_tile_to_dead_wall", 1],
        ["when", [{"name": "status", "opts": ["kan"]}, {"name": "not_status", "opts": ["ankan"]}, {"name": "tile_revealed", "opts": [-18]}, {"name": "tile_not_revealed", "opts": [-20]}], [["ensure_dead_wall_2"], ["reveal_tile", -20]]],
        ["when", [{"name": "status", "opts": ["kan"]}, {"name": "not_status", "opts": ["ankan"]}, {"name": "tile_revealed", "opts": [-16]}, {"name": "tile_not_revealed", "opts": [-18]}], [["ensure_dead_wall_2"], ["reveal_tile", -18]]],
        ["when", [{"name": "status", "opts": ["kan"]}, {"name": "not_status", "opts": ["ankan"]}, {"name": "tile_revealed", "opts": [-14]}, {"name": "tile_not_revealed", "opts": [-16]}], [["ensure_dead_wall_2"], ["reveal_tile", -16]]],
        ["when", [{"name": "status", "opts": ["kan"]}, {"name": "not_status", "opts": ["ankan"]}, {"name": "tile_revealed", "opts": [-12]}, {"name": "tile_not_revealed", "opts": [-14]}], [["reveal_tile", -14]]],
        ["when", [{"name": "status", "opts": ["kan"]}, {"name": "not_status", "opts": ["ankan"]}, {"name": "tile_revealed", "opts": [-10]}, {"name": "tile_not_revealed", "opts": [-12]}], [["reveal_tile", -12]]],
        ["when", [{"name": "status", "opts": ["kan"]}, {"name": "not_status", "opts": ["ankan"]}, {"name": "tile_revealed", "opts": [-8]}, {"name": "tile_not_revealed", "opts": [-10]}], [["reveal_tile", -10]]],
        ["when", [{"name": "status", "opts": ["kan"]}, {"name": "not_status", "opts": ["ankan"]}, {"name": "tile_revealed", "opts": [-6]}, {"name": "tile_not_revealed", "opts": [-8]}], [["reveal_tile", -8]]],
        ["set_status", "kan", "ankan"],
        ["when", [{"name": "tile_revealed", "opts": [-18]}, {"name": "tile_not_revealed", "opts": [-20]}], [["reveal_tile", -20]]],
        ["when", [{"name": "tile_revealed", "opts": [-16]}, {"name": "tile_not_revealed", "opts": [-18]}], [["reveal_tile", -18]]],
        ["when", [{"name": "tile_revealed", "opts": [-14]}, {"name": "tile_not_revealed", "opts": [-16]}], [["reveal_tile", -16]]],
        ["when", [{"name": "tile_revealed", "opts": [-12]}, {"name": "tile_not_revealed", "opts": [-14]}], [["reveal_tile", -14]]],
        ["when", [{"name": "tile_revealed", "opts": [-10]}, {"name": "tile_not_revealed", "opts": [-12]}], [["reveal_tile", -12]]],
        ["when", [{"name": "tile_revealed", "opts": [-8]}, {"name": "tile_not_revealed", "opts": [-10]}], [["reveal_tile", -10]]],
        ["when", [{"name": "tile_revealed", "opts": [-6]}, {"name": "tile_not_revealed", "opts": [-8]}], [["reveal_tile", -8]]],
        ["unless", [{"name": "status", "opts": ["oohoshi-awai"]}], [
          ["when", [{"name": "tile_drawn", "opts": ["kandraw_3"]}, {"name": "tile_not_drawn", "opts": ["kandraw_4"]}], [
            ["when", [{"name": "match", "opts": [["calls"], [[[["daiminkan", "ankan", "kakan"], 4]]]]}], [["set_status", "suukantsu"]]],
            ["draw", 1, "kandraw_4"]
          ]],
          ["when", [{"name": "tile_drawn", "opts": ["kandraw_2"]}, {"name": "tile_not_drawn", "opts": ["kandraw_3"]}], [["draw", 1, "kandraw_3"]]],
          ["when", [{"name": "tile_drawn", "opts": ["kandraw_1"]}, {"name": "tile_not_drawn", "opts": ["kandraw_2"]}], [["draw", 1, "kandraw_2"]]],
          ["when", [{"name": "tile_not_drawn", "opts": ["kandraw_1"]}], [["draw", 1, "kandraw_1"]]]
        ]]
      ]
    },
    "kakan": {
      "display_name": "Kan",
      "call": [[0, 0, 0]],
      "call_style": {
        "kamicha": [["sideways", 0], "call_sideways", 1, 2],
        "toimen": [0, ["sideways", 1], "call_sideways", 2],
        "shimocha": [0, 1, ["sideways", 2], "call_sideways"]
      },
      "upgrades": "pon",
      "call_conditions": [[
        {"name": "not_call_contains", "opts": [[["7z", "golden"]], 1]},
        {"name": "call_contains", "opts": [["7z"], 1]}
      ]],
      "show_when": [
        "all_saki_cards_drafted",
        "our_turn",
        {"name": "not_status", "opts": ["match_start"]},
        {"name": "not_anyone_status", "opts": ["tried_to_ron"]},
        "not_no_tiles_remaining",
        "has_draw",
        {"name": "status_missing", "opts": ["just_reached", "mase-yuuko", "oohoshi-awai"]},
        "can_upgrade_call",
        [
          {"name": "status_missing", "opts": ["usuzawa_sae_opponent"]},
          {"name": "status", "opts": ["riichi"]}
        ],
        [
          {"name": "status_missing", "opts": ["kataoka-yuuki"]},
          {"name": "not_round_wind_is", "opts": ["east"]},
          {"name": "status", "opts": ["kataoka-yuuki_exhausted"]}
        ],
        [
          {"name": "status_missing", "opts": ["nanpo-kazue"]},
          {"name": "not_round_wind_is", "opts": ["south"]},
          {"name": "status", "opts": ["nanpo-kazue_exhausted"]}
        ],
        [
          {"name": "status_missing", "opts": ["onjouji-toki"]},
          {"name": "status", "opts": ["onjouji-toki_exhausted"]}
        ],
        [
          {"name": "status_missing", "opts": ["iwato-kasumi"]},
          {"name": "not_status_missing", "opts": ["declare_manzu", "declare_pinzu", "declare_souzu", "declare_jihai"]}
        ],
        [
          {"name": "status_missing", "opts": ["funakubo-hiroko"]},
          {"name": "not_counter_equals", "opts": ["num_discards", 0, 6]},
          {"name": "status", "opts": ["funakubo-hiroko_exhausted"]}
        ],
        [
          {"name": "status_missing", "opts": ["megan-davin"]},
          {"name": "status", "opts": ["megan-davin_exhausted"]}
        ],
        {"name": "status_missing", "opts": ["oohoshi_awai_scry", "oohoshi_awai_draw", "oohoshi_awai_place"]}
      ],
      "actions": [
        ["big_text", "Kan"], ["upgrade_call"], ["unset_status_all", "just_reached"], ["set_status", "just_called"], ["set_status_all", "call_made"],
        ["shift_tile_to_dead_wall", 1],
        ["when", [{"name": "status", "opts": ["kan"]}, {"name": "not_status", "opts": ["ankan"]}, {"name": "tile_revealed", "opts": [-18]}, {"name": "tile_not_revealed", "opts": [-20]}], [["ensure_dead_wall_2"], ["reveal_tile", -20]]],
        ["when", [{"name": "status", "opts": ["kan"]}, {"name": "not_status", "opts": ["ankan"]}, {"name": "tile_revealed", "opts": [-16]}, {"name": "tile_not_revealed", "opts": [-18]}], [["ensure_dead_wall_2"], ["reveal_tile", -18]]],
        ["when", [{"name": "status", "opts": ["kan"]}, {"name": "not_status", "opts": ["ankan"]}, {"name": "tile_revealed", "opts": [-14]}, {"name": "tile_not_revealed", "opts": [-16]}], [["ensure_dead_wall_2"], ["reveal_tile", -16]]],
        ["when", [{"name": "status", "opts": ["kan"]}, {"name": "not_status", "opts": ["ankan"]}, {"name": "tile_revealed", "opts": [-12]}, {"name": "tile_not_revealed", "opts": [-14]}], [["reveal_tile", -14]]],
        ["when", [{"name": "status", "opts": ["kan"]}, {"name": "not_status", "opts": ["ankan"]}, {"name": "tile_revealed", "opts": [-10]}, {"name": "tile_not_revealed", "opts": [-12]}], [["reveal_tile", -12]]],
        ["when", [{"name": "status", "opts": ["kan"]}, {"name": "not_status", "opts": ["ankan"]}, {"name": "tile_revealed", "opts": [-8]}, {"name": "tile_not_revealed", "opts": [-10]}], [["reveal_tile", -10]]],
        ["when", [{"name": "status", "opts": ["kan"]}, {"name": "not_status", "opts": ["ankan"]}, {"name": "tile_revealed", "opts": [-6]}, {"name": "tile_not_revealed", "opts": [-8]}], [["reveal_tile", -8]]],
        ["set_status", "kan"],
        ["when", [{"name": "tile_drawn", "opts": ["kandraw_3"]}, {"name": "tile_not_drawn", "opts": ["kandraw_4"]}], [
          ["when", [{"name": "match", "opts": [["calls"], [[[["daiminkan", "ankan", "kakan"], 4]]]]}], [["set_status", "suukantsu"]]],
          ["draw", 1, "kandraw_4"]
        ]],
        ["when", [{"name": "tile_drawn", "opts": ["kandraw_2"]}, {"name": "tile_not_drawn", "opts": ["kandraw_3"]}], [["draw", 1, "kandraw_3"]]],
        ["when", [{"name": "tile_drawn", "opts": ["kandraw_1"]}, {"name": "tile_not_drawn", "opts": ["kandraw_2"]}], [["draw", 1, "kandraw_2"]]],
        ["when", [{"name": "tile_not_drawn", "opts": ["kandraw_1"]}], [["draw", 1, "kandraw_1"]]]
      ]
    },
    "riichi": {
      "display_name": "Riichi",
      "show_when": [
        "all_saki_cards_drafted",
        "our_turn",
        {"name": "not_status", "opts": ["match_start"]},
        {"name": "not_anyone_status", "opts": ["tried_to_ron"]},
        {"name": "status", "opts": ["ready"]},
        {"name": "hand_tile_count", "opts": [2, 5, 8, 11, 14]},
        {"name": "status_missing", "opts": ["riichi", "iishanten", "inazuma_riichi", "just_scryed", "about_to_call", "about_to_swap"]},
        {"name": "has_score", "opts": [1000]},
        "next_draw_possible",
        {"name": "has_no_call_named", "opts": ["chii", "pon", "daiminkan", "kakan"]},
        [
          {"name": "match", "opts": [["hand", "calls", "draw"], ["tenpai_14"]]},
          [
            {"name": "status", "opts": ["kakura-kurumi"]},
            {"name": "match", "opts": [["hand", "calls", "draw"], ["kakura_kurumi_tenpai"]]}
          ]
        ],
        [
          {"name": "status_missing", "opts": ["kataoka-yuuki"]},
          {"name": "not_round_wind_is", "opts": ["east"]},
          {"name": "status", "opts": ["kataoka-yuuki_exhausted"]}
        ],
        [
          {"name": "status_missing", "opts": ["nanpo-kazue"]},
          {"name": "not_round_wind_is", "opts": ["south"]},
          {"name": "status", "opts": ["nanpo-kazue_exhausted"]}
        ],
        [
          {"name": "status_missing", "opts": ["onjouji-toki"]},
          {"name": "status", "opts": ["onjouji-toki_exhausted"]}
        ],
        [
          {"name": "status_missing", "opts": ["iwato-kasumi"]},
          {"name": "not_status_missing", "opts": ["declare_manzu", "declare_pinzu", "declare_souzu", "declare_jihai"]}
        ],
        [
          {"name": "status_missing", "opts": ["funakubo-hiroko"]},
          {"name": "not_counter_equals", "opts": ["num_discards", 0, 6]},
          {"name": "status", "opts": ["funakubo-hiroko_exhausted"]}
        ],
        [
          {"name": "status_missing", "opts": ["megan-davin"]},
          {"name": "status", "opts": ["megan-davin_exhausted"]}
        ],
        {"name": "status_missing", "opts": ["oohoshi_awai_scry", "oohoshi_awai_draw", "oohoshi_awai_place"]}
      ],
      "actions": [
        ["big_text", "Riichi"],
        ["when", [{"name": "others_status", "opts": ["miyanaga-teru"]}], [["add_honba"]]],
        ["set_status", "riichi", "just_reached", "ippatsu"],
        ["when", [{"name": "others_status", "opts": ["riichi"]}], [["set_status", "chasing"]]],
        ["push_message", "declared riichi"],
        ["when", [{"name": "status", "opts": ["discards_empty"]}, "no_calls_yet"], [["set_status", "double_riichi"]]],
        ["when", [{"name": "status", "opts": ["ikeda-kana"]}, {"name": "placement", "opts": [4]}], [["set_status_all", "triple_noten_payments"]]],
        ["when", [{"name": "others_status", "opts": ["miyanaga-teru"]}], [["add_honba"]]],
        ["when", [{"name": "status", "opts": ["atago-hiroe"]}], [
          ["clear_tile_aliases"],
          ["set_tile_alias", ["0m"], ["5m"]],
          ["set_tile_alias", ["0p"], ["5p"]],
          ["set_tile_alias", ["0s"], ["5s"]]
        ]],
        ["when", [{"name": "status", "opts": ["nelly-virsaladze"]}, "dealt_in_last_round"], [["add_counter", "riichi_turn", 1], ["add_counter", "riichi_turn", "num_discards"]]],
        ["when", [{"name": "status", "opts": ["ryuumonbuchi-touka"]}], [["set_status", "score_as_dealer"]]],
        ["when", [{"name": "status", "opts": ["shirouzu-mairu"]}], [
          ["flip_first_visible_discard_facedown"],
          ["flip_first_visible_discard_facedown"],
          ["push_message", "flips two visible discards facedown and switches to Himeko (Shirouzu Mairu)"],
          ["unset_status", "shirouzu-mairu"],
          ["set_status", "tsuruta-himeko"]
        ]],
        ["when_anyone", [{"name": "status", "opts": ["tsuruta-himeko"]}, {"name": "status_missing", "opts": ["riichi"]}], [
          ["big_text", "Tsuruta Himeko: switch out!"],
          ["unset_status", "tsuruta-himeko"],
          ["set_status", "shirouzu-mairu"]
        ]],
        ["when", [{"name": "status", "opts": ["hanada-kirame"]}], [["set_status", "hanada_kirame_choice"]]]
      ]
    },
    "ron": {
      "display_name": "Ron",
      "show_when": [
        "all_saki_cards_drafted",
        "not_our_turn",
        {"name": "status_missing", "opts": ["just_reached", "just_scryed", "about_to_call", "about_to_swap"]},
        [
          {"name": "status_missing", "opts": ["furiten"]},
          {"name": "status", "opts": ["atago-hiroe", "riichi"]},
          {"name": "status", "opts": ["atago-kinue", "atago_kinue_aside_waits"]}
        ],
        [
          {"name": "status_missing", "opts": ["usuzawa_sae_opponent"]},
          {"name": "status", "opts": ["riichi"]}
        ],
        {"name": "not_anyone_status", "opts": ["tried_to_ron"]},
        "someone_else_just_discarded",
        {"name": "not_discarder_status", "opts": ["discard_passed"]},
        "last_discard_exists",
        [
          {"name": "status", "opts": ["atago-kinue", "atago_kinue_aside_waits"]},
          {"name": "match", "opts": [["hand", "calls", "last_discard"], ["win"]]},
          [
            {"name": "status", "opts": ["miyanaga-saki"]},
            {"name": "has_attr", "opts": ["last_discard", "rinshan"]},
            {"name": "match", "opts": [["hand", "calls"], ["tenpai"]]}
          ],
          [
            {"name": "status", "opts": ["amae-koromo"]},
            {"name": "has_attr", "opts": ["last_discard", "haitei"]},
            {"name": "match", "opts": [["hand", "calls"], ["tenpai"]]}
          ],
          [
            {"name": "status", "opts": ["kakura-kurumi", "riichi"]},
            {"name": "match", "opts": [["hand", "calls", "last_discard"], ["kakura_kurumi_win"]]}
          ]
        ],
        [
          {"name": "not_status", "opts": ["atago-kinue", "atago_kinue_aside_waits"]},
          {"name": "match", "opts": [["aside_unique", "last_discard"], [["nojoker", [["pair"], 1]]]]}
        ],
        [
          [
            {"name": "status_missing", "opts": ["shimizudani-ryuuka"]},
            [{"name": "has_yaku_with_discard", "opts": [1]}, {"name": "has_yaku2_with_discard", "opts": [1]}]
          ],
          [
            {"name": "status", "opts": ["shimizudani-ryuuka"]},
            "not_has_aside",
            {"name": "has_declared_yaku_with_discard", "opts": ["yaku", "meta_yaku", "meta_yaku_2", "yakuman", "meta_yakuman"]}
          ],
          {"name": "status", "opts": ["senoo-kaori"]}
        ],
        [
          {"name": "not_others_status", "opts": ["choe-myeonghwa"]},
          [
            {"name": "seat_is", "opts": ["east"]},
            [
              [{"name": "shimocha_status", "opts": ["choe-myeonghwa"]}, {"name": "not_match", "opts": [["hand", "calls"], [[[[["2z"]], 1]]]]}],
              [{"name": "toimen_status", "opts": ["choe-myeonghwa"]}, {"name": "not_match", "opts": [["hand", "calls"], [[[[["3z"]], 1]]]]}],
              [{"name": "kamicha_status", "opts": ["choe-myeonghwa"]}, {"name": "not_match", "opts": [["hand", "calls"], [[[[["4z"]], 1]]]]}]
             ]
          ],
          [
            {"name": "seat_is", "opts": ["south"]},
            [
              [{"name": "shimocha_status", "opts": ["choe-myeonghwa"]}, {"name": "not_match", "opts": [["hand", "calls"], [[[[["3z"]], 1]]]]}],
              [{"name": "toimen_status", "opts": ["choe-myeonghwa"]}, {"name": "not_match", "opts": [["hand", "calls"], [[[[["4z"]], 1]]]]}],
              [{"name": "kamicha_status", "opts": ["choe-myeonghwa"]}, {"name": "not_match", "opts": [["hand", "calls"], [[[[["1z"]], 1]]]]}]
            ]
          ],
          [
            {"name": "seat_is", "opts": ["west"]},
            [
              [{"name": "shimocha_status", "opts": ["choe-myeonghwa"]}, {"name": "not_match", "opts": [["hand", "calls"], [[[[["4z"]], 1]]]]}],
              [{"name": "toimen_status", "opts": ["choe-myeonghwa"]}, {"name": "not_match", "opts": [["hand", "calls"], [[[[["1z"]], 1]]]]}],
              [{"name": "kamicha_status", "opts": ["choe-myeonghwa"]}, {"name": "not_match", "opts": [["hand", "calls"], [[[[["2z"]], 1]]]]}]
            ]
          ],
          [
            {"name": "seat_is", "opts": ["north"]},
            [
              [{"name": "shimocha_status", "opts": ["choe-myeonghwa"]}, {"name": "not_match", "opts": [["hand", "calls"], [[[[["1z"]], 1]]]]}],
              [{"name": "toimen_status", "opts": ["choe-myeonghwa"]}, {"name": "not_match", "opts": [["hand", "calls"], [[[[["2z"]], 1]]]]}],
              [{"name": "kamicha_status", "opts": ["choe-myeonghwa"]}, {"name": "not_match", "opts": [["hand", "calls"], [[[[["3z"]], 1]]]]}]
            ]
          ],
          [{"name": "has_yaku_with_discard", "opts": [13]}, {"name": "has_yaku2_with_discard", "opts": [1]}]
        ]
      ],
      "actions": [
        ["big_text", "Ron"], ["pause", 1000], ["set_status", "tried_to_ron"], ["recalculate_buttons"], ["reveal_hand"], ["win_by_discard"]
      ],
      "precedence_over": ["choe_myeonghwa", "kunihiro_hajime_interrupt", "chii", "pon", "kan", "riichi", "daiminkan", "ankan", "kakan"]
    },
    "chankan": {
      "display_name": "Ron",
      "show_when": [
        "all_saki_cards_drafted",
        "not_our_turn",
        {"name": "status_missing", "opts": ["just_reached", "about_to_call"]},
        [
          {"name": "status_missing", "opts": ["furiten"]},
          {"name": "status", "opts": ["atago-hiroe", "riichi"]}
        ],
        {"name": "not_anyone_status", "opts": ["tried_to_ron"]},
        [
          [
            {"name": "last_call_is", "opts": ["kakan"]},
            {"name": "status", "opts": ["atago-kinue", "atago_kinue_aside_waits"]},
            {"name": "match", "opts": [["hand", "calls", "last_called_tile"], ["win"]]}
          ],
          [
            {"name": "status", "opts": ["miyanaga-saki"]},
            {"name": "has_attr", "opts": ["last_called_tile", "rinshan"]},
            {"name": "match", "opts": [["hand", "calls"], ["tenpai"]]}
          ],
          [
            {"name": "status", "opts": ["amae-koromo"]},
            {"name": "has_attr", "opts": ["last_called_tile", "haitei"]},
            {"name": "match", "opts": [["hand", "calls"], ["tenpai"]]}
          ],
          [
            {"name": "last_call_is", "opts": ["ankan"]},
            {"name": "match", "opts": [["hand", "calls"], ["kokushi_tenpai"]]},
            {"name": "match", "opts": [["hand", "calls", "last_called_tile"], ["win"]]}
          ],
          [
            {"name": "last_call_is", "opts": ["kakan"]},
            {"name": "status", "opts": ["kakura-kurumi", "riichi"]},
            {"name": "match", "opts": [["hand", "calls", "last_called_tile"], ["kakura_kurumi_win"]]}
          ]
        ],
        [
          {"name": "not_status", "opts": ["atago-kinue", "atago_kinue_aside_waits"]},
          {"name": "last_call_is", "opts": ["kakan"]},
          {"name": "match", "opts": [["aside_unique", "last_called_tile"], [["nojoker", [["pair"], 1]]]]}
        ],
        [
          {"name": "status_missing", "opts": ["shimizudani-ryuuka"]},
          [
            {"name": "status", "opts": ["shimizudani-ryuuka"]},
            "not_has_aside",
            {"name": "has_declared_yaku_with_call", "opts": ["yaku", "meta_yaku", "meta_yaku_2", "yakuman", "meta_yakuman"]}
          ]
        ],
        [
          {"name": "not_others_status", "opts": ["choe-myeonghwa"]},
          [
            {"name": "seat_is", "opts": ["east"]},
            [
              [{"name": "shimocha_status", "opts": ["choe-myeonghwa"]}, {"name": "not_match", "opts": [["hand", "calls"], [[[[["2z"]], 1]]]]}],
              [{"name": "toimen_status", "opts": ["choe-myeonghwa"]}, {"name": "not_match", "opts": [["hand", "calls"], [[[[["3z"]], 1]]]]}],
              [{"name": "kamicha_status", "opts": ["choe-myeonghwa"]}, {"name": "not_match", "opts": [["hand", "calls"], [[[[["4z"]], 1]]]]}]
            ]
          ],
          [
            {"name": "seat_is", "opts": ["south"]},
            [
              [{"name": "shimocha_status", "opts": ["choe-myeonghwa"]}, {"name": "not_match", "opts": [["hand", "calls"], [[[[["3z"]], 1]]]]}],
              [{"name": "toimen_status", "opts": ["choe-myeonghwa"]}, {"name": "not_match", "opts": [["hand", "calls"], [[[[["4z"]], 1]]]]}],
              [{"name": "kamicha_status", "opts": ["choe-myeonghwa"]}, {"name": "not_match", "opts": [["hand", "calls"], [[[[["1z"]], 1]]]]}]
            ]
          ],
          [
            {"name": "seat_is", "opts": ["west"]},
            [
              [{"name": "shimocha_status", "opts": ["choe-myeonghwa"]}, {"name": "not_match", "opts": [["hand", "calls"], [[[[["4z"]], 1]]]]}],
              [{"name": "toimen_status", "opts": ["choe-myeonghwa"]}, {"name": "not_match", "opts": [["hand", "calls"], [[[[["1z"]], 1]]]]}],
              [{"name": "kamicha_status", "opts": ["choe-myeonghwa"]}, {"name": "not_match", "opts": [["hand", "calls"], [[[[["2z"]], 1]]]]}]
            ]
          ],
          [
            {"name": "seat_is", "opts": ["north"]},
            [
              [{"name": "shimocha_status", "opts": ["choe-myeonghwa"]}, {"name": "not_match", "opts": [["hand", "calls"], [[[[["1z"]], 1]]]]}],
              [{"name": "toimen_status", "opts": ["choe-myeonghwa"]}, {"name": "not_match", "opts": [["hand", "calls"], [[[[["2z"]], 1]]]]}],
              [{"name": "kamicha_status", "opts": ["choe-myeonghwa"]}, {"name": "not_match", "opts": [["hand", "calls"], [[[[["3z"]], 1]]]]}]
            ]
          ],
          [{"name": "has_yaku_with_call", "opts": [13]}, {"name": "has_yaku2_with_call", "opts": [1]}]
        ]
      ],
      "actions": [
        ["big_text", "Ron"], ["pause", 1000], ["recalculate_buttons"], ["reveal_hand"], ["win_by_call"]
      ],
      "precedence_over": ["choe_myeonghwa", "kunihiro_hajime_interrupt", "chii", "pon", "kan", "riichi", "daiminkan", "ankan", "kakan"]
    },
    "tsumo": {
      "display_name": "Tsumo",
      "show_when": [
        "all_saki_cards_drafted",
        "our_turn",
        {"name": "status", "opts": ["ready"]},
        {"name": "status_missing", "opts": ["match_start", "just_reached", "about_to_call"]},
        {"name": "hand_tile_count", "opts": [2, 5, 8, 11, 14]},
        [
          {"name": "status", "opts": ["atago-kinue", "atago_kinue_aside_waits"]},
          {"name": "match", "opts": [["hand", "calls", "draw"], ["win"]]},
          [
            {"name": "status", "opts": ["miyanaga-saki"]},
            {"name": "has_attr", "opts": ["draw", "rinshan"]},
            {"name": "match", "opts": [["hand", "calls"], ["tenpai"]]}
          ],
          [
            {"name": "status", "opts": ["amae-koromo"]},
            {"name": "has_attr", "opts": ["draw", "haitei"]},
            {"name": "match", "opts": [["hand", "calls"], ["tenpai"]]}
          ],
          [
            {"name": "status", "opts": ["kakura-kurumi", "riichi"]},
            {"name": "match", "opts": [["hand", "calls", "draw"], ["kakura_kurumi_win"]]}
          ]
        ],
        [
          {"name": "not_status", "opts": ["atago-kinue", "atago_kinue_aside_waits"]},
          [
            {"name": "status_missing", "opts": ["just_changed_atago_kinue_aside_waits"]},
            {"name": "match", "opts": [["aside_unique", "draw"], [["nojoker", [["pair"], 1]]]]}
          ]
        ],
        [
          [
            {"name": "status_missing", "opts": ["shimizudani-ryuuka"]},
            [{"name": "has_yaku_with_hand", "opts": [1]}, {"name": "has_yaku2_with_hand", "opts": [1]}]
          ],
          [
            {"name": "status", "opts": ["shimizudani-ryuuka"]},
            "not_has_aside",
            {"name": "has_declared_yaku_with_hand", "opts": ["yaku", "meta_yaku", "meta_yaku_2", "yakuman", "meta_yakuman"]}
          ],
          {"name": "status", "opts": ["senoo-kaori"]}
        ],
        [
          {"name": "not_others_status", "opts": ["choe-myeonghwa"]},
          [
            {"name": "seat_is", "opts": ["east"]},
            [
              [{"name": "shimocha_status", "opts": ["choe-myeonghwa"]}, {"name": "not_match", "opts": [["hand", "calls"], [[[[["2z"]], 1]]]]}],
              [{"name": "toimen_status", "opts": ["choe-myeonghwa"]}, {"name": "not_match", "opts": [["hand", "calls"], [[[[["3z"]], 1]]]]}],
              [{"name": "kamicha_status", "opts": ["choe-myeonghwa"]}, {"name": "not_match", "opts": [["hand", "calls"], [[[[["4z"]], 1]]]]}]
            ]
          ],
          [
            {"name": "seat_is", "opts": ["south"]},
            [
              [{"name": "shimocha_status", "opts": ["choe-myeonghwa"]}, {"name": "not_match", "opts": [["hand", "calls"], [[[[["3z"]], 1]]]]}],
              [{"name": "toimen_status", "opts": ["choe-myeonghwa"]}, {"name": "not_match", "opts": [["hand", "calls"], [[[[["4z"]], 1]]]]}],
              [{"name": "kamicha_status", "opts": ["choe-myeonghwa"]}, {"name": "not_match", "opts": [["hand", "calls"], [[[[["1z"]], 1]]]]}]
            ]
          ],
          [
            {"name": "seat_is", "opts": ["west"]},
            [
              [{"name": "shimocha_status", "opts": ["choe-myeonghwa"]}, {"name": "not_match", "opts": [["hand", "calls"], [[[[["4z"]], 1]]]]}],
              [{"name": "toimen_status", "opts": ["choe-myeonghwa"]}, {"name": "not_match", "opts": [["hand", "calls"], [[[[["1z"]], 1]]]]}],
              [{"name": "kamicha_status", "opts": ["choe-myeonghwa"]}, {"name": "not_match", "opts": [["hand", "calls"], [[[[["2z"]], 1]]]]}]
            ]
          ],
          [
            {"name": "seat_is", "opts": ["north"]},
            [
              [{"name": "shimocha_status", "opts": ["choe-myeonghwa"]}, {"name": "not_match", "opts": [["hand", "calls"], [[[[["1z"]], 1]]]]}],
              [{"name": "toimen_status", "opts": ["choe-myeonghwa"]}, {"name": "not_match", "opts": [["hand", "calls"], [[[[["2z"]], 1]]]]}],
              [{"name": "kamicha_status", "opts": ["choe-myeonghwa"]}, {"name": "not_match", "opts": [["hand", "calls"], [[[[["3z"]], 1]]]]}]
            ]
          ],
          [{"name": "has_yaku_with_hand", "opts": [13]}, {"name": "has_yaku2_with_hand", "opts": [1]}]
        ],
        [
          {"name": "status_missing", "opts": ["kataoka-yuuki"]},
          {"name": "not_round_wind_is", "opts": ["east"]},
          {"name": "status", "opts": ["kataoka-yuuki_exhausted"]}
        ],
        [
          {"name": "status_missing", "opts": ["nanpo-kazue"]},
          {"name": "not_round_wind_is", "opts": ["south"]},
          {"name": "status", "opts": ["nanpo-kazue_exhausted"]}
        ],
        [
          {"name": "status_missing", "opts": ["onjouji-toki"]},
          {"name": "status", "opts": ["onjouji-toki_exhausted"]}
        ],
        [
          {"name": "status_missing", "opts": ["iwato-kasumi"]},
          {"name": "not_status_missing", "opts": ["declare_manzu", "declare_pinzu", "declare_souzu", "declare_jihai"]}
        ],
        [
          {"name": "status_missing", "opts": ["funakubo-hiroko"]},
          {"name": "not_counter_equals", "opts": ["num_discards", 0, 6]},
          {"name": "status", "opts": ["funakubo-hiroko_exhausted"]}
        ],
        [
          {"name": "status_missing", "opts": ["megan-davin"]},
          {"name": "status", "opts": ["megan-davin_exhausted"]}
        ],
        {"name": "status_missing", "opts": ["oohoshi_awai_scry", "oohoshi_awai_draw", "oohoshi_awai_place"]}
      ],
      "actions": [
        ["big_text", "Tsumo"], ["pause", 1000], ["reveal_hand"], ["win_by_draw"]
      ],
      "precedence_over": ["choe_myeonghwa", "kunihiro_hajime_interrupt", "chii", "pon", "kan", "riichi", "daiminkan", "ankan", "kakan"]
    },
    "kyuushu_kyuuhai": {
      "display_name": "Kyuushu Kyuuhai",
      "show_when": [
        "all_saki_cards_drafted",
        "our_turn",
        "has_draw",
        {"name": "not_status", "opts": ["match_start"]},
        {"name": "status", "opts": ["discards_empty"]},
        {"name": "status_missing", "opts": ["call_made"]},
        {"name": "match", "opts": [["hand", "draw"], ["kyuushu_kyuuhai"]]}
      ],
      "actions": [
        ["big_text", "Kyushuu Kyuuhai"],
        ["reveal_hand"],
        ["pause", 1000],
        ["abortive_draw", "Kyushuu Kyuuhai"]
      ]
    },
    "extra_turn": {
      "display_name": "Take extra turn",
      "show_when": ["all_saki_cards_drafted", "our_turn", "just_discarded", {"name": "status", "opts": ["extra_turn", "extra_turn_prompt"]}, {"name": "status_missing", "opts": ["extra_turn_taken", "shishihara_sawaya_swap"]}],
      "actions": [
        ["unset_status", "extra_turn", "extra_turn_prompt"],
        ["set_status", "extra_turn_taken"],
        ["when", [{"name": "anyone_status", "opts": ["miyanaga-teru"]}], [["add_honba"]]],
        ["when", [{"name": "status_missing", "opts": ["shirouzu-mairu"]}], [["draw"]]]
      ],
      "unskippable": true
    },
    "extra_turn_skip": {
      "display_name": "Skip extra turn",
      "show_when": ["all_saki_cards_drafted", "our_turn", "just_discarded", {"name": "status", "opts": ["extra_turn", "extra_turn_prompt"]}, {"name": "status_missing", "opts": ["extra_turn_taken", "shishihara_sawaya_swap"]}],
      "actions": [
        ["unset_status", "extra_turn", "extra_turn_prompt", "discard_facedown"],
        ["set_status", "extra_turn_skipped"],
        ["push_message", "skipped their extra turn"],
        ["advance_turn"]
      ],
      "unskippable": true
    },
    "extra_turn_skip_inoue_jun": {
      "display_name": "Skip extra turn to discard facedown",
      "show_when": ["all_saki_cards_drafted", "our_turn", "not_just_discarded", {"name": "status", "opts": ["extra_turn", "inoue_jun_broke_ippatsu"]}, {"name": "status_missing", "opts": ["extra_turn_taken"]}],
      "actions": [["unset_status", "extra_turn", "inoue_jun_broke_ippatsu"], ["set_status", "discard_facedown"]]
    }
  },
  "auto_buttons": {
    "1_auto_sort": {
      "display_name": "A",
      "desc": "Automatically sort your hand.",
      "actions": [["sort_hand"]],
      "enabled_at_start": true
    },
    "2_auto_ron": {
      "display_name": "R",
      "desc": "Automatically declare wins.",
      "actions": [
        ["when", [{"name": "buttons_include", "opts": ["ron"]}], [["press_button", "ron"]]],
        ["when", [{"name": "buttons_include", "opts": ["tsumo"]}], [["press_button", "tsumo"]]]
      ],
      "enabled_at_start": false
    },
    "3_auto_no_call": {
      "display_name": "C",
      "desc": "Skip all calls except wins.",
      "actions": [
        ["when", [
            "not_our_turn",
            {"name": "buttons_include", "opts": ["skip"]},
            {"name": "buttons_exclude", "opts": ["ron"]}
          ], [["press_button", "skip"]]]
      ],
      "enabled_at_start": false
    },
    "4_auto_discard": {
      "display_name": "D",
      "desc": "Automatically discard your drawn tile.",
      "actions": [["when", ["our_turn", {"name": "buttons_exclude", "opts": ["tsumo", "ankan"]}, "has_draw"], [["discard_draw"]]]],
      "enabled_at_start": false
    }
  },
  "interruptible_actions": ["recalculate_buttons", "play_tile", "check_discard_passed", "advance_turn", "draw", "draw_from_aside", "swap_tiles", "clear_marking"],
  "shown_statuses": ["furiten"],
  "persistent_statuses": ["hanada-kirame_exhausted", "matsumi_kuro_dora_disabled"],
  "display_riichi_sticks": true,
  "display_honba": true,
  "display_wall": true,
  "initial_score": 30000,
  "initial_dead_wall_length": 14,
  "starting_tiles": 13,
  "max_rounds": 8,
  "win_timer": 20
}
